function Data2Provider(){var a=function(a){a.allDocs({include_docs:!0},function(a,b){console.log("All Docs",b);var c=angular.toJson(b).length,d="";d=c>1e6?c/1e6+" MB":c>1e3?c/1e3+" KB":c+" Bytes",console.log("Pouchdb allDocs: "+d)})};this.$get=["pouchdb",function(b){var c=b.create("gths");return window._db=c,a(c),c}]}function modelProvider(){function a(){}var b=this,c=b;a.prototype.isValid=function(){var a=this,b=!0;return angular.forEach(a.requiredFields,function(c){console.log("isValid field",c),a.invalidValues.indexOf(a[c])>-1&&(b=!1)}),b},b.encrypt=a.prototype.encrypt=function(a){return CryptoJS.SHA3(a).toString(CryptoJS.enc.Hex)},b.isValid=function(a){console.log("RUNNING: self.isValid",a);var b=!0,c={string:[""],number:[0]};return angular.forEach(a.datatype.fields,function(d){if(d.required){var e=a[d.key];console.log("What is value",e,d.type),typeof e!==d.type&&(console.log("Error typeof",e,d.type),b=!1),c[d.type]&&c[d.type].indexOf(e)>-1&&(b=!1)}}),b},a.prototype.validates=function(){var a=this;"function"==typeof this.normalize&&(a=Object.create(this),a.normalize());var b=!0,c={string:["","0.00",null,void 0],number:[0/0,null,void 0]};return angular.forEach(a.datatype.fields,function(d){if(d.required){var e=a[d.key];typeof e!==d.type&&(b=!1,console.log("Failed to validate:"+a.constructor,"typeof "+d.key+" should equal "+d.type+" got: "+e+" : "+typeof e)),c[d.type]&&c[d.type].indexOf(e)>-1&&(b=!1)}}),b},a.prototype.asDoc=function(){var a=this,b=[];angular.forEach(a.datatype.fields,function(c){b.push(a[c.key])});var c={};return c._id=a._id,a._rev&&(c._rev=a._rev),c.datatype=this.datatype._id,c[this.datatype.fields_key]=b,c},a.prototype.saveable=function(){var a=this;if("function"==typeof a.generateID&&!a._id){var b=a.generateID();a._id=b}return"function"==typeof a.normalize&&a.normalize(),a.asDoc()},a.prototype.save=function(){var a=this,b=a.$q.defer();return"string"==typeof a.db&&(console.log("db = ",a.db),a.db=c.pouchdb.create(a.db),console.log("db = ",a.db)),a.validates()?a.db.put(a.saveable()).then(function(c){a._rev=c.rev,a._id=c.id,console.log("Saved: ",a),a.db.allDocs().then(function(a){console.log("Alldocs:",a)}),b.resolve(c)},function(a,c){b.reject(a,c)}).catch(function(a){console.log("Failed to save:",a)}):b.reject(this.constructor+" is not valid"),b.promise},a.prototype.model=function(a){var b=Object.create(this);return angular.forEach(this.vectorSchema,function(c,d){b[c]=a.d[d]}),b},a.prototype.is=function(a){var c=a.split("."),d=c[0],e=c[1];b.datatypes[d]={},b.datatypes[d][e]={type:"schema",_id:"datatype/"+d+"/"+e,fields:[],fields_key:0},this.datatype=b.datatypes[d][e]},a.prototype.val=function(a,b){var c=a.split(":"),d=c[0].trim(),e=c.length>1?c[1].trim():void 0;return this.datatype.fields.push({key:d,type:e,required:b?!0:!1}),d},a.prototype.__init__=function(a){var b=this;a=a||{},angular.forEach(a,function(c,d){a[d]&&(b[d]=a[d])})},b.parse=function(a,b){var c={_id:a._id,_rev:a._rev};return angular.forEach(b.fields,function(d,e){c[d.key]=a[b.fields_key][e]}),c},b.parse2=function(a,c){var d=c.split("/"),e=b.datatypes[d[1]][d[2]];return b.parse(a,e)},b.Model=a,b.datatypes={},b.updateDatatypes=function(){var c=new a;angular.forEach(b.datatypes,function(a){angular.forEach(a,function(a){c.db.get(a._id).then(function(b){b.fields=a.fields,c.db.put(a)}).catch(function(){c.db.put(a)})})})},this.$get=["Data2","$q","Slug","pouchdb",function(c,d,e,f){return a.prototype.db=c,a.prototype.$q=d,b.slugify=e.slugify,b.pouchdb=f,b.updateDatatypes(),b}]}function TimeTable(a){function b(a,b){return{courseId:a,teacherId:b}}var c={},d={};a.get("timetable",function(a){console.log("timetable",a),a.hasOwnProperty("courses")&&(c=a.courses,d=a.teachers)});var e=function(){a.saveLater({timetable:{courses:c,teachers:d}})};return{addBookmark:function(a,f){var g=b(a,f);c.hasOwnProperty(g.teacherId)||(c[g.teacherId]=[]),d.hasOwnProperty(g.courseId)||(d[g.courseId]=[]);var h=c[g.teacherId].filter(function(a){return a.courseId===g.courseId}).length>0;if(!h){var i=Date.now(),j={courseId:g.courseId,timestamp:i},k={username:g.teacherId,timestamp:i};c[g.teacherId].push(j),d[g.courseId].push(k),e()}},removeBookmark:function(a){c[a.teacherId]=c[a.teacherId].filter(function(b){return b.courseId!==a.courseId}),e()},getTeacher:function(a){var b=d[a],c=void 0;return c=b?b[b.length-1]:{username:"",timestamp:null}},getCourseRefs:function(a){return c.hasOwnProperty(a)||(c[a]=[]),c[a]}}}function Registrar(a,b,c,d,e,f,g){var h={},i={},j={},k=function(a,b){i.hasOwnProperty(b)||(i[b]=[]),i[b].lastIndexOf(a)<0&&i[b].push(a),h[a].courses.lastIndexOf(b)<0&&h[a].courses.push(b)};return self={},self.getClasses=function(){return j},self.addStudent=function(b){b=f.transform(b,g.Student),b.onChange(function(a){console.log("Student changed : ",a,b),self.save()});var c=b.form,d=b.group;h[b.id]=b;var e=c+"-"+d;j.hasOwnProperty(e)||(j[e]=[]),j[e].push(b.id),angular.forEach(a.getCourses(c,d),function(a){k(b.id,a.id)})},self.save=function(a){console.log("Registrar: saving students"),b.saveLater({students:h},a)},self.getStudentsByCourseUnsorted=function(a){var b=i[a],c=b.map(function(a){return h[a]});return c},self.getStudentsByCourse=function(a){var b=self.getStudentsByCourseUnsorted(a);return b.sort(function(a,b){return a.name.localeCompare(b.name)}),angular.forEach(b,function(a,b){a.roll=b+1}),b},self.getAllStudents=function(){return Object.keys(h).map(function(a){return h[a]})},b.get("students",function(a){var b=angular.copy(a);angular.forEach(b,function(a){self.addStudent(a)})}),self}function CourseCatalog(a,b,c,d,e,f){function g(a,b,c){return h=angular.copy(c),h.id=a+":"+b+":"+h.code,h.form=f.all()[a].name,h.group=e.get(b).name,h}var h={},i={},j={};return b.get("coursecatalog",function(a){j=a,angular.forEach(f.all(),function(a,b){angular.forEach(e.getAll(),function(a,c){angular.forEach(j.subjects,function(a,d){a.code=d;var e=g(b,c,a);i[e.id]=e})})})}),angular.forEach(j.subjects,function(a,b){var a=c.transform(a,d.Subject);j.subjects[b]=a,a.onChange(function(){h.save()})}),h.getCourseId=function(a){return a.formIndex+":"+a.groupIndex+":"+a.subjectKey},h.getCourse=function(a){return i[a]},h.getSubjects=function(){return j.subjects},h.getAllSubjects=function(){return j.subjects},h.getCoursesByRef=function(a){var b=a.map(function(a){var b=angular.copy(h.getCourse(a.courseId));return b?(b.timestamp=a.timestamp,b):void 0});return b.filter(function(a){return void 0!==a})},h.getCourses=function(a,b){var c=[];return angular.forEach(h.getSubjects(a),function(d,e){var f=h.getCourseId({formIndex:a,groupIndex:b,subjectKey:e}),g=h.getCourse(f);g&&c.push(g)}),c},h.getCourseIds=function(a,b){return h.getCourses(a,b).map(function(a){return a.id})},h.getAllCourses=function(){return i},h.getForms=function(){return f.all()},h.getTerms=function(){return console.log("inside course catalog get terms: ",j),j.terms},h.getSubjectKey=function(a){return a.split(":")[2]},h.save=function(){b.saveLater({coursecatalog:j})},h.removeSubject=function(a){delete j.subjects[a],h.save()},h.post=function(a){j.subjects[a.code]=a,h.save()},h}function ClassMaster(a,b,c,d){var e={};e.printVariable=!1,e.setPrint=function(){var b=a.defer();return e.printVariable=!0,b.resolve(e.printVariable),b.promise};var f={},g=function(a){var b=function(){d.saveLater({marksheets:f})};a.onChange(b)};return e.addStudent=function(a,c){var d={columns:[],studentId:c};angular.forEach(Marksheet.sequences,function(a){for(var c=0;a>c;){var e=new Mark,f={history:[e],mark:e.value},g=b.transform(f,Cell);d.columns.push(g),c+=1}});var e=b.transform(d,Row);a.addRow(e)},e.createMarksheet=function(a,c){var d={table:{},courseId:a};angular.forEach(c,function(a){var c={columns:[],studentId:a.id};angular.forEach(Marksheet.sequences,function(a){for(var d=0;a>d;){var e=new Mark,f={history:[e],mark:e.value},g=b.transform(f,Cell);c.columns.push(g),d+=1}});var e=b.transform(c,Row);d.table[a.id]=e});var e=b.transform(d,Marksheet);return f[a]=e,g(e),e},e.getMarksheet=function(a){if(!f.hasOwnProperty(a)){var b=c.getStudentsByCourseUnsorted(a);e.createMarksheet(a,b)}var d=f[a];return d},e.getMarksheets=function(a){var b={};return angular.forEach(a,function(a){b[a]=e.getMarksheet(a)}),b},e.getRemark=function(a){return a?-1===a?{text:"",css:"remark-verypoor"}:a>15?{text:"Excellent",css:"remark-excellent"}:a>13?{text:"Very Good",css:"remark-verygood"}:a>11?{text:"Good",css:"remark-good"}:a>10?{text:"Fair",css:"remark-fair"}:"10"===a||10===a?{text:"Average",css:"remark-average"}:a>9?{text:"Poor",css:"remark-poor"}:a>7?{text:"Poor",css:"remark-poor"}:{text:"Very Poor",css:"remark-verypoor"}:void 0},d.get("marksheets",function(a){angular.forEach(a,function(c,d){angular.forEach(c.table,function(a,d){angular.forEach(a.columns,function(c,d){angular.forEach(c.history,function(a,d){c.history[d]=b.transform(a,Mark)}),a.columns[d]=b.transform(c,Cell)}),c.table[d]=b.transform(a,Row)});var c=b.transform(c,Marksheet);a[d]=c,g(c)}),f=a}),e}function Path(){var a={default_admin:"users",default_classmaster:"classmasterMarksheet",default_teacher:"myclasses",default_registrar:"registration"},b={};return b.get=function(c){if("login"===c.page||"login404"===c.page){c.username=c.username?c.username:null;var d=c.page+"/"+c.username+"/"+c.accessCode;return d}if("register"===c.page)return"/register/"+c.username;if(a.hasOwnProperty(c.page))return c.page=a[c.page],b.get(c);var d=c.page+"/"+c.subpage+"/"+c.formIndex+"/"+c.deptId+"/"+c.groupId+"/"+c.subjectId+"/"+c.termIndex+"/"+c.studentId+"/"+c.username+"/"+c.accessCode;return d},b}function MockData(a,b,c,d,e,f,g,h){var i=(b.all(),c.getAll(),d.getAll(),e.getAll(),function(a,b){return Math.floor(Math.random()*(b-a)+a)});window._mock={},window._mock.students={},window._mock.payments={},window._mock.students.destroy=g.destroy,window._mock.payments.destroy=h.destroy,window._mock.students.create=function(h){var j={docs:[]};f.getBatch(h).then(function(k){console.log("Got batch uids",k),j=_.map(k,function(f){var g=Object.keys(b.all()),h=Object.keys(c.getAll()),j=Object.keys(d.getAll()),k=Object.keys(e.getAll()),l=["Female","Male"],m={first_name:Faker.Name.firstName(),last_name:Faker.Name.lastName(),gender:l[i(0,2)]},n={name:m.first_name+" "+m.last_name,sex:m.gender,birth:Faker.Date.past(500),parentName:Faker.Name.findName(),parentPhone:Faker.PhoneNumber.phoneNumber(),parentEmail:Faker.Internet.email(),formIndex:g[i(0,g.length)],groupId:j[i(0,j.length)],feeId:k[i(0,k.length)],deptId:h[i(0,h.length)]},o=new a.Student(n);return o.id=f.value,o}),console.log("Mocking batch students: ",j),g.saveBatch(j).then(function(a){console.log("saved "+h+" students",a),f.save(k[k.length-1])}).catch(function(a){console.log("Failed to save batch students",a)})})}}function Data(a,b,c){var d,e={version:"",users:"",students:"",coursecatalog:"",timetable:"",uid:"",marksheets:"",departments:"",fees:"",groups:""},f={},g={student:null,schoolman:null},h={},i={},j={};c.get("schoolinfo").then(function(a){d=a}).catch(function(){console.log("unable to retrieve school info")}),i.get=function(a,b){if(h.hasOwnProperty(a))b(h[a]);else{var c={};b(c)}j.hasOwnProperty(a)||(j[a]=[]),j[a]=b},i.set=function(a,b){return h[a]=b,h[a]},i.save=function(a,b){console.log("Saving, ",a);var c=function(a,c){var d=angular.toJson(c),e={type:"application/json"},f=new Blob([d]),h=g[a];h.onwriteend=function(){0===h.length?h.write(f,e):i.logEstimateSize(),b("ok")},h.onerror=function(a){console.log("Write failed: "+a.toString())},h.truncate(0)};a&&angular.forEach(a,function(a,b){h[b]=a}),c("schoolman",h)},i.logEstimateSize=function(){var a=0;angular.forEach(e,function(b,c){a=c.length>a?c.length:a});var c=[],d=function(a){var b="";return b=1e3>a?a+" B":1e6>a?a/1e3+" K":a/1e6+" M"},f=0;c.push("Estimated Data Size"),c.push("---------------------------"),angular.forEach(h,function(b,g){if(e.hasOwnProperty(g)){var h=a-g.length+1,i=Array(h).join(" ")+g+" : ",j=0;b&&(j=angular.toJson(b).length);var k=d(j);c.push(i+k),f+=j}}),c.push(Array(a-5+1).join(" ")+"Total : "+d(f)),b.debug(c.join("\n"))},i.saveLater=function(a){angular.forEach(a,function(a,b){h[b]=a,f.hasOwnProperty(b)?(f[b].n+=1,f[b].timeAdded=new Date):(f[b]={},f[b]._id=b,f[b].n=1,f[b].timeAdded=new Date),console.log("Updates saved for write:",f)})},i.loadFile=function(a,b){console.log("Data service loading entry: ",a),a?a.file(function(a){var c=new FileReader;c.onload=function(a){var c=a.target.result;h=angular.fromJson(c),b(!0),angular.forEach(h,function(a,b){e.hasOwnProperty(b)||delete h[b]})},c.readAsText(a)}):b(!1)};var k=function(a,b){b.createWriter(function(b){g[a]=b})};i.loadWorkspace=function(a,b){console.log("Data service loading workspace: ",a),chrome.fileSystem.restoreEntry(a,function(a){console.log("restored entry",a);var c=a.createReader(),e={};c.readEntries(function(a){angular.forEach(a,function(a){e[a.name]=a}),"gths"===d.mode.toLowerCase()?(k("schoolman",e["gths.data"]),i.loadFile(e["gths.data"],function(a){b(a)})):"ghs"===d.mode.toLowerCase()?(k("schoolman",e["ghs.data"]),i.loadFile(e["ghs.data"],function(a){b(a)})):b("File failed to load"),console.log("read entry schoolman",e)})})},i.load=function(a,b){console.log("Data service loading entry: ",a),chrome.fileSystem.restoreEntry(a,function(a){a?(a.createWriter(function(a){fileWriter=a,window.fileWriter=a}),a.file(function(a){var c=new FileReader;c.onload=function(a){var c=a.target.result;h=angular.fromJson(c),b(!0),angular.forEach(h,function(a,b){e.hasOwnProperty(b)||delete h[b]})},c.readAsText(a)})):b(!1)})};return i}function Location(a,b,c){var d={};return d.open=function(d){console.log("Ok so far: ",d);var e=angular.copy(b);angular.forEach(d,function(a,b){e[b]=a});var f=c.get(e);console.log("Location.open: ",f),a.path(f)},d}function $model(){var a={};return a.extend=function(b){return angular.forEach(arguments,function(c){c!==b&&angular.forEach(c,function(c,d){b[d]&&b[d].constructor&&b[d].constructor===Object?a.extend(b[d],c):b[d]=c})}),b},a}function Cache(){var a={};return a.cache={},a.set=function(b){angular.forEach(b,function(b,c){a.cache[c]=b})},a.get=function(b){var c=void 0;return a.cache.hasOwnProperty(b)&&(c=a.cache[b]),c},a}function modelTransformer(a,b){var c=function(a,c){var d=new c;return b.extend(d,a),"function"==typeof d.onLoad&&d.onLoad(),d},d=function(a,b){if(angular.isArray(a)){var d=[];return angular.forEach(a,function(a){d.push(c(a,b))}),d}return c(a,b)},e={};return e.transform=d,e}function Uid(a,b,c){var d=7,e={},f=function(a){for(var c=a,e=a.value,f=parseInt(e.substr(1))+1,g=f.toString();g.length<d;)g="0"+g;var h="U"+g;return h.length<8&&(b.error("n",f),b.error("s",g),b.error("u",h)),c.value=h,c};return e.save=function(a){console.log("saving uid",a),c.put(a).then(function(a){console.log("saved lastUid",a)}).catch(function(a){console.log("error: save lastUid",a)})},e.get=function(){var b=a.defer();return c.get("UID").then(function(a){b.resolve(f(a))}).catch(function(a){if(console.log("UID Error",a),404===a.status){var c={_id:"UID",value:"U0000000"};b.resolve(f(c))}}),b.promise},e.getBatch=function(b){var c=a.defer(),d=[];return e.get().then(function(a){d.push(angular.copy(a)),angular.forEach(_.range(b-1),function(){a=f(a),d.push(angular.copy(a))}),console.log("Created uids",d),c.resolve(d)}).catch(function(a){console.log("Failed to get batch UIDs",a),c.reject(a)}),c.promise},e}function Departments(a,b,c,d,e){var f={},g={};return g.getAll=function(){var a={};return angular.forEach(f,function(b,c){a[c]=b}),a},g.get=function(a){return f[a]},g.set=function(a,b){f[b]=a},g.add=function(a){if(console.log("inside department add function"),f.hasOwnProperty(a.code))throw new e("departments",a.code);f[a.code]=a,console.log("added department")},g.remove=function(c){var d=a.defer();return b.remove(c).then(function(a){console.log("Department removed: ",a),delete f[c._id],d.resolve(a)}).catch(function(a){$log.error("departments.js : remove :",a),d.reject(a)}),d.promise},g.save=function(){Data.saveLater({departments:f})},g.load=function(){var e=a.defer(),g=function(a,b){a.datatype===d.Department.datatype._id&&b(a._id,{_id:a.datatype,data:a})};return b.query(g,{include_docs:!0}).then(function(a){angular.forEach(a.rows,function(a){var b=a.doc,e=d.parse(a.value.data,b),g=c.transform(e,d.Department);f[g._id]=g}),console.log("Departments:Query success",f),e.resolve(f)}).catch(function(a){console.log("Departments: Query failed",a),e.reject(a)}),e.promise},g}function Fees(a,b,c,d,e,f,g){var h={},i={};return i.get=function(a){return h[a]},i.getAll=function(){return h},i.remove=function(a){d.remove(a).then(function(b){console.log("Fee removed: ",b),delete h[a._id]}).catch(function(a){g.error("fees.js : remove :",a)})},i.load=function(){var b=a.defer(),f=function(a,b){a.datatype===c.Fee.datatype._id&&b(a._id,{_id:a.datatype,data:a})};return d.query(f,{include_docs:!0}).then(function(a){angular.forEach(a.rows,function(a){var b=a.doc,d=c.parse(a.value.data,b),f=e.transform(d,c.Fee);h[f._id]=f}),b.resolve(h)}).catch(function(a){console.log("Failed to load Fees: ",a),b.reject(a)}),b.promise},i}function Groups(a,b,c,d,e){var f={},g={};return g.getAll=function(){return f},g.get=function(a){return f[a]},g.save=function(){Data.saveLater({groups:f})},g.remove=function(a){c.remove(a).then(function(b){console.log("Group removed: ",b),delete f[a._id]}).catch(function(a){$log.error("groups.js : remove :",a)})},g.add=function(a){a.code=b.slugify(a.name),f[a.code]=a},g.load=function(){var b=a.defer(),g=function(a,b){a.datatype===d.Group.datatype._id&&b(a._id,{_id:a.datatype,data:a})};return c.query(g,{include_docs:!0}).then(function(a){angular.forEach(a.rows,function(a){var b=a.doc,c=d.parse(a.value.data,b),g=e.transform(c,d.Group);f[g._id]=g}),b.resolve(f)}).catch(function(a){b.reject(a)}),b.promise},g}function Forms(a,b){var c={gths:{0:"Form 1",1:"Form 2",2:"Form 3",3:"Form 4",4:"Form 5",5:"Form 6",6:"Form 7"},ghs:{0:"Form 1",1:"Form 2",2:"Form 3",3:"Form 4",4:"Form 5",5:"Lower Sixth",6:"Upper Sixth"}},d={0:new a.Form({name:c[b.mode][0]}),1:new a.Form({name:c[b.mode][1]}),2:new a.Form({name:c[b.mode][2]}),3:new a.Form({name:c[b.mode][3]}),4:new a.Form({name:c[b.mode][4]}),5:new a.Form({name:c[b.mode][5]}),6:new a.Form({name:c[b.mode][6]})},e={};return e.all=function(){return angular.copy(d)},e}function SubjectTypes(){var a=["General","Specialized","Other"],b={};return b.all=function(){return a},b}function profile(a,b,c,d,e){var f={};return f.getComments=function(b){var f=a.defer(),g=function(a,d){a.datatype===c.Comment.datatype._id&&c.parse(a,c.Comment.datatype).studentId===b&&d(a._id,{_id:a.datatype,data:a})};return d.query(g,{include_docs:!0}).then(function(a){var b=[];angular.forEach(a.rows,function(a){var d=a.doc,f=c.parse(a.value.data,d),g=e.transform(f,c.Comment);b.push(g)}),console.log("Comments Query: succeeded",b),f.resolve(b)}).catch(function(a){f.reject("Comments Query: failed",a)}),f.promise},f.removeComment=function(b){var c=a.defer();return d.remove(b).then(function(a){c.resolve(a)}).catch(function(a){$log.error("profile.js : removeComment :",a),c.reject(a)}),c.promise},f}function Marksheets(a,b,c,d,e,f,g){var h={};return h.getID=c.Marksheet.getId,h.getSequences=function(a){var b=[];if("3"===a||3===a)b=[0,1,2,3,4,5];else{var c=0;c=2*(parseInt(a)+1),b=[c-2,c-1]}return b},h.listify=function(a){var b=Object.keys(a).map(function(b){var c=angular.copy(a[b]);return angular.forEach(c,function(a,b){c[b]=parseFloat(a)}),[b].concat(c)});return b},h.ave=function(a,b){var c=a.map(function(a){var c=[a[0],0],d=0,e=!1,f=0;return angular.forEach(b,function(b){var c=parseFloat(a[b+1]);"number"!=typeof c||isNaN(c)||(d+=c,e=!0),f+=1}),c[1]=e===!0?d/f:-1,c});return c},h.dict=function(a){var b={};return angular.forEach(a,function(a){b[a[0]]=a.slice(1)}),b},h.rank=function(a){var b=(h.listify(a),function(a){var b=angular.copy(a);return b.sort(function(a,b){return parseFloat(b[1])-parseFloat(a[1])}),b}),c=function(a){var b=[];return angular.forEach(a,function(c,d){c[1]>=0&&(b[d]=[c[0]],b[d][1]=0===d?1:c[1]===a[d-1][1]?b[d-1][1]:d+1)}),b},d=function(a){var b={};return angular.forEach(a,function(a,c){angular.forEach(a,function(a,d){b.hasOwnProperty(d)||(b[d]=[]),b[d][c]=a[0]})}),b},e=h.ave,f=h.dict,g=h.listify,i=f(c(b(e(g(a.table),[0,1])))),j=f(c(b(e(g(a.table),[2,3])))),k=f(c(b(e(g(a.table),[4,5])))),l=f(c(b(e(g(a.table),[0,1,2,3,4,5])))),m=d([i,j,k,l]);return m},h.combine=function(a){var b=a[0],d=a.slice(1),e=new c.Marksheet;return e.coeff=b.coeff,e.table=angular.copy(b.table),angular.forEach(e.table,function(a){a.coeff=""!==a[0]||""!==a[1]||""!==a[2]||""!==a[3]||""!==a[4]||""!==a[5]?e.coeff:0}),_.reduce(d,function(a,b){var c=angular.copy(a.table),d=b.table,f=["",null,void 0];return angular.forEach(d,function(d,e){var g=0,h=0,i=0;c.hasOwnProperty(e)?angular.forEach(d,function(d,j){i+=1;var k=c[e][j];if(f.indexOf(k)>-1)c[e][j]=d,g+=1;else if(f.indexOf(d)>-1)h+=1;else{if(a.table[e].coeff)var l=k*a.table[e].coeff,m=a.table[e].coeff+b.coeff;else var l=k*a.coeff,m=a.coeff+b.coeff;var n=d*b.coeff,o=(l+n)/m;c[e][j]=o}}):c[e]=d,a.table[e]&&a.table[e].coeff?c[e].coeff=a.table[e].coeff:(c[e].coeff=0,g!==i&&(c[e].coeff+=a.coeff)),h!==i&&(c[e].coeff+=b.coeff)}),e.table=c,e.coeff=a.coeff+b.coeff,e},e)},h.summarize=function(a,b){var c=h.listify(a.table),d=h.ave(c,h.getSequences(b));return h.dict(d)},h.summarizeBySex=function(a,b){var c=(angular.copy(a),h.listify(a.table)),d=h.ave(c,h.getSequences(b)),e=h.dict(d),g=Object.keys(e);f.getBatch(g).then(function(b){var b=_.map(Object.keys(b),function(a){return b[a]}),c={},d={};return angular.forEach(b,function(a){"Male"===a.sex?c[a._id]=e[a._id]:d[a._id]=e[a._id]}),a.maleTable=c,a.femaleTable=d,delete a.table,console.log("marksheet copy",a),a}).catch(function(b){return console.log("Failed to find students: ",b),a})},h.create=function(b){var d=a.defer(),e=new c.Marksheet(b);return e.save().then(function(a){console.log("Marksheet saved",a,e),d.resolve(e)}).catch(function(a){console.log("Failed to create marksheet",a,e),d.reject(a)}),d.promise},h.createOrUpdate=function(b,c){var d=a.defer();return h.get(b).then(function(a){var b=a.marksheet;console.log("Found marksheet, updating",b),b.teacherId=c,b.save().then(function(){d.resolve(b)}).catch(function(a){d.resolve(a)})}).catch(function(a){404===a.status&&(console.log("Marksheet not found, creating",a),h.create({_id:b,teacherId:c}).then(function(a){d.resolve(a)}).catch(function(a){d.reject(a)}))}),d.promise},h.get=function(b){var d=a.defer(),e={};return g.get(b).then(function(a){console.log("Received Data",a);var b=c.parse(a,c.Marksheet.datatype);console.log("Parse check",a,b);var g=e.marksheet=new c.Marksheet(b);console.log("Got marksheetData",g);var h=angular.copy(g),i={formIndex:g.formIndex,deptId:g.deptId,groupId:g.groupId};f.query(i).then(function(a){var b=_.map(Object.keys(g.table),function(a){return a}),c=_.map(a,function(a){return a._id}),f=_.difference(c,b);angular.forEach(f,function(a){g.table[a]=["","","","","",""]}),e.students=a,angular.equals(g,h)?d.resolve(e):(console.log("What is the status",g,h),g.save().then(function(a){console.log("Apparent success",a),d.resolve(e)}).catch(function(a){console.log("There was a problem adding new students to the marksheet",a)}))})}).catch(function(a){console.log("Failed to get marksheet",a),d.reject(a)}),d.promise},h.query=function(b){var e=a.defer(),f=c.Marksheet,h=function(a,d){if(a.datatype===f.datatype._id){var e=c.parse(a,f.datatype),g=!0;angular.forEach(b,function(a,b){"formIndex"===b&&(a=parseInt(a)),g=e[b]===a?g:!1}),g&&d(a._id,{_id:a.datatype,data:a})}};return g.query(h,{include_docs:!0}).then(function(a){var b=[];angular.forEach(a.rows,function(a){var e=a.doc,g=c.parse(a.value.data,e),h=d.transform(g,f);b.push(h)}),e.resolve(b)}).catch(function(){}),e.promise},h.validateCell=function(a){var b="number-valid";return(a>20||0>a)&&(b="number-invalid"),b},h.getReports=function(b){var d=a.defer();return h.query({formIndex:b.formIndex,deptId:b.deptId,groupId:b.groupId}).then(function(a){if(a.length>0){var b={};b.subjects={};var f=e.getAll();angular.forEach(a,function(a){var d=c.Subject.types[f[a.subjectId].type];b.subjects.hasOwnProperty(d)||(b.subjects[d]={}),b.subjects[d][a._id]={marksheet:a,summary:h.summarize(a,3),ranking:h.rank(a)}});var g=[];angular.forEach(b.subjects,function(a){var b={},c=_.map(Object.keys(a),function(b){return a[b].marksheet});b.marksheet=h.combine(c),g.push(b.marksheet),b.summary=h.summarize(b.marksheet,0),b.rankings=h.rank(b.marksheet),a.total=b}),b.total={},b.total.marksheet=h.combine(g),b.total.summary=h.summarize(b.total.marksheet,3),b.total.rankings=h.rank(b.total.marksheet),d.resolve(b)}else d.reject("no marksheets found")}).catch(function(a){console.log("Failed to get Marksheets",a),d.reject(a)}),d.promise},h}function Students(a,b,c,d){var e=b.Student.db;"string"==typeof e&&(e=d.create(b.Student.db));var f={};self={};var g=b.Student;return console.log("Students data model",g.datatype),self.set=function(a){f[a._id]=a},self.getBatch=function(b){var c=a.defer(),d=[];return angular.forEach(b,function(a){f[a]&&d.push(f[a])}),c.resolve(d),c.promise},self.saveBatch=function(b){var c=a.defer(),d={docs:_.map(b,function(a){return a.normalize(),a.saveable()})};return console.log("Saving batch: ",d),e.bulkDocs(d).then(function(a){console.log("Students service saved batch",a),c.resolve(a),f=_.reduce(b,function(a,b){return a[b._id]=b,a},f)}).catch(function(a){c.reject(a)}),c.promise},self.query=function(b){b=b||{};var c=a.defer(),d=_.map(Object.keys(f),function(a){return f[a]}),e=[];return e=Object.keys(b).length>0?_.filter(d,function(a){var c=!0;return angular.forEach(b,function(b,d){a[d]!==String(b)&&(c=!1)}),c}):d,console.log("Filtering students",b,f),console.log("Filtered students",b,e),c.resolve(e),c.promise},self.get=function(b){var c=a.defer();return f.hasOwnProperty(b)?c.resolve(f[b]):c.reject("Student does not exist"),c.promise},self.load=function(){var c=a.defer();return e.allDocs({starKey:"student_",endKey:"student__"}).then(function(a){var b=_.map(a.rows,function(a){return a.key});return console.log("Got keys",b),c.resolve(f),b}).then(function(a){angular.forEach(a,function(a){e.get(a).then(function(a){var c=b.parse(a,g.datatype);c=new b.Student(c),f[c._id]=c}).catch(function(a){console.log("Failed to get student",a)})}),c.resolve(f)}).catch(function(a){c.reject(a)}),c.promise},self.destroy=function(){e.destroy().then(function(){console.log("Destroyed students db")}).catch(function(a){console.log("failed to destroy studetns db",a)})},self.getAll=self.query,self}function Payments(a,b,c,d,e,f){var g=b.Payment.db;return"string"==typeof g&&(g=f.create(b.Payment.db)),self={},self.getAll=function(){var c=a.defer(),d=function(a,c){var d=b.Payment;if(a.datatype===d.datatype._id){var e=b.parse(a,d.datatype);c(a._id,{_id:e.studentId,data:a})}};return g.query(d,{include_docs:!0}).then(function(a){var d={},f=(b.Student,b.Payment);console.log("Payments Success: ",a),angular.forEach(a.rows,function(a){var c=a.value._id;if(!d.hasOwnProperty(c)){var g=e.get(c);g.payments=[],d[c]=g}var h=b.parse(a.value.data,f.datatype);d[c].payments.push(h)}),c.resolve(d)}).catch(function(a){c.reject("Query: failed",a)}),c.promise},self.query=function(d){var e=a.defer(),f=b.Payment,h=function(a,c){if(a.datatype===f.datatype._id){var e=b.parse(a,f.datatype),g=!0;angular.forEach(d,function(a,b){g=e[b]===a?g:!1}),g&&c(a._id,{_id:a.datatype,data:a})}};return g.query(h,{include_docs:!0}).then(function(a){var d=[];angular.forEach(a.rows,function(a){var e=(a.doc,b.parse2(a.value.data,a.value._id)),g=c.transform(e,f);d.push(g)}),e.resolve(d)}).catch(function(a){e.reject("Query: failed",a)}),e.promise},self.destroy=function(){g.destroy().then(function(){console.log("Destroyed paymentss db")}).catch(function(a){console.log("failed to destroy payments db",a)})},self}function Subjects(a,b,c,d){var e={},f={};return f.getAll=function(){return e},f.get=function(a){return e[a]},f.remove=function(a){b.remove(a).then(function(b){console.log("Subject removed: ",b),delete e[a._id]}).catch(function(a){$log.error("subjects.js : remove :",a)})},f.load=function(){var f=a.defer(),g=function(a,b){a.datatype===d.Subject.datatype._id&&b(a._id,{_id:a.datatype,data:a})};return b.query(g,{include_docs:!0}).then(function(a){console.log("Subjects:Data success",a),angular.forEach(a.rows,function(a){var b=a.doc,f=d.parse(a.value.data,b),g=c.transform(f,d.Subject);e[g._id]=g}),console.log("Subjects:Query success",e),f.resolve(e)}).catch(function(a){console.log("Subjects: Query failed",a),f.reject(a)}),f.promise},f}function Users(a,b,c,d,e,f,g){var h={},i={};return i.login=function(a,b,c){var d=null,f=g.slugify(a.fullname),i=e.encrypt(a.password);if(h.hasOwnProperty(f)){var d=h[f];d.password===i?c({status:200,user:d,message:"ok"}):(console.log("Password doesnt match:",d.password,i),c({status:401,user:void 0,message:"The password is incorrect: "+i}))}else c({status:404,user:void 0,message:"Username not found: "+f});return void 0},i.getAll=function(){return h},i.get=function(a){return h[a]},i.add=function(a){if(console.log("inside user add function"),h.hasOwnProperty(a.code))throw new f("users",a.code);h[a.code]=a,console.log("added user")},i.remove=function(a){c.remove(a).then(function(b){console.log("User removed: ",b),delete h[a._id]}).catch(function(a){b.error("users.js : remove error:",a)})},i.load=function(){var b=a.defer(),f=function(){var a=new e.User({fullname:"Admin",username:"admin",password:e.encrypt("admin123"),_id:"user_admin"});a.access.admin=1,a.access.teacher=0,a.save().then(function(){h[a.username]=a,b.resolve(h)}).catch(function(a){console.log("Failed to create superuser",a),b.reject(a)})},g=function(a,b){a.datatype===e.User.datatype._id&&b(a._id,{_id:a.datatype,data:a})};return c.query(g,{include_docs:!0}).then(function(a){console.log("Users:Query success",a),0===a.total_rows?f():angular.forEach(a.rows,function(a){var c=a.doc,f=e.parse(a.value.data,c),g=d.transform(f,e.User);h[g.username]=g,b.resolve(h)})}).catch(function(a){console.log("Users: Query failed",a),404===a.status?f():b.reject(a)}),b.promise},i}function Terms(){var a={0:{name:"Term 1"},1:{name:"Term 2"},2:{name:"Term 3"}},b={};return b.getAll=function(){return angular.copy(a)},b}function ClassCouncils(a,b,c,d,e){var f={},g={};return f.getAll=function(){return g},f.get=function(b){var e=a.defer();return d.get(b).then(function(a){var b=c.parse2(a,a.datatype),d=new c.ClassCouncil(b);e.resolve(d)}).catch(function(a){e.reject(a)}),e.promise},f.query=function(b){var f=a.defer(),h=function(a,d){a.datatype===c.ClassCouncil.datatype._id&&c.parse(a,c.ClassCouncil.datatype).classId===b&&d(a._id,{_id:a.datatype,data:a})};return d.query(h,{include_docs:!0}).then(function(a){angular.forEach(a.rows,function(a){var b=a.doc,d=c.parse(a.value.data,b),f=e.transform(d,c.ClassCouncil);g[f._id]=f}),console.log("ClassCouncils Query: succeeded",g),f.resolve(g)}).catch(function(a){f.reject("ClassCouncils Query: failed",a)}),f.promise},f}function Dcards(a,b,c){var d={},e=function(a){var b=c.parse2(a,a.datatype),d=new c.Dcard(b);return d},f=function(c){var d=a.defer();return b.get(c.generateID()).then(function(a){d.resolve(e(a))}).catch(function(a){(a.status=404)?c.save().then(function(){d.resolve(c)}).catch(function(a){d.reject(a)}):d.reject(a)}),d.promise};return d.get=function(a){var b=new c.Dcard({studentId:a,year:"2014"});return f(b)},d}function settings(a,b,c){console.log("model service",b);var d=new b.Settings,e={};return e.get=function(){return d},e.load=function(){var e=a.defer();return c.get("customer_settings").then(function(a){var c=b.parse2(a,a.datatype);d=new b.Settings(c),e.resolve(d)}).catch(function(a){404===a.status&&e.resolve(d)}),e.promise},e}function SchoolInfos(a,b,c){var d={},e=function(a){var b=c.parse2(a,a.datatype),d=new c.SchoolInfo(b);return d};return d.get=function(){var d=a.defer();return b.get("schoolinfo").then(function(a){d.resolve(e(a))}).catch(function(a){if(404===a.status){var b=new c.SchoolInfo({nameEn:"Name (English)",nameFr:"Name (French)",division:"MEZAM DIVSION"});
b.save().then(function(){d.resolve(b)}).catch(function(a){d.reject(a)})}else d.reject(a)}),d.promise},d}function LoadingCtrl(a,b,c,d,e,f,g,h,i,j,k,l){var m=(new l.SchoolInfo,k.load()),n=j.load(),o=i.load(),p=g.load(),q=e.load(),r=h.load(),s=d.load(),t=(new l.ClassCouncil,[m,p,r,q,o,n,s]);c.all(t).then(function(a){console.log("Successes",a),b.open({page:"login"})})}function MastersheetCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.termIndex=parseInt(b.termIndex),a.open=q.open;a.data={};a.data.marksheets=[],a.data.subjects=c.getAll(),a.data.summaries={},a.data.students=[],a.data.rankings={},a.round=Math.round,a.data.view="mastersheet",a.setGraphView=function(b){a.data.view=b};var r={formIndex:b.formIndex,deptId:b.deptId,groupId:b.groupId};console.log("Querying marksheet params: ",r),f.query(r).then(function(c){console.log("Got marksheets: ",c),a.data.marksheets=_.map(Object.keys(c),function(a){return c[a]}),a.data.summaries=_.map(c,function(b){var c=f.summarize(b,a.termIndex);return console.log("Marksheet has been summarized: ",b,c),c}),a.data.combinedMarksheet=f.combine(a.data.marksheets),console.log("combined marksheet",a.data.combinedMarksheet),a.data.summarysheet=f.summarize(a.data.combinedMarksheet,a.termIndex),a.data.rankings=f.rank(a.data.combinedMarksheet);var e=_.union(_.reduce(a.data.summaries,function(a,b){return a.concat(Object.keys(b))},[]));d.getBatch(e).then(function(b){console.log("students",b),a.data.students=_.map(Object.keys(b),function(a){return b[a]})}).catch(function(a){console.log("Failed to find students: ",a)});var g={top:20,right:40,bottom:30,left:40},h=1100-g.left-g.right,i=500-g.top-g.bottom,j=d3.scale.ordinal().rangeRoundBands([0,h],.1),k=d3.scale.linear().range([i,0]),l=d3.svg.axis().scale(j).orient("bottom"),m=d3.svg.axis().scale(k).orient("left").ticks(10,""),n=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<table><tr><td style='text-align:right;'>Subject:</td><td class='tip-subject'>"+a.name+"</td></tr><tr><td style='text-align:right;'>Average:</td><td class='tip-average'>"+a.average.toFixed(2)+"</td></tr></table>"}),o=d3.select(".d3-barchart").append("svg").attr("width",h+g.left+g.right).attr("height",i+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")");o.call(n);var p=_.map(a.data.marksheets,function(c){var d={};d.subject=a.data.subjects[c.subjectId].code,d.name=a.data.subjects[c.subjectId].en;var e=f.summarize(c,b.termIndex);console.log("Summary ok",e);var g=_.reduce(e,function(a,b){return a+b[0]},0),h=g/Object.keys(e).length;return console.log("Summary",e,h),d.average=h,d});j.domain(p.map(function(a){return a.subject})),k.domain([0,20]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(l),o.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Class Average"),o.selectAll(".bar").data(p).enter().append("rect").attr("class","bar").attr("x",function(a){return j(a.subject)}).attr("width",j.rangeBand()).attr("y",function(a){return k(a.average)}).attr("height",function(a){return i-k(a.average)}).on("mouseover",n.show).on("mouseout",n.hide)}).catch(function(a){console.log("Failed to find marksheets",a)})}function MainCtrl(a,b,c,d,e,f,g,h,i,j,k,l){a.page=d.page,a.view=d.view,a.accessCode=d.accessCode,c(),a.forms=i.getForms(),a.form=a.forms[d.formIndex],a.groups=i.getGroups(),a.group=a.groups[d.groupIndex],a.subjects=i.getSubjects(d.formIndex),a.subject=a.subjects[d.subjectKey],a.terms=i.getTerms(),a.term=a.terms[d.termIndex],a.termIndex=d.termIndex,a.courseId=i.getCourseId(d),a.username=d.username,a.teacher=e.get("user"),a.students=k.getStudentsByCourse(a.courseId),a.student=k.getStudent("0"===d.studentId?a.students[0].id:d.studentId),a.marksheet=l.getMarksheet(a.courseId),a.marksheets={},angular.forEach(a.subjects,function(b,c){var e={formIndex:d.formIndex,groupIndex:d.groupIndex,subjectKey:c};a.marksheets[c]=l.getMarksheet(i.getCourseId(e))}),a.open=g.open,a.getMarksheet=function(b){return a.marksheets[b]},a.getRemark=function(a){return l.getRemark(a)},a.getCourseId=function(a){var b=angular.copy(d);return angular.forEach(a,function(a,c){b[c]=a}),i.getCourseId(b)},a.getTeacher=function(b){var c=a.getCourseId({subjectKey:b}),d=j.getTeacher(c),e=d.username||"",g={};return f.get("users",function(a){var b=a[e];g.fullname=b?b.fullname:""}),g},a.getStudentsByCourse=k.getStudentsByCourse,a.courses=i.getCoursesByRef(j.getCourseRefs(d.username));var m=function(){a.courses=i.getCoursesByRef(j.getCourseRefs(d.username))};a.addBookmark=function(){j.addBookmark(a.courseId,a.username),m()},a.removeBookmark=function(a){j.removeBookmark(a),m()},a.logout=function(){g.open({page:"login",username:null,accessCode:"teacher"})},a.login=function(a){g.open({page:"default_"+a,accessCode:a})};var n=function(a,b){return a===b.split("/")[1]};a.activeIfPage=function(a){var c="";return n(a,b.path())&&(c="active"),c};var o=function(b){var c={};c.table={students:{}},c.getAverage=function(a,c){var e=i.getCourseId({formIndex:d.formIndex,groupIndex:d.groupIndex,subjectKey:c}),f=b[e],g=f.getAverage(a,d.termIndex);return g},c.getAc=function(b,d){return c.getAverage(b,d)*a.subjects[d].coeff},c.getTotalCoeff=function(){var b=0;return angular.forEach(a.subjects,function(a){b+=a.coeff}),b},c.getAcTotal=function(a){var b=0;return angular.forEach(c.table.students[a],function(a){b+=a.ac}),b},angular.forEach(a.students,function(a){c.table.students[a.id]={},c.table.totalCoeff=c.getTotalCoeff(),angular.forEach(b,function(b,d){var e=i.getSubjectKey(d);c.table.students[a.id][e]={average:c.getAverage(a.id,e),ac:c.getAc(a.id,e)}}),c.table.students[a.id].acTotal=c.getAcTotal(a.id),c.table.students[a.id].acAverage=c.table.students[a.id].acTotal/c.table.totalCoeff});var e=[];return angular.forEach(c.table.students,function(a,b){e.push({studentId:b,student:a})}),e.sort(function(a,b){return b.student.acAverage-a.student.acAverage}),angular.forEach(e,function(a,b){a.student.rank=0===b?1:a.student.acAverage===e[b-1].acAverage?e[b-1].rank:b+1}),c};a.getMastersheet=function(a){var b=d.formIndex,c=d.groupIndex;a&&(b=a.hasOwnProperty("formIndex")?a.formIndex:b,c=a.hasOwnProperty("groupIndex")?a.groupIndex:c);var e=i.getCourses(b,c),f=e.map(function(a){return a.id}),g=l.getMarksheets(f),h=o(g);return h},a.allSubjects=i.getAllSubjects(),a.numSubjects=Object.keys(a.allSubjects).length,a.catalogView="student",a.setCatalogView=function(b){a.catalogView=b},a.toggleSubject=function(b,c){var d=a.forms[c].subjects[b];a.forms[c].subjects[b]=(d+1)%2},a.isExempt=function(a,b){return console.log(a,":",b),0===b?!0:!1},a.addSubject=function(){},a.getStudentsPassing=function(b){return angular.forEach(a.groups,function(c,d){var e=a.getMastersheet({formIndex:b,groupIndex:d});console.log("Mastersheet for ",a.forms[b].name,e)}),0},"transcript"===a.page&&window.print()}function MenuCtrl(a,b,c,d,e,f,g,h,i,j,k){a.show={backButton:!1},a.ClassMaster=k,a.route=c,a.print=function(){k.printVariable=!1,"reportcardGTHS"===c.page?a.openModal("print"):window.print()},a.export=function(){var b=a.openModal("export");console.log("modal ",b),e.when(j.export()).then(function(){b.close()})},a.import=function(){var b=a.openModal("import");console.log("modal ",b),e.when(j.import()).then(function(){console.log("success importing"),b.close()})},a.back=function(){a.show.backButton=!1,a.open({page:"reportcard"})},a.logout=function(){g.open({page:"login",username:null,accessCode:"teacher"})},a.cache=i.cache,a.username=c.username,a.open=function(a){var d=angular.copy(c);angular.forEach(a,function(a,b){d[b]=a}),console.log("newParams ",d);var e=h.get(d);console.log("Open: ",e),b.path(e)},a.openModal=function(a){var b;return"print"===a?b=d.open({templateUrl:"printModal.html",controller:l}):"export"===a?b=d.open({templateUrl:"exportModal.html",controller:m}):"import"===a&&(b=d.open({templateUrl:"importModal.html",controller:m})),b.result.then(function(){},function(){f.info("Modal dismissed at: "+new Date)}),b};var l=function(a,b,c){a.ClassMaster=c,a.ok=function(){b.close(),window.print(),c.printVariable=!1},a.cancel=function(){b.dismiss("cancel")}};l.$inject=["$scope","$modalInstance","ClassMaster"];var m=function(a,b){a.close=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}};m.$inject=["$scope","$modalInstance"]}function NavbarCtrl(a,b,c,d){a.username=c.username,a.teacher=d.user;var e=function(a,b){return a===b.split("/")[1]};a.activeIfPage=function(a){var c="";return e(a,b.path())&&(c="active"),c},a.open=function(a){console.log("Open: ",a),b.path(a)}}function LoginCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n){console.log("Hows the call stack?"),console.log("Departments: ",h),d.info("Path: ",b.path());var o={admin:{page:"users"},classmaster:{page:"classmasterMarksheet"},registrar:{page:"registration"},teacher:{page:"myclasses"}};if(a.open=m.open,a.page=c.page,a.status=200,a.accessLevels=j.User.roles,a.access=a.accessLevels[c.accessCode],a.settings=i.get(),a.tempUser=new j.User({password:""}),a.login=function(b){var d=c.accessCode;f.login(a.tempUser,d,function(c){if(console.log("Login Data",c),200===c.status){var e=c.user;if(d="undefined"!==d&&e.hasAccess(d)?d:e.getHighestAccess(),0===a.settings.access[d]&&(d=e.getHighestAccess()),0!==a.settings.access[d]&&e.hasAccess(d)){l.set({user:e});var f=h.getAll(),i=Object.keys(n.getAll()),j=Object.keys(g.getAll());m.open({page:b||o[d].page,subpage:"null",formIndex:"0",deptId:Object.keys(f)[0],groupId:i[0],subjectId:j[0],studentId:"U0000001",termIndex:0,username:e.username,accessCode:d})}else a.status=c.status=403,c.message="Access denied.  User does not have access to any available tabs.",console.log("User does not have access to any available tabs. Access:",e.access,"Tabs:",a.settings.access)}else a.status=c.status})},a.createNewAccount=function(){m.open({page:"register",username:a.username||null})},a.checkCapsLock=function(b){var c=b.keyCode?b.keyCode:b.which,d=b.shiftKey?b.shiftKey:16===c?!0:!1;a.capsLock=c>=65&&90>=c&&!d||c>=97&&122>=c&&d?!0:!1},e.AUTO_LOGIN){a.tempUser.fullname=e.AUTO_LOGIN_USER,a.tempUser.password=e.AUTO_LOGIN_PASS,c.accessCode=e.AUTO_LOGIN_ACCESS;var p=e.hasOwnProperty("AUTO_LOGIN_PAGE")?e.AUTO_LOGIN_PAGE:void 0;a.login(p)}}function UsersCtrl(a,b,c,d,e,f){a.data={},a.data.users=c.getAll(),a.User=d.User,a.tempUser=new d.User,a.open=e.open,a.username=b.username,f.get("schoolinfo").then(function(b){a.schoolInfo=b,"gths"===a.schoolInfo.version&&(a.User.roles.classmaster.name="Head of Dept")}).catch(function(a){console.log("failed to load school info",a)}),a.addUser=function(){a.tempUser.save().then(function(b){a.data.users[b.id]=a.tempUser,a.tempUser=new d.User}).catch(function(a){console.log("Could not save user:",a)})},a.remove=c.remove}function SubjectsCtrl(a,b,c,d,e,f,g,h){a.forms=d.all(),a.allSubjects=e.getAll(),console.log("Subjects",a.allSubjects),a.numSubjects=Object.keys(a.allSubjects).length,h.get("schoolinfo").then(function(b){a.version=b.version}).catch(function(a){console.log("Failed to retrieve school info",a)});angular.copy(a.allSubjects);a.toggleSubject=function(b,c){var d=a.forms[c].subjects[b];a.forms[c].subjects[b]=(d+1)%2},a.types=g.Subject.types,a.newSubject=new g.Subject,a.addSubject=function(){a.newSubject.save().then(function(){a.allSubjects[a.newSubject._id]=a.newSubject,a.newSubject=new g.Subject})},a.remove=function(b){e.remove(b).then(function(){delete a.allSubjects[b._id]})}}function StudentsCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.PROMOTE_OPTIONS=s,a.courseId=n.getCourseId(c);var t=a.data={forms:f.all(),departments:m.getAll(),groups:g.getAll(),fees:e.getAll(),subjects:j.getAll(),students:[],selected:{},globalSelect:0,page:0,pages:[]};a.formIndex=c.formIndex,a.groupId=c.groupId,a.deptId=c.deptId,a.queryParams={formIndex:a.formIndex,groupId:a.groupId,deptId:a.deptId,feeId:"all"};var u,v,w={},x={},y=function(){var b={};angular.forEach(a.queryParams,function(a,c){var d=["all",void 0,"undefined"];-1===d.indexOf(a)&&(b[c]=a)});var c=function(a,b){var c=0;w[b].total.summary&&(c=w[b].total.summary[a._id][0]),a.passing=c>=x[b].passingScore},d=function(a,b){return(b.getTime()-a.getTime())/1e3},e=new Date;l.query(b).then(function(b){var f=new Date;console.log("TIME DIFF: ",d(e,f)),console.log("Success loading students",b),a.data.students=b,a.data.pages=_.range(b.length/10),angular.forEach(b,function(b){b.passing=!1,a.data.selected[b._id]=0;var d=[b.formIndex,b.deptId,b.groupId];w.hasOwnProperty(d)&&x.hasOwnProperty(d)&&c(b,d)})}).catch(function(a){console.log("Error loading students",a)})},z=function(a){var c={reports:h.getReports({formIndex:a.formIndex,deptId:a.deptId,groupId:a.groupId})},e={classcouncil:d.get(p.ClassCouncil.generateID({formIndex:a.formIndex,deptId:a.deptId,groupId:a.groupId}))},f=[a.formIndex,a.deptId,a.groupId];b.all(e).then(function(a){x[f]=a.classcouncil}).catch(function(){x[f]||(x[f]=new p.ClassCouncil)}),b.all(c).then(function(a){w[f]=a.reports,y()}).catch(function(a){console.log("Failed to load reports",a),y()})},A=function(a){var b=angular.copy(a);angular.forEach(b,function(a,c){"all"===a?("formIndex"===c&&(b[c]=t.forms),"deptId"===c&&(b[c]=t.departments),"groupId"===c&&(b[c]=t.groups)):b[c]=[a]}),angular.forEach(b.formIndex,function(c,d){angular.forEach(b.deptId,function(e){angular.forEach(b.groupId,function(b){c.name&&(c=d),b._id&&(b=b._id),e._id&&(e=e._id),w.hasOwnProperty(a)&&x.hasOwnProperty(a)?y():z({formIndex:c,deptId:e,groupId:b})})})})};A(a.queryParams),a.setQuery=function(b){angular.forEach(b,function(b,c){a.queryParams[c]=b}),a.data.page=0,A(a.queryParams)},a.moveTab="form",a.toggleAll=function(){angular.forEach(a.data.selected,function(b,c){a.data.selected[c]=a.data.globalSelect})},a.moveSelected=function(a){var b=[],c=[];angular.forEach(t.students,function(d){"1"===t.selected[d._id]&&(angular.forEach(a,function(a,b){("formIndex"===b||"groupId"===b||"deptId"===b)&&c.push(d),d[b]=a}),b.push(d),y())}),l.saveBatch(b).catch(function(){}),B(c)};var B=function(c){angular.forEach(t.subjects,function(d,e){u=a.formIndex+":"+a.deptId+":"+a.groupId+":"+e,h.get(u).then(function(a){v=a.marksheet,angular.forEach(c,function(a){delete v.table[a._id]});var d=b.defer();v.save().then(function(){d.resolve(v)}).catch(function(a){console.log("Failed to save marksheet",a,v),d.reject(a)})}).catch(function(){console.log("marksheet does not exist")})})};a.open=r.open,a.fees=e.getAll()}function NavtabsCtrl(a,b,c,d,e,f,g,h){a.TABS=d,a.open=c.open,a.userAccess=b.accessCode,a.teacher=f.get("user"),a.User=g.User,a.settings=e.get(),a.activePage=b.page,h.get("schoolinfo").then(function(b){a.schoolInfo=b,"gths"===a.schoolInfo.version&&(a.User.roles.classmaster.name="Head of Dept")}).catch(function(a){console.log("failed to load school info",a)}),a.activeIfPage=function(a){var c="";return a===b.page&&(c="active"),c};var i=function(a){var c=!1;return a.page!==b.page&&(c="all"===a.exclude?!0:a.exclude.indexOf(b.page)>-1),c};a.userHasAccess=function(b,c){var d=b.modes.indexOf(c)>-1,e=b.access.indexOf(a.userAccess)>-1,f=i(b);return e&&d&&!f},a.logout=function(){c.open({page:"login",username:null,accessCode:"teacher"})},a.login=function(b){console.log(b,a.settings),c.open(a.settings.access[b]?{page:"default_"+b,accessCode:b}:{page:"notactive",accessCode:b})}}function ClassmenuCtrl(a,b,c,d,e,f,g,h){var i=a.route={};i.page=a.page=b.page,i.forms=a.forms=f.all(),i.form=a.form=a.forms[b.formIndex],i.departments=a.departments=c.getAll(),"myclasses"===i.page&&angular.forEach(i.departments,function(a,c){a.forms[b.formIndex]||(console.log("Deleting: ",c,a),delete i.departments[c])}),console.log("Departments",i.departments),i.department=a.department=i.departments.hasOwnProperty(b.deptId)?a.departments[b.deptId]:a.open({deptId:Object.keys(i.departments)[0]}),i.groups=a.groups=e.getAll(),i.group=a.group=a.groups[b.groupId],i.subjects=a.subjects=d.getAll(),i.subject=a.subject=a.subjects[b.subjectId],i.terms=a.terms=[{name:"Term 1"},{name:"Term 2"},{name:"Term 3"}],i.term=a.term=a.terms[b.termIndex],a.open=h.open}function MarksheetCtrl(a,b,c,d,e,f,g){var h=d.Marksheet.generateID(b);a.classMaster=g,a.marksheets=f,a.open=e.open,a.data={marksheet:{},students:[],rankings:{}};f.get(h).then(function(b){a.data.marksheet=b.marksheet,a.data.students=b.students,a.data.rankings=f.rank(a.data.marksheet)}).catch(function(a){console.log("Failed to get marksheet: ",a)});var i=!1;a.noteChange=function(){i=!0},a.save=function(b,c){if(i){var d=a.data.marksheet.table[b][c];console.log("number?",isNaN(Number(d))),b&&(d>20||0>d||isNaN(Number(d)))&&(a.data.marksheet.table[b][c]=""),a.data.marksheet.save().then(function(){i=!1,a.data.rankings=f.rank(a.data.marksheet)}).catch(function(a){console.log("Save error: ",a)})}}}function MyclassesCtrl(a,b,c,d,e,f,g,h,i,j,k){a.open=i.open;var l=[b.formIndex,b.deptId,b.groupId,b.subjectId];a.allSelected=-1===l.indexOf("undefined"),a.page=b.page,a.formIndex=b.formIndex,a.data={forms:e.all(),departments:g.getAll(),groups:f.getAll(),subjects:j.getAll(),marksheets:[],assignedTeacher:null},a.Users=c,h.query({teacherId:b.username}).then(function(b){console.log("myclasses Marksheets",b),a.data.marksheets=b}).catch(function(a){console.log("Error:",a)});var m=d.Marksheet.generateID(b);h.query({_id:m}).then(function(b){var d=b[0];a.data.assignedTeacher=d?c.get(d.teacherId):null}),console.log("MyClasses routeParams",b),a.username=b.username;var n=function(a){var b=k.getTeacher(a);return b&&c.get(b.username)?c.get(b.username):null};a.teacher=n(m);a.removeBookmark=function(b){console.log("removing marksheet",b),b.teacherId=null,b.save().then(function(){a.data.marksheets=a.data.marksheets.filter(function(a){return a._id!==b._id}),console.log("Removed marksheet",a.data.marksheets)})},a.getNumberOfStudents=function(a){return Object.keys(a.table).length},a.addBookmark=function(){h.createOrUpdate(m,b.username).then(function(d){a.data.marksheets.push(d),a.data.assignedTeacher=c.get(b.username),console.log("Saved myclass: ",d,a.data)}).catch(function(a){console.log("Failed to save myclass: ",a)})}}function DepartmentsCtrl(a,b,c,d,e,f,g){a.forms=g.getForms(),a.departments=f.getAll(),console.log(a.departments),a.newDepartment=new d.Department,a.allStudents={},a.add=function(b){b.save().then(function(c){console.log("Department saved",c),a.departments[c.id]=b,f.set(a.newDepartment,c.id),a.allStudents[a.newDepartment._id]=[],a.newDepartment=new d.Department}).catch(function(a){console.log("Department save error ",a)})},a.remove=function(b){f.remove(b).then(function(){delete a.departments[b._id]})},a.toggleForm=function(a,b){a.toggleForm(b).save().then(function(){f.set(a,a._id)})},e.getAll().then(function(b){angular.forEach(a.departments,function(b,c){a.allStudents[c]=[]}),angular.forEach(b,function(b){a.allStudents[b.deptId].push(b)}),console.log("Got all students: ",a.allStudents)}).catch(function(a){console.log("Failed to get all students, ",a)})}function FeesCtrl(a,b,c,d){a.data={},a.data.fees=b.getAll(),c.getAll().then(function(b){angular.forEach(a.data.fees,function(a,c){a.students=_.filter(b,function(a){return a.feeId===c})})}),a.newFee=new d.Fee,a.add=function(b){if(b.isValid())try{b.schoolAmount=Number(b.schoolAmount.replace(/[^0-9\.]+/g,"")),b.ptaAmount=Number(b.ptaAmount.replace(/[^0-9\.]+/g,"")),b.save().then(function(){a.newFee.students||(a.newFee.students=[]),a.data.fees[a.newFee._id]=a.newFee,a.newFee=new d.Fee}).catch(function(a){console.log("Error: Fee not added",a)})}catch(c){console.log("FeesCtrl Error: ",c)}},a.remove=function(a){b.remove(a)}}function ProfileCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.PROMOTE_OPTIONS=q,a.accessCode=b.accessCode,a.newPayment=new c.Payment,a.newPayment.registrar=b.username,a.newPayment.studentId=b.studentId,a.multiplier=1,a.Users=f,a.username=b.username;var r={},s={},t="0"===b.studentId?"student_U0000001":b.studentId;console.log("routeParams",b);var u=a.data={comments:[],student:void 0,dcard:void 0,forms:m.all(),departments:p.getAll(),groups:o.getAll(),fees:l.getAll(),payments:[]},v=function(a,b){var c=0;r[b].total.summary&&(c=r[b].total.summary[a._id][0]),a.passing=c>=s[b].passingScore};console.log("studentId",t),k.get(t).then(function(d){console.log("Found student:",d),a.data.student=d,a.newComment=new c.Comment(b.username,a.data.student._id);var e=angular.copy(a.data.student);a.editing=!1,a.edit=function(){a.editing=!0},a.cancel=function(){a.data.student=angular.copy(e),a.editing=!1},a.data.student.passing=!1;var f=[d.formIndex,d.deptId,d.groupId];if(r.hasOwnProperty(f)&&s.hasOwnProperty(f))v(a.data.student,f);else{var j={reports:g.getReports({formIndex:d.formIndex,deptId:d.deptId,groupId:d.groupId})},k={classcouncil:h.get(c.ClassCouncil.generateID({formIndex:d.formIndex,deptId:d.deptId,groupId:d.groupId}))};i.all(k).then(function(a){console.log("all promises: ",a),s[f]=a.classcouncil}).catch(function(){s[f]||(s[f]=new c.ClassCouncil)}),i.all(j).then(function(b){console.log("all promises: ",b),r[f]=b.reports,v(a.data.student,f)}).catch(function(){})}}).catch(function(a){console.log("profileCtrl Error: ",a)}),e.get(t).then(function(b){a.data.dcard=b}).catch(function(a){console.log("Failed to get dcard",a)}),d.getComments(t).then(function(b){a.data.comments=a.data.comments.concat(b)}),n.query({studentId:t}).then(function(b){console.log("payments query: ",b),a.data.payments=b}).catch(function(a){console.log("payment error: ",a)}),a.addPayment=function(d,e){d.amount=d.getAmount()*e,console.log("Saving payment: ",d,e),d.save().then(function(e){console.log("payment saved",e),a.data.payments.push(d),a.newPayment=new c.Payment,a.newPayment.registrar=b.username,a.newPayment.studentId=b.studentId,a.data.student.totalPaid+=d.amount,a.data.student.save()}).catch(function(a){console.log("Payment save error ",a)})},a.addComment=function(){a.newComment.save().then(function(d){console.log("Comment saved: ",d),a.data.comments.push(a.newComment),a.newComment=new c.Comment(b.username,a.data.student._id)})},a.removeComment=function(b){console.log("Remove comment",a.data.comments[b]);var c=a.data.comments[b];d.removeComment(c).then(function(){delete a.data.comments[b]})},a.stringToNumber=function(a){return a=Number(a.replace(/[^0-9\.]+/g,""))},a.getTotalPayments=function(){var b=0;return b=a.data.payments.reduce(function(b,c){return"string"==typeof c.amount&&(c.amount=a.stringToNumber(c.amount)),c.amount+b},0)},a.getOwed=function(){return u.fees[u.student.feeId].schoolAmount+u.fees[u.student.feeId].ptaAmount},a.save=function(b){b.save().then(function(b){console.log("Model saved",b),a.editing=!1}).catch(function(a){console.log("Failed to save model",a)})}}function GroupsCtrl(a,b,c,d,e){a.newGroup=new d.Group,a.groups=b.getAll(),a.forms=e.all(),a.add=function(b){d.isValid(b)?b.save().then(function(c){console.log("Success: saved group",c),a.groups[b._id]=b,a.allStudents[b._id]=[],a.newGroup=new d.Group}).catch(function(a){console.log("Error: unable to save group",a)}):console.log("Model not valid",b)},a.remove=function(a){b.remove(a)},a.allStudents={},c.getAll().then(function(b){angular.forEach(a.groups,function(b,c){a.allStudents[c]=[]}),angular.forEach(b,function(b){a.allStudents[b.groupId].push(b)}),console.log("Got all students: ",a.allStudents)}).catch(function(a){console.log("Failed to get all students, ",a)})}function FinanceCtrl(a,b,c,d,e,f,g){var h=_.map(b.all(),function(a){return a.students=[],a});g.get("schoolinfo").then(function(b){a.schoolInfo=b}).catch(function(){console.log("failed to get school info")});var i=[];e.query().then(function(a){i=a}).catch(function(a){console.log("Failed to get students",a)}),f.getAll().then(function(b){angular.forEach(i,function(a){var c=a._id;a.payments=b[c]?b[c].payments:[]}),h=_.reduce(i,function(a,b){return a[b.formIndex].students.push(b),a},h),h=_.map(h,function(a){return a.fees={},angular.forEach(d.getAll(),function(b,c){var d=angular.copy(b);d.schoolFee=0,d.ptaFee=0,d.owed=0,d.paid=0,d.students=0,a.fees[c]=d}),a.fees=_.reduce(a.students,function(a,b){return a[b.feeId].students+=1,a[b.feeId].schoolFee+=d.get(b.feeId).schoolAmount,a[b.feeId].ptaFee+=d.get(b.feeId).ptaAmount,a[b.feeId].owed+=d.get(b.feeId).schoolAmount+d.get(b.feeId).ptaAmount,a[b.feeId].paid=a[b.feeId].paid+b.payments.reduce(function(a,b){return a+b.amount},0),a},a.fees),a}),a.forms=h;var c={fees:{}};angular.forEach(d.getAll(),function(a,b){var d=angular.copy(a);d.schoolFee=0,d.ptaFee=0,d.owed=0,d.students=0,d.paid=0,c.fees[b]=d}),a.summary=h.reduce(function(a,b){return angular.forEach(b.fees,function(a,b){c.fees[b].students=c.fees[b].students+a.students,c.fees[b].schoolFee=c.fees[b].schoolFee+a.schoolFee,c.fees[b].ptaFee=c.fees[b].ptaFee+a.ptaFee,c.fees[b].owed=c.fees[b].owed+a.owed,c.fees[b].paid=c.fees[b].paid+a.paid}),c},c)});var j=function(a){var b={};return b.by=function(b){var c=0;return angular.forEach(a,function(a){c+=a[b]}),c},b};a.totalStudents=function(a){return j(a).by("students")},a.totalSchoolFee=function(a){return j(a).by("schoolFee")},a.totalPTAFee=function(a){return j(a).by("ptaFee")},a.totalOwed=function(a){return j(a).by("owed")},a.totalPaid=function(a){return j(a).by("paid")}}function ClasscouncilCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.pageTitleEnglish="CLASS COUNCIL REPORT",a.pageTitleFrench="RAPPORT DU CONSEIL DE CLASSE",a.userAccess=b.accessCode,a.formIndex=b.formIndex,a.groupId=b.groupId,a.deptId=b.deptId,a.termIndex=parseInt(b.termIndex);var p=c.ClassCouncil.generateID(b);a.data={},a.data.forms=h.all(),a.data.departments=i.getAll(),a.data.groups=g.getAll(),a.data.terms=j.getAll(),a.data.currentDate=new Date,a.data.rankings={},a.data.rankingsList=[],a.data.bestStudents=[],a.data.worstStudents=[],a.data.bestAverages=[],a.data.classcouncil=new c.ClassCouncil({_id:p,formIndex:a.formIndex,groupId:a.groupId,deptId:a.deptId}),f.get(p).then(function(b){a.data.classcouncil=b}),o.get("schoolinfo").then(function(b){a.data.schoolInfo=b}).catch(function(a){console.log("failed to get school info",a)}),a.groupStats={},a.open=m.open,d.query({formIndex:b.formIndex,deptId:b.deptId,groupId:b.groupId}).then(function(b){a.data.marksheets=_.map(Object.keys(b),function(a){return b[a]}),a.data.combinedMarksheet=d.combine(a.data.marksheets),a.data.summarysheet=d.summarize(a.data.combinedMarksheet,a.termIndex),a.groupStats=q(),a.score=a.data.classcouncil.passingScore,a.data.rankings=d.rank(a.data.combinedMarksheet),console.log("rankings:",a.data.rankings),r(),console.log("User access",a.userAccess)}).catch(function(a){console.log("Failed to find marksheets",a)});var q=function(){var b={numStudents:0,numPresent:0,passing:0,failing:0,percentPassing:0,percentFailing:0,classAverage:0,classRange:0},c=20,d=0,e=0,f=0;return angular.forEach(a.data.summarysheet,function(g){b.numStudents=b.numStudents+1,e=g[0],e>=a.data.classcouncil.passingScore&&(b.passing=b.passing+1),isNaN(e)||-1===e||(f+=e,b.numPresent=b.numPresent+1,c>e&&(c=e),e>d&&(d=e))}),b.failing=b.numPresent-b.passing,b.percentPassing=b.passing/b.numPresent,b.percentFailing=1-b.percentPassing,b.classAverage=f/b.numPresent,b.classRange=20===c?0:d-c,b},r=function(){var b=Object.keys(a.data.rankings),c=_.map(b,function(b){var c={};return c.rankings=a.data.rankings[b],c.studentId=b,c}),d=c.sort(function(b,c){return b.rankings[a.termIndex]-c.rankings[a.termIndex]}),f=0;angular.forEach(d,function(b){isNaN(b.rankings[a.termIndex])&&(f+=1)});var g=[],h=[];if(d.length>2){g=[d[0].studentId,d[1].studentId,d[2].studentId];var i=d.slice(-3-f);h=[i[0].studentId,i[1].studentId,i[2].studentId]}else d.length>1?(g=[d[0].studentId,d[1].studentId],h=[d[0].studentId,d[1].studentId]):d.length>0&&(g=[d[0].studentId],h=[d[0].studentId]);e.getBatch(g).then(function(b){a.data.bestStudents=_.map(b,function(b){return b.average=a.data.summarysheet[b._id][0],b})}).catch(function(a){console.log("Failed to find students: ",a)}),e.getBatch(h).then(function(b){a.data.worstStudents=_.map(b,function(b){return b.average=a.data.summarysheet[b._id][0],b})}).catch(function(a){console.log("Failed to find students: ",a)})};a.changeAcRemark=function(b){a.data.classcouncil.academicRemark[a.termIndex]=b,a.save()},a.changeConRemark=function(b){a.data.classcouncil.conductRemark=b,a.save()},a.updatePassingScore=function(b){isNaN(Number(b))?a.score=a.data.classcouncil.passingScore:(a.score=b,a.data.classcouncil.passingScore=Number(b),a.groupStats=q(),a.save())},a.save=function(){a.data.classcouncil.save().then(function(a){console.log("Council saved",a)}).catch(function(a){console.log("Council save error ",a)})},a.data.remarks=[{text:"Excellent",css:"remark-excellent"},{text:"Very Good",css:"remark-verygood"},{text:"Good",css:"remark-good"},{text:"Fair",css:"remark-fair"},{text:"Average",css:"remark-average"},{text:"Poor",css:"remark-poor"},{text:"Very Poor",css:"remark-verypoor"}]}function RegistrationCtrl(a,b,c,d,e,f,g,h,i,j,k){a.formIndex=b.formIndex,a.showValidaton=!1;var l=a.data={forms:d.all(),departments:e.getAll(),groups:f.getAll(),fees:g.getAll(),uid:null};angular.forEach(),a.newStudent=new i.Student,console.log("NewStudent",a.newStudent),c.get().then(function(b){l.uid=b,console.log("Got Uid",b),a.newStudent.id=b.value});var m=function(a){var b={formIndex:a.formIndex,deptId:a.deptId,groupId:a.groupId};k.query(b).then(function(b){angular.forEach(b,function(b){b.table[a._id]=["","","","","",""],b.save().then(function(){}).catch(function(a){console.log("Error saving marksheet with new student",a)})})}).catch(function(a){console.log("Failed to retreive marksheets",a)})};a.add=function(b){b.save().then(function(d){c.save(l.uid),console.log("Save student: ",d),h.open({page:"registrarProfile",studentId:b._id}),a.showValidaton=!1,j.set(b),m(b)}).catch(function(b){a.showValidation=!0,console.log("Failed to save student: ",b)})},a.clearForm=function(a){a.formIndex=null,a.deptId=null,a.groupId=null,a.feeId=null,a.name="",a.birth=null,a.sex="",a.parentName="",a.parentPhone="",a.parentEmail=""}}function ReportcardCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=a.termIndex=b.termIndex;a.Marksheets=j,a.ClassMaster=s,a.open=v.open,a.pageTitleEnglish="ACADEMIC REPORT CARD",a.pageTitleFrench="BULLETIN DE NOTES",a.PROMOTE_OPTIONS=y,a.Users=f,a.getRemark=s.getRemark,a.studentId=b.studentId,a.data={},a.data.forms=o.all(),a.data.departments=k.getAll(),a.data.groups=l.getAll(),a.data.subjects=g.getAll(),a.data.subjectTypes=n.all(),a.data.terms=m.getAll(),a.data.term=a.data.terms[b.termIndex],a.data.marksheets=[],a.data.summaries={},a.data.rankings={},a.data.students=[],a.data.student,a.ClassMaster=s,x.get("schoolinfo").then(function(b){a.data.schoolInfo=b}).catch(function(a){console.log("failed to get school info",a)}),j.query({formIndex:b.formIndex,deptId:b.deptId,groupId:b.groupId}).then(function(b){a.data.summaries=b.map(function(a){return j.summarize(a,z)}),a.data.marksheets=_.map(Object.keys(b),function(a){return b[a]}),angular.forEach(a.data.marksheets,function(b){a.data.rankings[b._id]=j.rank(b)}),console.log("Marksheets",a.data.marksheets),console.log("Rankings",a.data.rankings),a.data.msheet=j.combine(a.data.marksheets),a.data.summarysheet=j.summarize(a.data.msheet,z),console.log("msheet",a.data.msheet),console.log("summarysheet",a.data.summarysheet),a.data.rankings.master=j.rank(a.data.msheet);var c=a.data.sets={};angular.forEach(a.data.marksheets,function(b){var d=a.data.subjects[b.subjectId].type;c.hasOwnProperty(d)||(c[d]={marksheets:[],summsheets:{}}),c[d].marksheets.push(b),c[d].summsheets[b._id]=j.summarize(b,z),console.log("Summsheets",c[d].summsheets[b._id])}),angular.forEach(c,function(a,b){c[b].msheet=j.combine(a.marksheets),c[b].ssheet=j.summarize(c[b].msheet,z),c[b].rankings=j.rank(c[b].msheet)}),a.nsets=Object.keys(c).length;var d=_.union(_.reduce(a.data.summaries,function(a,b){return a.concat(Object.keys(b))},[]));h.getBatch(d).then(function(b){a.data.students=b;var c=_.reduce(b,function(a,b){return a[b._id]=b,a},{});a.data.student=d.indexOf(a.studentId)>-1?c[a.studentId]:b[0],console.log("Student: ",a.data.student),e.get(a.data.student._id).then(function(b){a.data.dcard=b,console.log("Dcard data",a.data.dcard)
}).catch(function(a){console.log("Failed to get dcard",a)})}).catch(function(a){console.log("Failed to find students: ",a)})}).catch(function(a){console.log("Failed to find marksheets",a)}),d.get(c.ClassCouncil.generateID(b)).then(function(b){a.passingScore=b.passingScore}).catch(function(){a.passingScore=10}),a.getMark=function(a){var b=2*(parseInt(a.t)+1)+a.s-2;return a.row?a.row[b]:void 0}}function UserCtrl(a,b,c,d){a.editing=!1,a.currentUser=c.get(b.username),a.editingUser="current"===b.subpage?a.currentUser:c.get(b.subpage),a.data={},a.data.newPassword="",a.data.repeatPassword="",a.data.verifiedStatus="",a.data.currentPassword="",a.status="",a.verifyMatch=function(){a.data.verifiedStatus=a.data.repeatPassword===a.data.newPassword?"has-success":"has-error"},a.verifyStatus=function(){a.data.repeatPassword.length<a.data.newPassword.length?a.data.verifiedStatus="":a.verifyMatch()},a.save=function(){if(d.encrypt(a.data.currentPassword)===a.currentUser.password){var b=a.editingUser;b.password=d.encrypt(a.data.newPassword),b.save().then(function(){a.status=200}).catch(function(a){console.log("Failed to update password",a)})}else a.status=401}}function StatsCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){a.termIndex=parseInt(b.termIndex),a.queryParams={formIndex:b.formIndex},b.deptId&&(a.queryParams.deptId=b.deptId),a.open=v.open;var y=a.data={marksheets:[],subjects:e.getAll(),view:"mastersheet",stats:{},forms:o.all(),depts:i.getAll(),terms:l.getAll(),fees:j.getAll()};k.query().then(function(b){a.data.payments=b}).catch(function(){console.log("Failed to get payments")}),x.get("schoolinfo").then(function(b){a.data.schoolInfo=b}).catch(function(a){console.log("failed to get school info",a)}),a.round=Math.round,a.getStats=function(b,d){var e={};return a.termIndex=d,angular.forEach(y.subjects,function(a,g){var i=angular.copy(b);i.subjectId=g,h.query(i).then(function(b){if(b.length>0){var g=new c.Marksheet;g.coeff=b[0].coeff,angular.forEach(b,function(a){_.extend(g.table,a.table)});var i=h.summarize(g,d),j=Object.keys(i);f.getBatch(j).then(function(b){var b=_.map(Object.keys(b),function(a){return b[a]}),c=0,d=0,f=0,g=0;angular.forEach(b,function(a){"Male"===a.sex&&i[a._id][0]>=0?(c+=1,i[a._id][0]>=10&&(f+=1)):"Female"===a.sex&&i[a._id][0]>=0&&(d+=1,i[a._id][0]>=10&&(g+=1))}),e[a.code]={nameEn:a.en,nameFr:a.fr,maleSat:c,malePassing:f,femaleSat:d,femalePassing:g}})}})}),e},a.data.stats=a.getStats(a.queryParams,a.termIndex),a.setQuery=function(b){angular.forEach(b,function(b,c){"all"===b?delete a.queryParams[c]:a.queryParams[c]=b}),a.data.stats=a.getStats(a.queryParams,a.termIndex)},a.export=function(){var b={},c={};c.nameEn=y.schoolInfo.nameEn,c.nameFr=y.schoolInfo.nameFr,c.division=y.schoolInfo.division,c.subdivision=y.schoolInfo.subdivision,c.principal=y.schoolInfo.principal,c.version=y.schoolInfo.version,c.schoolyear=y.schoolInfo.schoolyear,c.fees={},c.paymentCollected=_.reduce(y.payments,function(a,b){return a+b.amount},0),f.getAll().then(function(a){var b=0,d=0,e=0,f=0;angular.forEach(y.fees,function(b,d){var e=_.filter(a,function(a){return a.feeId===d});b.students=e.length,c.fees[d]=b}),angular.forEach(a,function(a){"Male"===a.sex?a.formIndex>4?f+=1:e+=1:"Female"===a.sex&&(a.formIndex>4?d+=1:b+=1)}),c.maleCycle1=e,c.maleCycle2=f,c.femaleCycle1=b,c.femaleCycle2=d}),angular.forEach(a.data.terms,function(c,d){b[d]={},angular.forEach(a.data.depts,function(c,e){b[d][e]={name:c.name},angular.forEach(a.data.forms,function(c,f){b[d][e][f]=a.getStats({formIndex:f,deptId:e},d)})})}),c.stats=b,d.exportSchool(c)}}function File(a,b,c,d,e,f,g,h,i,j,k){var l={};l.import=function(){var a=b.defer();chrome.fileSystem.chooseEntry({type:"openFile"},function(c){c.file(function(c){var d=new FileReader;d.onloadend=function(a){var c=JSON.parse(a.target.result);console.log("Read successful.",c),b.when(m(c)).then(function(){l()})},d.onerror=function(b){console.log("Read failed:",b),a.reject(b)},d.readAsText(c)}).catch(function(a){console.log("error reading file",a)})});var l=function(){var l=c.load(),m=e.load(),n=f.load(),o=g.load(),p=h.load(),q=i.load(),r=j.load(),s=(new d.ClassCouncil,[l,o,q,p,n,m,r]);b.all(s).then(function(b){var c=b[6];angular.forEach(c,function(a){k.query({studentId:a._id}).then(function(b){var c=_.reduce(b,function(a,b){return a+b.amount},0);a.totalPaid!==c&&(a.totalPaid=c,a.save().then(function(a){console.log("Student saved:",a)}))}).catch(function(b){console.log("Failed to load payments for ",a.name,b)})}),a.resolve()})};return a.promise};var m=function(c){var d=b.defer(),e=[{name:"gen",list:[],db:a.create("gths")},{name:"students",list:[],db:a.create("db_students"),datatype:"datatype/student/v1"},{name:"payments",list:[],db:a.create("db_payments"),datatype:"datatype/payment/v1"}];return angular.forEach(c,function(a){a.doc.datatype===e[1].datatype?e[1].list.push(a.doc):a.doc.datatype===e[2].datatype?e[2].list.push(a.doc):e[0].list.push(a.doc)}),e[0].db.bulkDocs({docs:e[0].list},{new_edits:!1}).then(function(a){console.log(e[0].name,"imported",a,e[0].list),e[1].db.bulkDocs({docs:e[1].list},{new_edits:!1}).then(function(a){console.log(e[1].name,"imported",a,e[1].list),e[2].db.bulkDocs({docs:e[2].list},{new_edits:!1}).then(function(a){console.log(e[2].name,"imported",a,e[1].list),d.resolve()})})}).catch(function(a){console.log("Error saving to Import DB:",a),d.reject()}),d.promise};return l.export=function(){var c=[],d=[],e=b.defer(),f=[{getDB:function(){return"gths"}},{getDB:function(){return"db_students"}},{getDB:function(){return"db_payments"}}];angular.forEach(f,function(a){var b=a.getDB();-1===c.indexOf(b)&&c.push(b)});var g=function(b){a.create(b[0]).allDocs({include_docs:!0}).then(function(a){d=d.concat(a.rows),1===b.length?(console.log("Merge successful:",d),h(JSON.stringify(d))):b.length>1&&g(b.slice(1))})},h=function(a){chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:"schoolman.data"},function(b){b.createWriter(function(b){b.onwriteend=function(){0===b.length?b.write(c):(console.log("Write completed."),e.resolve())},b.onerror=function(a){console.log("Write failed: "+a),e.reject(a)};var c=new Blob([a],{type:"text/plain"});b.truncate(0)}).catch(function(a){console.log("error creating writer",a)})})};return g(c),e.promise},l.exportSchool=function(a){console.log("Exporting",a),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:"school.data"},function(b){b.createWriter(function(b){b.onwriteend=function(){0===b.length?b.write(c):console.log("Write completed.")},b.onerror=function(a){console.log("Write failed: "+a)};var c=new Blob([JSON.stringify(a)],{type:"text/plain"});b.truncate(0)}).catch(function(a){console.log("error creating writer",a)})})},window._export=l.export,l}angular.module("ui.bootstrap",["ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdownToggle","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==f.style[b])return a[b]}var e=function(d,f,g){g=g||{};var h=a.defer(),i=e[g.animation?"animationEndEventName":"transitionEndEventName"],j=function(){c.$apply(function(){d.unbind(i,j),h.resolve(d)})};return i&&d.bind(i,j),b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f),i||h.resolve(d)}),h.promise.cancel=function(){i&&d.unbind(i,j),h.reject("Transition cancelled")},h.promise},f=document.createElement("trans"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},h={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return e.transitionEndEventName=d(g),e.animationEndEventName=d(h),e}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(a){return{link:function(b,c,d){function e(b){function d(){j===e&&(j=void 0)}var e=a(c,b);return j&&j.cancel(),j=e,e.then(d,d),e}function f(){k?(k=!1,g()):(c.removeClass("collapse").addClass("collapsing"),e({height:c[0].scrollHeight+"px"}).then(g))}function g(){c.removeClass("collapsing"),c.addClass("collapse in"),c.css({height:"auto"})}function h(){k?(k=!1,i(),c.css({height:0})):(c.css({height:c[0].scrollHeight+"px"}),c[0].offsetWidth,c.removeClass("collapse in").addClass("collapsing"),e({height:0}).then(i))}function i(){c.removeClass("collapsing"),c.addClass("collapse")}var j,k=!0;b.$watch(d.collapse,function(a){a?h():f()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(a,b,c){this.groups=[],this.closeOthers=function(d){var e=angular.isDefined(b.closeOthers)?a.$eval(b.closeOthers):c.closeOthers;e&&angular.forEach(this.groups,function(a){a!==d&&(a.isOpen=!1)})},this.addGroup=function(a){var b=this;this.groups.push(a),a.$on("$destroy",function(){b.removeGroup(a)})},this.removeGroup=function(a){var b=this.groups.indexOf(a);-1!==b&&this.groups.splice(this.groups.indexOf(a),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse",function(a){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:function(){this.setHeading=function(a){this.heading=a}},link:function(b,c,d,e){var f,g;e.addGroup(b),b.isOpen=!1,d.isOpen&&(f=a(d.isOpen),g=f.assign,b.$parent.$watch(f,function(a){b.isOpen=!!a})),b.$watch("isOpen",function(a){a&&e.closeOthers(b),g&&g(b.$parent,a)})}}}]).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(a,b,c){return function(a,b,d,e){e.setHeading(c(a,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(a,b,c,d){a.$watch(function(){return d[c.accordionTransclude]},function(a){a&&(b.html(""),b.append(a))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(a,b){a.closeable="close"in b}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(a,b,c){b.addClass("ng-binding").data("$binding",c.bindHtmlUnsafe),a.$watch(c.bindHtmlUnsafe,function(a){b.html(a||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(a){this.activeClass=a.activeClass||"active",this.toggleEvent=a.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){var e=d[0],f=d[1];f.$render=function(){b.toggleClass(e.activeClass,angular.equals(f.$modelValue,a.$eval(c.btnRadio)))},b.bind(e.toggleEvent,function(){b.hasClass(e.activeClass)||a.$apply(function(){f.$setViewValue(a.$eval(c.btnRadio)),f.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){function e(){return g(c.btnCheckboxTrue,!0)}function f(){return g(c.btnCheckboxFalse,!1)}function g(b,c){var d=a.$eval(b);return angular.isDefined(d)?d:c}var h=d[0],i=d[1];i.$render=function(){b.toggleClass(h.activeClass,angular.equals(i.$modelValue,e()))},b.bind(h.toggleEvent,function(){a.$apply(function(){i.$setViewValue(b.hasClass(h.activeClass)?f():e()),i.$render()})})}}}),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(a,b,c){function d(){e();var c=+a.interval;!isNaN(c)&&c>=0&&(g=b(f,c))}function e(){g&&(b.cancel(g),g=null)}function f(){h?(a.next(),d()):a.pause()}var g,h,i=this,j=i.slides=[],k=-1;i.currentSlide=null;var l=!1;i.select=function(e,f){function g(){l||(i.currentSlide&&angular.isString(f)&&!a.noTransition&&e.$element?(e.$element.addClass(f),e.$element[0].offsetWidth,angular.forEach(j,function(a){angular.extend(a,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(e,{direction:f,active:!0,entering:!0}),angular.extend(i.currentSlide||{},{direction:f,leaving:!0}),a.$currentTransition=c(e.$element,{}),function(b,c){a.$currentTransition.then(function(){h(b,c)},function(){h(b,c)})}(e,i.currentSlide)):h(e,i.currentSlide),i.currentSlide=e,k=m,d())}function h(b,c){angular.extend(b,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(c||{},{direction:"",active:!1,leaving:!1,entering:!1}),a.$currentTransition=null}var m=j.indexOf(e);void 0===f&&(f=m>k?"next":"prev"),e&&e!==i.currentSlide&&(a.$currentTransition?(a.$currentTransition.cancel(),b(g)):g())},a.$on("$destroy",function(){l=!0}),i.indexOfSlide=function(a){return j.indexOf(a)},a.next=function(){var b=(k+1)%j.length;return a.$currentTransition?void 0:i.select(j[b],"next")},a.prev=function(){var b=0>k-1?j.length-1:k-1;return a.$currentTransition?void 0:i.select(j[b],"prev")},a.select=function(a){i.select(a)},a.isActive=function(a){return i.currentSlide===a},a.slides=function(){return j},a.$watch("interval",d),a.$on("$destroy",e),a.play=function(){h||(h=!0,d())},a.pause=function(){a.noPause||(h=!1,e())},i.addSlide=function(b,c){b.$element=c,j.push(b),1===j.length||b.active?(i.select(j[j.length-1]),1==j.length&&a.play()):b.active=!1},i.removeSlide=function(a){var b=j.indexOf(a);j.splice(b,1),j.length>0&&a.active?i.select(b>=j.length?j[b-1]:j[b]):k>b&&k--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",["$parse",function(a){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{},link:function(b,c,d,e){if(d.active){var f=a(d.active),g=f.assign,h=b.active=f(b.$parent);b.$watch(function(){var a=f(b.$parent);return a!==b.active&&(a!==h?h=b.active=a:g(b.$parent,a=h=b.active)),a})}e.addSlide(b,c),b.$on("$destroy",function(){e.removeSlide(b)}),b.$watch("active",function(a){a&&e.select(b)})}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(a,b){function c(a,c){return a.currentStyle?a.currentStyle[c]:b.getComputedStyle?b.getComputedStyle(a)[c]:a.style[c]}function d(a){return"static"===(c(a,"position")||"static")}var e=function(b){for(var c=a[0],e=b.offsetParent||c;e&&e!==c&&d(e);)e=e.offsetParent;return e||c};return{position:function(b){var c=this.offset(b),d={top:0,left:0},f=e(b[0]);f!=a[0]&&(d=this.offset(angular.element(f)),d.top+=f.clientTop-f.scrollTop,d.left+=f.clientLeft-f.scrollLeft);var g=b[0].getBoundingClientRect();return{width:g.width||b.prop("offsetWidth"),height:g.height||b.prop("offsetHeight"),top:c.top-d.top,left:c.left-d.left}},offset:function(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(b.pageYOffset||a[0].body.scrollTop||a[0].documentElement.scrollTop),left:d.left+(b.pageXOffset||a[0].body.scrollLeft||a[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.position"]).constant("datepickerConfig",{dayFormat:"dd",monthFormat:"MMMM",yearFormat:"yyyy",dayHeaderFormat:"EEE",dayTitleFormat:"MMMM yyyy",monthTitleFormat:"yyyy",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","dateFilter","datepickerConfig",function(a,b,c,d){function e(b,c){return angular.isDefined(b)?a.$parent.$eval(b):c}function f(a,b){return new Date(a,b,0).getDate()}function g(a,b){for(var c=new Array(b),d=a,e=0;b>e;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function h(a,b,d,e){return{date:a,label:c(a,b),selected:!!d,secondary:!!e}}var i={day:e(b.dayFormat,d.dayFormat),month:e(b.monthFormat,d.monthFormat),year:e(b.yearFormat,d.yearFormat),dayHeader:e(b.dayHeaderFormat,d.dayHeaderFormat),dayTitle:e(b.dayTitleFormat,d.dayTitleFormat),monthTitle:e(b.monthTitleFormat,d.monthTitleFormat)},j=e(b.startingDay,d.startingDay),k=e(b.yearRange,d.yearRange);this.minDate=d.minDate?new Date(d.minDate):null,this.maxDate=d.maxDate?new Date(d.maxDate):null,this.modes=[{name:"day",getVisibleDates:function(a,b){var d=a.getFullYear(),e=a.getMonth(),k=new Date(d,e,1),l=j-k.getDay(),m=l>0?7-l:-l,n=new Date(k),o=0;m>0&&(n.setDate(-m+1),o+=m),o+=f(d,e+1),o+=(7-o%7)%7;for(var p=g(n,o),q=new Array(7),r=0;o>r;r++){var s=new Date(p[r]);p[r]=h(s,i.day,b&&b.getDate()===s.getDate()&&b.getMonth()===s.getMonth()&&b.getFullYear()===s.getFullYear(),s.getMonth()!==e)}for(var t=0;7>t;t++)q[t]=c(p[t].date,i.dayHeader);return{objects:p,title:c(a,i.dayTitle),labels:q}},compare:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},split:7,step:{months:1}},{name:"month",getVisibleDates:function(a,b){for(var d=new Array(12),e=a.getFullYear(),f=0;12>f;f++){var g=new Date(e,f,1);d[f]=h(g,i.month,b&&b.getMonth()===f&&b.getFullYear()===e)}return{objects:d,title:c(a,i.monthTitle)}},compare:function(a,b){return new Date(a.getFullYear(),a.getMonth())-new Date(b.getFullYear(),b.getMonth())},split:3,step:{years:1}},{name:"year",getVisibleDates:function(a,b){for(var c=new Array(k),d=a.getFullYear(),e=parseInt((d-1)/k,10)*k+1,f=0;k>f;f++){var g=new Date(e+f,0,1);c[f]=h(g,i.year,b&&b.getFullYear()===g.getFullYear())}return{objects:c,title:[c[0].label,c[k-1].label].join(" - ")}},compare:function(a,b){return a.getFullYear()-b.getFullYear()},split:5,step:{years:k}}],this.isDisabled=function(b,c){var d=this.modes[c||0];return this.minDate&&d.compare(b,this.minDate)<0||this.maxDate&&d.compare(b,this.maxDate)>0||a.dateDisabled&&a.dateDisabled({date:b,mode:d.name})}}]).directive("datepicker",["dateFilter","$parse","datepickerConfig","$log",function(a,b,c,d){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(a,e,f,g){function h(){a.showWeekNumbers=0===o&&q}function i(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c}function j(b){var c=null,e=!0;n.$modelValue&&(c=new Date(n.$modelValue),isNaN(c)?(e=!1,d.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):b&&(p=c)),n.$setValidity("date",e);var f=m.modes[o],g=f.getVisibleDates(p,c);angular.forEach(g.objects,function(a){a.disabled=m.isDisabled(a.date,o)}),n.$setValidity("date-disabled",!c||!m.isDisabled(c)),a.rows=i(g.objects,f.split),a.labels=g.labels||[],a.title=g.title}function k(a){o=a,h(),j()}function l(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}var m=g[0],n=g[1];if(n){var o=0,p=new Date,q=c.showWeeks;f.showWeeks?a.$parent.$watch(b(f.showWeeks),function(a){q=!!a,h()}):h(),f.min&&a.$parent.$watch(b(f.min),function(a){m.minDate=a?new Date(a):null,j()}),f.max&&a.$parent.$watch(b(f.max),function(a){m.maxDate=a?new Date(a):null,j()}),n.$render=function(){j(!0)},a.select=function(a){if(0===o){var b=n.$modelValue?new Date(n.$modelValue):new Date(0,0,0,0,0,0,0);b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),n.$setViewValue(b),j(!0)}else p=a,k(o-1)},a.move=function(a){var b=m.modes[o].step;p.setMonth(p.getMonth()+a*(b.months||0)),p.setFullYear(p.getFullYear()+a*(b.years||0)),j()},a.toggleMode=function(){k((o+1)%m.modes.length)},a.getWeekNumber=function(b){return 0===o&&a.showWeekNumbers&&7===b.length?l(b[0].date):null}}}}}]).constant("datepickerPopupConfig",{dateFormat:"yyyy-MM-dd",currentText:"Today",toggleWeeksText:"Weeks",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","datepickerPopupConfig","datepickerConfig",function(a,b,c,d,e,f,g){return{restrict:"EA",require:"ngModel",link:function(h,i,j,k){function l(a){u?u(h,!!a):q.isOpen=!!a}function m(a){if(a){if(angular.isDate(a))return k.$setValidity("date",!0),a;if(angular.isString(a)){var b=new Date(a);return isNaN(b)?void k.$setValidity("date",!1):(k.$setValidity("date",!0),b)}return void k.$setValidity("date",!1)}return k.$setValidity("date",!0),null}function n(a,c,d){a&&(h.$watch(b(a),function(a){q[c]=a}),y.attr(d||c,c))}function o(){q.position=s?d.offset(i):d.position(i),q.position.top=q.position.top+i.prop("offsetHeight")}var p,q=h.$new(),r=angular.isDefined(j.closeOnDateSelection)?h.$eval(j.closeOnDateSelection):f.closeOnDateSelection,s=angular.isDefined(j.datepickerAppendToBody)?h.$eval(j.datepickerAppendToBody):f.appendToBody;j.$observe("datepickerPopup",function(a){p=a||f.dateFormat,k.$render()}),q.showButtonBar=angular.isDefined(j.showButtonBar)?h.$eval(j.showButtonBar):f.showButtonBar,h.$on("$destroy",function(){B.remove(),q.$destroy()}),j.$observe("currentText",function(a){q.currentText=angular.isDefined(a)?a:f.currentText}),j.$observe("toggleWeeksText",function(a){q.toggleWeeksText=angular.isDefined(a)?a:f.toggleWeeksText}),j.$observe("clearText",function(a){q.clearText=angular.isDefined(a)?a:f.clearText}),j.$observe("closeText",function(a){q.closeText=angular.isDefined(a)?a:f.closeText});var t,u;j.isOpen&&(t=b(j.isOpen),u=t.assign,h.$watch(t,function(a){q.isOpen=!!a})),q.isOpen=t?t(h):!1;var v=function(a){q.isOpen&&a.target!==i[0]&&q.$apply(function(){l(!1)})},w=function(){q.$apply(function(){l(!0)})},x=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");x.attr({"ng-model":"date","ng-change":"dateSelection()"});var y=angular.element(x.children()[0]);j.datepickerOptions&&y.attr(angular.extend({},h.$eval(j.datepickerOptions))),k.$parsers.unshift(m),q.dateSelection=function(a){angular.isDefined(a)&&(q.date=a),k.$setViewValue(q.date),k.$render(),r&&l(!1)},i.bind("input change keyup",function(){q.$apply(function(){q.date=k.$modelValue})}),k.$render=function(){var a=k.$viewValue?e(k.$viewValue,p):"";i.val(a),q.date=k.$modelValue},n(j.min,"min"),n(j.max,"max"),j.showWeeks?n(j.showWeeks,"showWeeks","show-weeks"):(q.showWeeks=g.showWeeks,y.attr("show-weeks","showWeeks")),j.dateDisabled&&y.attr("date-disabled",j.dateDisabled);var z=!1,A=!1;q.$watch("isOpen",function(a){a?(o(),c.bind("click",v),A&&i.unbind("focus",w),i[0].focus(),z=!0):(z&&c.unbind("click",v),i.bind("focus",w),A=!0),u&&u(h,a)}),q.today=function(){q.dateSelection(new Date)},q.clear=function(){q.dateSelection(null)};var B=a(x)(q);s?c.find("body").append(B):i.after(B)}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(a,b){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(a){var b=null,c=angular.noop;return{restrict:"CA",link:function(d,e){d.$watch("$location.path",function(){c()}),e.parent().bind("click",function(){c()}),e.bind("click",function(d){var f=e===b;d.preventDefault(),d.stopPropagation(),b&&c(),f||e.hasClass("disabled")||e.prop("disabled")||(e.parent().addClass("open"),b=e,c=function(d){d&&(d.preventDefault(),d.stopPropagation()),a.unbind("click",c),e.parent().removeClass("open"),c=angular.noop,b=null},a.bind("click",c))})}}}]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(c,d,e){c.windowClass=e.windowClass||"",b(function(){c.animate=!0,d[0].focus()}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(b){var c=a.find("body").eq(0),d=k.get(b).value;k.remove(b),d.modalDomEl.remove(),c.toggleClass(i,k.length()>0),h&&-1==e()&&(h.remove(),h=void 0),d.modalScope.$destroy()}var g,h,i="modal-open",j=c.$new(!0),k=d.createNew(),l={};return c.$watch(e,function(a){j.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(c,d){k.add(c,{deferred:d.deferred,modalScope:d.scope,backdrop:d.backdrop,keyboard:d.keyboard});var f=a.find("body").eq(0);e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(j),f.append(h));var l=angular.element("<div modal-window></div>");l.attr("window-class",d.windowClass),l.attr("index",k.length()-1),l.html(d.content);var m=b(l)(d.scope);k.top().value.modalDomEl=m,f.append(m),f.addClass(i)},l.close=function(a,b){var c=k.get(a).value;c&&(c.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function(a,b,c,d){var e=this,f=b.numPages?c(b.numPages).assign:angular.noop;this.init=function(d){b.itemsPerPage?a.$parent.$watch(c(b.itemsPerPage),function(b){e.itemsPerPage=parseInt(b,10),a.totalPages=e.calculateTotalPages()}):this.itemsPerPage=d},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===a.totalPages},this.isActive=function(a){return this.page===a},this.calculateTotalPages=function(){var b=this.itemsPerPage<1?1:Math.ceil(a.totalItems/this.itemsPerPage);return Math.max(b||0,1)},this.getAttributeValue=function(b,c,e){return angular.isDefined(b)?e?d(b)(a.$parent):a.$parent.$eval(b):c},this.render=function(){this.page=parseInt(a.page,10)||1,this.page>0&&this.page<=a.totalPages&&(a.pages=this.getPages(this.page,a.totalPages))},a.selectPage=function(b){!e.isActive(b)&&b>0&&b<=a.totalPages&&(a.page=b,a.onSelectPage({page:b}))},a.$watch("page",function(){e.render()}),a.$watch("totalItems",function(){a.totalPages=e.calculateTotalPages()}),a.$watch("totalPages",function(b){f(a.$parent,b),e.page>b?a.selectPage(b):e.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(a,b){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(c,d,e,f){function g(a,b,c,d){return{number:a,text:b,active:c,disabled:d}}var h,i=f.getAttributeValue(e.boundaryLinks,b.boundaryLinks),j=f.getAttributeValue(e.directionLinks,b.directionLinks),k=f.getAttributeValue(e.firstText,b.firstText,!0),l=f.getAttributeValue(e.previousText,b.previousText,!0),m=f.getAttributeValue(e.nextText,b.nextText,!0),n=f.getAttributeValue(e.lastText,b.lastText,!0),o=f.getAttributeValue(e.rotate,b.rotate);f.init(b.itemsPerPage),e.maxSize&&c.$parent.$watch(a(e.maxSize),function(a){h=parseInt(a,10),f.render()}),f.getPages=function(a,b){var c=[],d=1,e=b,p=angular.isDefined(h)&&b>h;p&&(o?(d=Math.max(a-Math.floor(h/2),1),e=d+h-1,e>b&&(e=b,d=e-h+1)):(d=(Math.ceil(a/h)-1)*h+1,e=Math.min(d+h-1,b)));for(var q=d;e>=q;q++){var r=g(q,q,f.isActive(q),!1);c.push(r)}if(p&&!o){if(d>1){var s=g(d-1,"...",!1,!1);c.unshift(s)}if(b>e){var t=g(e+1,"...",!1,!1);c.push(t)}}if(j){var u=g(a-1,l,!1,f.noPrevious());c.unshift(u);var v=g(a+1,m,!1,f.noNext());c.push(v)}if(i){var w=g(1,k,!1,f.noPrevious());c.unshift(w);var x=g(b,n,!1,f.noNext());c.push(x)}return c}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:" Previous",nextText:"Next ",align:!0}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(b,c,d,e){function f(a,b,c,d,e){return{number:a,text:b,disabled:c,previous:i&&d,next:i&&e}}var g=e.getAttributeValue(d.previousText,a.previousText,!0),h=e.getAttributeValue(d.nextText,a.nextText,!0),i=e.getAttributeValue(d.align,a.align);e.init(a.itemsPerPage),e.getPages=function(a){return[f(a-1,g,e.noPrevious(),!0,!1),f(a+1,h,e.noNext(),!1,!0)]}}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function a(a){var b=/[A-Z]/g,c="-";return a.replace(b,function(a,b){return(b?c:"")+a.toLowerCase()})}var b={placement:"top",animation:!0,popupDelay:0},c={mouseenter:"mouseleave",click:"click",focus:"blur"},d={};this.options=function(a){angular.extend(d,a)},this.setTriggers=function(a){angular.extend(c,a)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(e,f,g,h,i,j,k){return function(e,l,m){function n(a){var b=a||o.trigger||m,d=c[b]||b;return{show:b,hide:d}}var o=angular.extend({},b,d),p=a(e),q=k.startSymbol(),r=k.endSymbol(),s="<div "+p+'-popup title="'+q+"tt_title"+r+'" content="'+q+"tt_content"+r+'" placement="'+q+"tt_placement"+r+'" animation="tt_animation" is-open="tt_isOpen"></div>';
return{restrict:"EA",scope:!0,link:function(a,b,c){function d(){a.tt_isOpen?m():k()}function k(){(!y||a.$eval(c[l+"Enable"]))&&(a.tt_popupDelay?(t=g(p,a.tt_popupDelay),t.then(function(a){a()})):a.$apply(p)())}function m(){a.$apply(function(){q()})}function p(){return a.tt_content?(r&&g.cancel(r),u.css({top:0,left:0,display:"block"}),v?i.find("body").append(u):b.after(u),z(),a.tt_isOpen=!0,z):angular.noop}function q(){a.tt_isOpen=!1,g.cancel(t),a.tt_animation?r=g(function(){u.remove()},500):u.remove()}var r,t,u=f(s)(a),v=angular.isDefined(o.appendToBody)?o.appendToBody:!1,w=n(void 0),x=!1,y=angular.isDefined(c[l+"Enable"]),z=function(){var c,d,e,f;switch(c=v?j.offset(b):j.position(b),d=u.prop("offsetWidth"),e=u.prop("offsetHeight"),a.tt_placement){case"right":f={top:c.top+c.height/2-e/2,left:c.left+c.width};break;case"bottom":f={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"left":f={top:c.top+c.height/2-e/2,left:c.left-d};break;default:f={top:c.top-e,left:c.left+c.width/2-d/2}}f.top+="px",f.left+="px",u.css(f)};a.tt_isOpen=!1,c.$observe(e,function(b){a.tt_content=b,!b&&a.tt_isOpen&&q()}),c.$observe(l+"Title",function(b){a.tt_title=b}),c.$observe(l+"Placement",function(b){a.tt_placement=angular.isDefined(b)?b:o.placement}),c.$observe(l+"PopupDelay",function(b){var c=parseInt(b,10);a.tt_popupDelay=isNaN(c)?o.popupDelay:c});var A=function(){x&&(b.unbind(w.show,k),b.unbind(w.hide,m))};c.$observe(l+"Trigger",function(a){A(),w=n(a),w.show===w.hide?b.bind(w.show,d):(b.bind(w.show,k),b.bind(w.hide,m)),x=!0});var B=a.$eval(c[l+"Animation"]);a.tt_animation=angular.isDefined(B)?!!B:o.animation,c.$observe(l+"AppendToBody",function(b){v=angular.isDefined(b)?h(b)(a):v}),v&&a.$on("$locationChangeSuccess",function(){a.tt_isOpen&&q()}),a.$on("$destroy",function(){g.cancel(r),g.cancel(t),A(),u.remove(),u.unbind(),u=null})}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(a){return a("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(a){return a("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$compile","$timeout","$parse","$window","$tooltip",function(a,b,c,d,e){return e("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",["ui.bootstrap.transition"]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig","$transition",function(a,b,c,d){var e=this,f=[],g=angular.isDefined(b.max)?a.$parent.$eval(b.max):c.max,h=angular.isDefined(b.animate)?a.$parent.$eval(b.animate):c.animate;this.addBar=function(a,b){var c=0,d=a.$parent.$index;angular.isDefined(d)&&f[d]&&(c=f[d].value),f.push(a),this.update(b,a.value,c),a.$watch("value",function(a,c){a!==c&&e.update(b,a,c)}),a.$on("$destroy",function(){e.removeBar(a)})},this.update=function(a,b,c){var e=this.getPercentage(b);h?(a.css("width",this.getPercentage(c)+"%"),d(a,{width:e+"%"})):a.css({transition:"none",width:e+"%"})},this.removeBar=function(a){f.splice(f.indexOf(a),1)},this.getPercentage=function(a){return Math.round(100*a/g)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},template:'<div class="progress" ng-transclude></div>'}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(a,b,c,d){d.addBar(a,b)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(a,b,c,d){d.addBar(a,angular.element(b.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","$parse","ratingConfig",function(a,b,c,d){this.maxRange=angular.isDefined(b.max)?a.$parent.$eval(b.max):d.max,this.stateOn=angular.isDefined(b.stateOn)?a.$parent.$eval(b.stateOn):d.stateOn,this.stateOff=angular.isDefined(b.stateOff)?a.$parent.$eval(b.stateOff):d.stateOff,this.createRateObjects=function(a){for(var b={stateOn:this.stateOn,stateOff:this.stateOff},c=0,d=a.length;d>c;c++)a[c]=angular.extend({index:c},b,a[c]);return a},a.range=this.createRateObjects(angular.isDefined(b.ratingStates)?angular.copy(a.$parent.$eval(b.ratingStates)):new Array(this.maxRange)),a.rate=function(b){a.readonly||a.value===b||(a.value=b)},a.enter=function(b){a.readonly||(a.val=b),a.onHover({value:b})},a.reset=function(){a.val=angular.copy(a.value),a.onLeave()},a.$watch("value",function(b){a.val=b}),a.readonly=!1,b.readonly&&a.$parent.$watch(c(b.readonly),function(b){a.readonly=!!b})}]).directive("rating",function(){return{restrict:"EA",scope:{value:"=",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function(a){var b=this,c=b.tabs=a.tabs=[];b.select=function(a){angular.forEach(c,function(a){a.active=!1}),a.active=!0},b.addTab=function(a){c.push(a),(1===c.length||a.active)&&b.select(a)},b.removeTab=function(a){var d=c.indexOf(a);if(a.active&&c.length>1){var e=d==c.length-1?d-1:d+1;b.select(c[e])}c.splice(d,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(a,b,c){a.vertical=angular.isDefined(c.vertical)?a.$parent.$eval(c.vertical):!1,a.justified=angular.isDefined(c.justified)?a.$parent.$eval(c.justified):!1,a.type=angular.isDefined(c.type)?a.$parent.$eval(c.type):"tabs"}}}).directive("tab",["$parse",function(a){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(b,c,d){return function(b,c,e,f){var g,h;e.active?(g=a(e.active),h=g.assign,b.$parent.$watch(g,function(a,c){a!==c&&(b.active=!!a)}),b.active=g(b.$parent)):h=g=angular.noop,b.$watch("active",function(a){h(b.$parent,a),a?(f.select(b),b.onSelect()):b.onDeselect()}),b.disabled=!1,e.disabled&&b.$parent.$watch(a(e.disabled),function(a){b.disabled=!!a}),b.select=function(){b.disabled||(b.active=!0)},f.addTab(b),b.$on("$destroy",function(){f.removeTab(b)}),b.$transcludeFn=d}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(a,b){a.$watch("headingElement",function(a){a&&(b.html(""),b.append(a))})}}}]).directive("tabContentTransclude",function(){function a(a){return a.tagName&&(a.hasAttribute("tab-heading")||a.hasAttribute("data-tab-heading")||"tab-heading"===a.tagName.toLowerCase()||"data-tab-heading"===a.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(b,c,d){var e=b.$eval(d.tabContentTransclude);e.$transcludeFn(e.$parent,function(b){angular.forEach(b,function(b){a(b)?e.headingElement=b:c.append(b)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).directive("timepicker",["$parse","$log","timepickerConfig","$locale",function(a,b,c,d){return{restrict:"EA",require:"?^ngModel",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(e,f,g,h){function i(){var a=parseInt(e.hours,10),b=e.showMeridian?a>0&&13>a:a>=0&&24>a;return b?(e.showMeridian&&(12===a&&(a=0),e.meridian===q[1]&&(a+=12)),a):void 0}function j(){var a=parseInt(e.minutes,10);return a>=0&&60>a?a:void 0}function k(a){return angular.isDefined(a)&&a.toString().length<2?"0"+a:a}function l(a){m(),h.$setViewValue(new Date(p)),n(a)}function m(){h.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function n(a){var b=p.getHours(),c=p.getMinutes();e.showMeridian&&(b=0===b||12===b?12:b%12),e.hours="h"===a?b:k(b),e.minutes="m"===a?c:k(c),e.meridian=p.getHours()<12?q[0]:q[1]}function o(a){var b=new Date(p.getTime()+6e4*a);p.setHours(b.getHours(),b.getMinutes()),l()}if(h){var p=new Date,q=angular.isDefined(g.meridians)?e.$parent.$eval(g.meridians):c.meridians||d.DATETIME_FORMATS.AMPMS,r=c.hourStep;g.hourStep&&e.$parent.$watch(a(g.hourStep),function(a){r=parseInt(a,10)});var s=c.minuteStep;g.minuteStep&&e.$parent.$watch(a(g.minuteStep),function(a){s=parseInt(a,10)}),e.showMeridian=c.showMeridian,g.showMeridian&&e.$parent.$watch(a(g.showMeridian),function(a){if(e.showMeridian=!!a,h.$error.time){var b=i(),c=j();angular.isDefined(b)&&angular.isDefined(c)&&(p.setHours(b),l())}else n()});var t=f.find("input"),u=t.eq(0),v=t.eq(1),w=angular.isDefined(g.mousewheel)?e.$eval(g.mousewheel):c.mousewheel;if(w){var x=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};u.bind("mousewheel wheel",function(a){e.$apply(x(a)?e.incrementHours():e.decrementHours()),a.preventDefault()}),v.bind("mousewheel wheel",function(a){e.$apply(x(a)?e.incrementMinutes():e.decrementMinutes()),a.preventDefault()})}if(e.readonlyInput=angular.isDefined(g.readonlyInput)?e.$eval(g.readonlyInput):c.readonlyInput,e.readonlyInput)e.updateHours=angular.noop,e.updateMinutes=angular.noop;else{var y=function(a,b){h.$setViewValue(null),h.$setValidity("time",!1),angular.isDefined(a)&&(e.invalidHours=a),angular.isDefined(b)&&(e.invalidMinutes=b)};e.updateHours=function(){var a=i();angular.isDefined(a)?(p.setHours(a),l("h")):y(!0)},u.bind("blur",function(){!e.validHours&&e.hours<10&&e.$apply(function(){e.hours=k(e.hours)})}),e.updateMinutes=function(){var a=j();angular.isDefined(a)?(p.setMinutes(a),l("m")):y(void 0,!0)},v.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=k(e.minutes)})})}h.$render=function(){var a=h.$modelValue?new Date(h.$modelValue):null;isNaN(a)?(h.$setValidity("time",!1),b.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(a&&(p=a),m(),n())},e.incrementHours=function(){o(60*r)},e.decrementHours=function(){o(60*-r)},e.incrementMinutes=function(){o(s)},e.decrementMinutes=function(){o(-s)},e.toggleMeridian=function(){o(720*(p.getHours()<12?1:-1))}}}}}]),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(a){var b=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+c+"'.");return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(i,j,k,l){var m,n=i.$eval(k.typeaheadMinLength)||1,o=i.$eval(k.typeaheadWaitMs)||0,p=i.$eval(k.typeaheadEditable)!==!1,q=b(k.typeaheadLoading).assign||angular.noop,r=b(k.typeaheadOnSelect),s=k.typeaheadInputFormatter?b(k.typeaheadInputFormatter):void 0,t=k.typeaheadAppendToBody?b(k.typeaheadAppendToBody):!1,u=b(k.ngModel).assign,v=g.parse(k.typeahead),w=angular.element("<div typeahead-popup></div>");w.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(k.typeaheadTemplateUrl)&&w.attr("template-url",k.typeaheadTemplateUrl);var x=i.$new();i.$on("$destroy",function(){x.$destroy()});var y=function(){x.matches=[],x.activeIdx=-1},z=function(a){var b={$viewValue:a};q(i,!0),c.when(v.source(i,b)).then(function(c){if(a===l.$viewValue&&m){if(c.length>0){x.activeIdx=0,x.matches.length=0;for(var d=0;d<c.length;d++)b[v.itemName]=c[d],x.matches.push({label:v.viewMapper(x,b),model:c[d]});x.query=a,x.position=t?f.offset(j):f.position(j),x.position.top=x.position.top+j.prop("offsetHeight")}else y();q(i,!1)}},function(){y(),q(i,!1)})};y(),x.query=void 0;var A;l.$parsers.unshift(function(a){return m=!0,a&&a.length>=n?o>0?(A&&d.cancel(A),A=d(function(){z(a)},o)):z(a):(q(i,!1),y()),p?a:a?void l.$setValidity("editable",!1):(l.$setValidity("editable",!0),a)}),l.$formatters.push(function(a){var b,c,d={};return s?(d.$model=a,s(i,d)):(d[v.itemName]=a,b=v.viewMapper(i,d),d[v.itemName]=void 0,c=v.viewMapper(i,d),b!==c?b:a)}),x.select=function(a){var b,c,d={};d[v.itemName]=c=x.matches[a].model,b=v.modelMapper(i,d),u(i,b),l.$setValidity("editable",!0),r(i,{$item:c,$model:b,$label:v.viewMapper(i,d)}),y(),j[0].focus()},j.bind("keydown",function(a){0!==x.matches.length&&-1!==h.indexOf(a.which)&&(a.preventDefault(),40===a.which?(x.activeIdx=(x.activeIdx+1)%x.matches.length,x.$digest()):38===a.which?(x.activeIdx=(x.activeIdx?x.activeIdx:x.matches.length)-1,x.$digest()):13===a.which||9===a.which?x.$apply(function(){x.select(x.activeIdx)}):27===a.which&&(a.stopPropagation(),y(),x.$digest()))}),j.bind("blur",function(){m=!1});var B=function(a){j[0]!==a.target&&(y(),x.$digest())};e.bind("click",B),i.$on("$destroy",function(){e.unbind("click",B)});var C=a(w)(x);t?e.find("body").append(C):j.after(C)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("typeaheadHighlight",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?b.replace(new RegExp(a(c),"gi"),"<strong>$&</strong>"):b}}),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdownToggle","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/popup.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==f.style[b])return a[b]}var e=function(d,f,g){g=g||{};var h=a.defer(),i=e[g.animation?"animationEndEventName":"transitionEndEventName"],j=function(){c.$apply(function(){d.unbind(i,j),h.resolve(d)})};return i&&d.bind(i,j),b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f),i||h.resolve(d)}),h.promise.cancel=function(){i&&d.unbind(i,j),h.reject("Transition cancelled")},h.promise},f=document.createElement("trans"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},h={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return e.transitionEndEventName=d(g),e.animationEndEventName=d(h),e}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(a){return{link:function(b,c,d){function e(b){function d(){j===e&&(j=void 0)}var e=a(c,b);return j&&j.cancel(),j=e,e.then(d,d),e}function f(){k?(k=!1,g()):(c.removeClass("collapse").addClass("collapsing"),e({height:c[0].scrollHeight+"px"}).then(g))}function g(){c.removeClass("collapsing"),c.addClass("collapse in"),c.css({height:"auto"})}function h(){k?(k=!1,i(),c.css({height:0})):(c.css({height:c[0].scrollHeight+"px"}),c[0].offsetWidth,c.removeClass("collapse in").addClass("collapsing"),e({height:0}).then(i))}function i(){c.removeClass("collapsing"),c.addClass("collapse")}var j,k=!0;b.$watch(d.collapse,function(a){a?h():f()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(a,b,c){this.groups=[],this.closeOthers=function(d){var e=angular.isDefined(b.closeOthers)?a.$eval(b.closeOthers):c.closeOthers;e&&angular.forEach(this.groups,function(a){a!==d&&(a.isOpen=!1)})},this.addGroup=function(a){var b=this;this.groups.push(a),a.$on("$destroy",function(){b.removeGroup(a)})},this.removeGroup=function(a){var b=this.groups.indexOf(a);-1!==b&&this.groups.splice(this.groups.indexOf(a),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse",function(a){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:function(){this.setHeading=function(a){this.heading=a}},link:function(b,c,d,e){var f,g;e.addGroup(b),b.isOpen=!1,d.isOpen&&(f=a(d.isOpen),g=f.assign,b.$parent.$watch(f,function(a){b.isOpen=!!a})),b.$watch("isOpen",function(a){a&&e.closeOthers(b),g&&g(b.$parent,a)})}}}]).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(a,b,c){return function(a,b,d,e){e.setHeading(c(a,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(a,b,c,d){a.$watch(function(){return d[c.accordionTransclude]},function(a){a&&(b.html(""),b.append(a))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(a,b){a.closeable="close"in b}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(a,b,c){b.addClass("ng-binding").data("$binding",c.bindHtmlUnsafe),a.$watch(c.bindHtmlUnsafe,function(a){b.html(a||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(a){this.activeClass=a.activeClass||"active",this.toggleEvent=a.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){var e=d[0],f=d[1];f.$render=function(){b.toggleClass(e.activeClass,angular.equals(f.$modelValue,a.$eval(c.btnRadio)))},b.bind(e.toggleEvent,function(){b.hasClass(e.activeClass)||a.$apply(function(){f.$setViewValue(a.$eval(c.btnRadio)),f.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){function e(){return g(c.btnCheckboxTrue,!0)}function f(){return g(c.btnCheckboxFalse,!1)}function g(b,c){var d=a.$eval(b);return angular.isDefined(d)?d:c}var h=d[0],i=d[1];i.$render=function(){b.toggleClass(h.activeClass,angular.equals(i.$modelValue,e()))},b.bind(h.toggleEvent,function(){a.$apply(function(){i.$setViewValue(b.hasClass(h.activeClass)?f():e()),i.$render()})})}}}),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(a,b,c){function d(){e();var c=+a.interval;!isNaN(c)&&c>=0&&(g=b(f,c))}function e(){g&&(b.cancel(g),g=null)}function f(){h?(a.next(),d()):a.pause()}var g,h,i=this,j=i.slides=[],k=-1;i.currentSlide=null;var l=!1;i.select=function(e,f){function g(){l||(i.currentSlide&&angular.isString(f)&&!a.noTransition&&e.$element?(e.$element.addClass(f),e.$element[0].offsetWidth,angular.forEach(j,function(a){angular.extend(a,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(e,{direction:f,active:!0,entering:!0}),angular.extend(i.currentSlide||{},{direction:f,leaving:!0}),a.$currentTransition=c(e.$element,{}),function(b,c){a.$currentTransition.then(function(){h(b,c)},function(){h(b,c)})}(e,i.currentSlide)):h(e,i.currentSlide),i.currentSlide=e,k=m,d())}function h(b,c){angular.extend(b,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(c||{},{direction:"",active:!1,leaving:!1,entering:!1}),a.$currentTransition=null}var m=j.indexOf(e);void 0===f&&(f=m>k?"next":"prev"),e&&e!==i.currentSlide&&(a.$currentTransition?(a.$currentTransition.cancel(),b(g)):g())},a.$on("$destroy",function(){l=!0}),i.indexOfSlide=function(a){return j.indexOf(a)},a.next=function(){var b=(k+1)%j.length;return a.$currentTransition?void 0:i.select(j[b],"next")},a.prev=function(){var b=0>k-1?j.length-1:k-1;return a.$currentTransition?void 0:i.select(j[b],"prev")},a.select=function(a){i.select(a)},a.isActive=function(a){return i.currentSlide===a},a.slides=function(){return j},a.$watch("interval",d),a.$on("$destroy",e),a.play=function(){h||(h=!0,d())},a.pause=function(){a.noPause||(h=!1,e())},i.addSlide=function(b,c){b.$element=c,j.push(b),1===j.length||b.active?(i.select(j[j.length-1]),1==j.length&&a.play()):b.active=!1},i.removeSlide=function(a){var b=j.indexOf(a);j.splice(b,1),j.length>0&&a.active?i.select(b>=j.length?j[b-1]:j[b]):k>b&&k--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",["$parse",function(a){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{},link:function(b,c,d,e){if(d.active){var f=a(d.active),g=f.assign,h=b.active=f(b.$parent);b.$watch(function(){var a=f(b.$parent);return a!==b.active&&(a!==h?h=b.active=a:g(b.$parent,a=h=b.active)),a})}e.addSlide(b,c),b.$on("$destroy",function(){e.removeSlide(b)}),b.$watch("active",function(a){a&&e.select(b)})}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(a,b){function c(a,c){return a.currentStyle?a.currentStyle[c]:b.getComputedStyle?b.getComputedStyle(a)[c]:a.style[c]}function d(a){return"static"===(c(a,"position")||"static")}var e=function(b){for(var c=a[0],e=b.offsetParent||c;e&&e!==c&&d(e);)e=e.offsetParent;return e||c};return{position:function(b){var c=this.offset(b),d={top:0,left:0},f=e(b[0]);f!=a[0]&&(d=this.offset(angular.element(f)),d.top+=f.clientTop-f.scrollTop,d.left+=f.clientLeft-f.scrollLeft);var g=b[0].getBoundingClientRect();return{width:g.width||b.prop("offsetWidth"),height:g.height||b.prop("offsetHeight"),top:c.top-d.top,left:c.left-d.left}},offset:function(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(b.pageYOffset||a[0].body.scrollTop||a[0].documentElement.scrollTop),left:d.left+(b.pageXOffset||a[0].body.scrollLeft||a[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.position"]).constant("datepickerConfig",{dayFormat:"dd",monthFormat:"MMMM",yearFormat:"yyyy",dayHeaderFormat:"EEE",dayTitleFormat:"MMMM yyyy",monthTitleFormat:"yyyy",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","dateFilter","datepickerConfig",function(a,b,c,d){function e(b,c){return angular.isDefined(b)?a.$parent.$eval(b):c}function f(a,b){return new Date(a,b,0).getDate()}function g(a,b){for(var c=new Array(b),d=a,e=0;b>e;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function h(a,b,d,e){return{date:a,label:c(a,b),selected:!!d,secondary:!!e}}var i={day:e(b.dayFormat,d.dayFormat),month:e(b.monthFormat,d.monthFormat),year:e(b.yearFormat,d.yearFormat),dayHeader:e(b.dayHeaderFormat,d.dayHeaderFormat),dayTitle:e(b.dayTitleFormat,d.dayTitleFormat),monthTitle:e(b.monthTitleFormat,d.monthTitleFormat)},j=e(b.startingDay,d.startingDay),k=e(b.yearRange,d.yearRange);this.minDate=d.minDate?new Date(d.minDate):null,this.maxDate=d.maxDate?new Date(d.maxDate):null,this.modes=[{name:"day",getVisibleDates:function(a,b){var d=a.getFullYear(),e=a.getMonth(),k=new Date(d,e,1),l=j-k.getDay(),m=l>0?7-l:-l,n=new Date(k),o=0;m>0&&(n.setDate(-m+1),o+=m),o+=f(d,e+1),o+=(7-o%7)%7;for(var p=g(n,o),q=new Array(7),r=0;o>r;r++){var s=new Date(p[r]);p[r]=h(s,i.day,b&&b.getDate()===s.getDate()&&b.getMonth()===s.getMonth()&&b.getFullYear()===s.getFullYear(),s.getMonth()!==e)}for(var t=0;7>t;t++)q[t]=c(p[t].date,i.dayHeader);return{objects:p,title:c(a,i.dayTitle),labels:q}},compare:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},split:7,step:{months:1}},{name:"month",getVisibleDates:function(a,b){for(var d=new Array(12),e=a.getFullYear(),f=0;12>f;f++){var g=new Date(e,f,1);d[f]=h(g,i.month,b&&b.getMonth()===f&&b.getFullYear()===e)}return{objects:d,title:c(a,i.monthTitle)}},compare:function(a,b){return new Date(a.getFullYear(),a.getMonth())-new Date(b.getFullYear(),b.getMonth())},split:3,step:{years:1}},{name:"year",getVisibleDates:function(a,b){for(var c=new Array(k),d=a.getFullYear(),e=parseInt((d-1)/k,10)*k+1,f=0;k>f;f++){var g=new Date(e+f,0,1);c[f]=h(g,i.year,b&&b.getFullYear()===g.getFullYear())}return{objects:c,title:[c[0].label,c[k-1].label].join(" - ")}},compare:function(a,b){return a.getFullYear()-b.getFullYear()},split:5,step:{years:k}}],this.isDisabled=function(b,c){var d=this.modes[c||0];return this.minDate&&d.compare(b,this.minDate)<0||this.maxDate&&d.compare(b,this.maxDate)>0||a.dateDisabled&&a.dateDisabled({date:b,mode:d.name})}}]).directive("datepicker",["dateFilter","$parse","datepickerConfig","$log",function(a,b,c,d){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(a,e,f,g){function h(){a.showWeekNumbers=0===o&&q}function i(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c}function j(b){var c=null,e=!0;n.$modelValue&&(c=new Date(n.$modelValue),isNaN(c)?(e=!1,d.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):b&&(p=c)),n.$setValidity("date",e);var f=m.modes[o],g=f.getVisibleDates(p,c);angular.forEach(g.objects,function(a){a.disabled=m.isDisabled(a.date,o)}),n.$setValidity("date-disabled",!c||!m.isDisabled(c)),a.rows=i(g.objects,f.split),a.labels=g.labels||[],a.title=g.title}function k(a){o=a,h(),j()}function l(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}var m=g[0],n=g[1];if(n){var o=0,p=new Date,q=c.showWeeks;f.showWeeks?a.$parent.$watch(b(f.showWeeks),function(a){q=!!a,h()}):h(),f.min&&a.$parent.$watch(b(f.min),function(a){m.minDate=a?new Date(a):null,j()}),f.max&&a.$parent.$watch(b(f.max),function(a){m.maxDate=a?new Date(a):null,j()}),n.$render=function(){j(!0)},a.select=function(a){if(0===o){var b=n.$modelValue?new Date(n.$modelValue):new Date(0,0,0,0,0,0,0);b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),n.$setViewValue(b),j(!0)}else p=a,k(o-1)},a.move=function(a){var b=m.modes[o].step;p.setMonth(p.getMonth()+a*(b.months||0)),p.setFullYear(p.getFullYear()+a*(b.years||0)),j()},a.toggleMode=function(){k((o+1)%m.modes.length)},a.getWeekNumber=function(b){return 0===o&&a.showWeekNumbers&&7===b.length?l(b[0].date):null}}}}}]).constant("datepickerPopupConfig",{dateFormat:"yyyy-MM-dd",currentText:"Today",toggleWeeksText:"Weeks",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","datepickerPopupConfig","datepickerConfig",function(a,b,c,d,e,f,g){return{restrict:"EA",require:"ngModel",link:function(h,i,j,k){function l(a){u?u(h,!!a):q.isOpen=!!a}function m(a){if(a){if(angular.isDate(a))return k.$setValidity("date",!0),a;if(angular.isString(a)){var b=new Date(a);return isNaN(b)?void k.$setValidity("date",!1):(k.$setValidity("date",!0),b)}return void k.$setValidity("date",!1)}return k.$setValidity("date",!0),null}function n(a,c,d){a&&(h.$watch(b(a),function(a){q[c]=a}),y.attr(d||c,c))}function o(){q.position=s?d.offset(i):d.position(i),q.position.top=q.position.top+i.prop("offsetHeight")}var p,q=h.$new(),r=angular.isDefined(j.closeOnDateSelection)?h.$eval(j.closeOnDateSelection):f.closeOnDateSelection,s=angular.isDefined(j.datepickerAppendToBody)?h.$eval(j.datepickerAppendToBody):f.appendToBody;j.$observe("datepickerPopup",function(a){p=a||f.dateFormat,k.$render()}),q.showButtonBar=angular.isDefined(j.showButtonBar)?h.$eval(j.showButtonBar):f.showButtonBar,h.$on("$destroy",function(){B.remove(),q.$destroy()}),j.$observe("currentText",function(a){q.currentText=angular.isDefined(a)?a:f.currentText}),j.$observe("toggleWeeksText",function(a){q.toggleWeeksText=angular.isDefined(a)?a:f.toggleWeeksText}),j.$observe("clearText",function(a){q.clearText=angular.isDefined(a)?a:f.clearText}),j.$observe("closeText",function(a){q.closeText=angular.isDefined(a)?a:f.closeText});var t,u;j.isOpen&&(t=b(j.isOpen),u=t.assign,h.$watch(t,function(a){q.isOpen=!!a})),q.isOpen=t?t(h):!1;var v=function(a){q.isOpen&&a.target!==i[0]&&q.$apply(function(){l(!1)})},w=function(){q.$apply(function(){l(!0)})},x=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");x.attr({"ng-model":"date","ng-change":"dateSelection()"});var y=angular.element(x.children()[0]);j.datepickerOptions&&y.attr(angular.extend({},h.$eval(j.datepickerOptions))),k.$parsers.unshift(m),q.dateSelection=function(a){angular.isDefined(a)&&(q.date=a),k.$setViewValue(q.date),k.$render(),r&&l(!1)},i.bind("input change keyup",function(){q.$apply(function(){q.date=k.$modelValue})}),k.$render=function(){var a=k.$viewValue?e(k.$viewValue,p):"";i.val(a),q.date=k.$modelValue},n(j.min,"min"),n(j.max,"max"),j.showWeeks?n(j.showWeeks,"showWeeks","show-weeks"):(q.showWeeks=g.showWeeks,y.attr("show-weeks","showWeeks")),j.dateDisabled&&y.attr("date-disabled",j.dateDisabled);
var z=!1,A=!1;q.$watch("isOpen",function(a){a?(o(),c.bind("click",v),A&&i.unbind("focus",w),i[0].focus(),z=!0):(z&&c.unbind("click",v),i.bind("focus",w),A=!0),u&&u(h,a)}),q.today=function(){q.dateSelection(new Date)},q.clear=function(){q.dateSelection(null)};var B=a(x)(q);s?c.find("body").append(B):i.after(B)}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(a,b){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(a){var b=null,c=angular.noop;return{restrict:"CA",link:function(d,e){d.$watch("$location.path",function(){c()}),e.parent().bind("click",function(){c()}),e.bind("click",function(d){var f=e===b;d.preventDefault(),d.stopPropagation(),b&&c(),f||e.hasClass("disabled")||e.prop("disabled")||(e.parent().addClass("open"),b=e,c=function(d){d&&(d.preventDefault(),d.stopPropagation()),a.unbind("click",c),e.parent().removeClass("open"),c=angular.noop,b=null},a.bind("click",c))})}}}]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(c,d,e){c.windowClass=e.windowClass||"",b(function(){c.animate=!0,d[0].focus()}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(b){var c=a.find("body").eq(0),d=k.get(b).value;k.remove(b),d.modalDomEl.remove(),c.toggleClass(i,k.length()>0),h&&-1==e()&&(h.remove(),h=void 0),d.modalScope.$destroy()}var g,h,i="modal-open",j=c.$new(!0),k=d.createNew(),l={};return c.$watch(e,function(a){j.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(c,d){k.add(c,{deferred:d.deferred,modalScope:d.scope,backdrop:d.backdrop,keyboard:d.keyboard});var f=a.find("body").eq(0);e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(j),f.append(h));var l=angular.element("<div modal-window></div>");l.attr("window-class",d.windowClass),l.attr("index",k.length()-1),l.html(d.content);var m=b(l)(d.scope);k.top().value.modalDomEl=m,f.append(m),f.addClass(i)},l.close=function(a,b){var c=k.get(a).value;c&&(c.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function(a,b,c,d){var e=this,f=b.numPages?c(b.numPages).assign:angular.noop;this.init=function(d){b.itemsPerPage?a.$parent.$watch(c(b.itemsPerPage),function(b){e.itemsPerPage=parseInt(b,10),a.totalPages=e.calculateTotalPages()}):this.itemsPerPage=d},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===a.totalPages},this.isActive=function(a){return this.page===a},this.calculateTotalPages=function(){var b=this.itemsPerPage<1?1:Math.ceil(a.totalItems/this.itemsPerPage);return Math.max(b||0,1)},this.getAttributeValue=function(b,c,e){return angular.isDefined(b)?e?d(b)(a.$parent):a.$parent.$eval(b):c},this.render=function(){this.page=parseInt(a.page,10)||1,this.page>0&&this.page<=a.totalPages&&(a.pages=this.getPages(this.page,a.totalPages))},a.selectPage=function(b){!e.isActive(b)&&b>0&&b<=a.totalPages&&(a.page=b,a.onSelectPage({page:b}))},a.$watch("page",function(){e.render()}),a.$watch("totalItems",function(){a.totalPages=e.calculateTotalPages()}),a.$watch("totalPages",function(b){f(a.$parent,b),e.page>b?a.selectPage(b):e.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(a,b){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(c,d,e,f){function g(a,b,c,d){return{number:a,text:b,active:c,disabled:d}}var h,i=f.getAttributeValue(e.boundaryLinks,b.boundaryLinks),j=f.getAttributeValue(e.directionLinks,b.directionLinks),k=f.getAttributeValue(e.firstText,b.firstText,!0),l=f.getAttributeValue(e.previousText,b.previousText,!0),m=f.getAttributeValue(e.nextText,b.nextText,!0),n=f.getAttributeValue(e.lastText,b.lastText,!0),o=f.getAttributeValue(e.rotate,b.rotate);f.init(b.itemsPerPage),e.maxSize&&c.$parent.$watch(a(e.maxSize),function(a){h=parseInt(a,10),f.render()}),f.getPages=function(a,b){var c=[],d=1,e=b,p=angular.isDefined(h)&&b>h;p&&(o?(d=Math.max(a-Math.floor(h/2),1),e=d+h-1,e>b&&(e=b,d=e-h+1)):(d=(Math.ceil(a/h)-1)*h+1,e=Math.min(d+h-1,b)));for(var q=d;e>=q;q++){var r=g(q,q,f.isActive(q),!1);c.push(r)}if(p&&!o){if(d>1){var s=g(d-1,"...",!1,!1);c.unshift(s)}if(b>e){var t=g(e+1,"...",!1,!1);c.push(t)}}if(j){var u=g(a-1,l,!1,f.noPrevious());c.unshift(u);var v=g(a+1,m,!1,f.noNext());c.push(v)}if(i){var w=g(1,k,!1,f.noPrevious());c.unshift(w);var x=g(b,n,!1,f.noNext());c.push(x)}return c}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:" Previous",nextText:"Next ",align:!0}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(b,c,d,e){function f(a,b,c,d,e){return{number:a,text:b,disabled:c,previous:i&&d,next:i&&e}}var g=e.getAttributeValue(d.previousText,a.previousText,!0),h=e.getAttributeValue(d.nextText,a.nextText,!0),i=e.getAttributeValue(d.align,a.align);e.init(a.itemsPerPage),e.getPages=function(a){return[f(a-1,g,e.noPrevious(),!0,!1),f(a+1,h,e.noNext(),!1,!0)]}}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function a(a){var b=/[A-Z]/g,c="-";return a.replace(b,function(a,b){return(b?c:"")+a.toLowerCase()})}var b={placement:"top",animation:!0,popupDelay:0},c={mouseenter:"mouseleave",click:"click",focus:"blur"},d={};this.options=function(a){angular.extend(d,a)},this.setTriggers=function(a){angular.extend(c,a)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(e,f,g,h,i,j,k){return function(e,l,m){function n(a){var b=a||o.trigger||m,d=c[b]||b;return{show:b,hide:d}}var o=angular.extend({},b,d),p=a(e),q=k.startSymbol(),r=k.endSymbol(),s="<div "+p+'-popup title="'+q+"tt_title"+r+'" content="'+q+"tt_content"+r+'" placement="'+q+"tt_placement"+r+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,link:function(a,b,c){function d(){a.tt_isOpen?m():k()}function k(){(!y||a.$eval(c[l+"Enable"]))&&(a.tt_popupDelay?(t=g(p,a.tt_popupDelay),t.then(function(a){a()})):a.$apply(p)())}function m(){a.$apply(function(){q()})}function p(){return a.tt_content?(r&&g.cancel(r),u.css({top:0,left:0,display:"block"}),v?i.find("body").append(u):b.after(u),z(),a.tt_isOpen=!0,z):angular.noop}function q(){a.tt_isOpen=!1,g.cancel(t),a.tt_animation?r=g(function(){u.remove()},500):u.remove()}var r,t,u=f(s)(a),v=angular.isDefined(o.appendToBody)?o.appendToBody:!1,w=n(void 0),x=!1,y=angular.isDefined(c[l+"Enable"]),z=function(){var c,d,e,f;switch(c=v?j.offset(b):j.position(b),d=u.prop("offsetWidth"),e=u.prop("offsetHeight"),a.tt_placement){case"right":f={top:c.top+c.height/2-e/2,left:c.left+c.width};break;case"bottom":f={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"left":f={top:c.top+c.height/2-e/2,left:c.left-d};break;default:f={top:c.top-e,left:c.left+c.width/2-d/2}}f.top+="px",f.left+="px",u.css(f)};a.tt_isOpen=!1,c.$observe(e,function(b){a.tt_content=b,!b&&a.tt_isOpen&&q()}),c.$observe(l+"Title",function(b){a.tt_title=b}),c.$observe(l+"Placement",function(b){a.tt_placement=angular.isDefined(b)?b:o.placement}),c.$observe(l+"PopupDelay",function(b){var c=parseInt(b,10);a.tt_popupDelay=isNaN(c)?o.popupDelay:c});var A=function(){x&&(b.unbind(w.show,k),b.unbind(w.hide,m))};c.$observe(l+"Trigger",function(a){A(),w=n(a),w.show===w.hide?b.bind(w.show,d):(b.bind(w.show,k),b.bind(w.hide,m)),x=!0});var B=a.$eval(c[l+"Animation"]);a.tt_animation=angular.isDefined(B)?!!B:o.animation,c.$observe(l+"AppendToBody",function(b){v=angular.isDefined(b)?h(b)(a):v}),v&&a.$on("$locationChangeSuccess",function(){a.tt_isOpen&&q()}),a.$on("$destroy",function(){g.cancel(r),g.cancel(t),A(),u.remove(),u.unbind(),u=null})}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(a){return a("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(a){return a("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$compile","$timeout","$parse","$window","$tooltip",function(a,b,c,d,e){return e("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",["ui.bootstrap.transition"]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig","$transition",function(a,b,c,d){var e=this,f=[],g=angular.isDefined(b.max)?a.$parent.$eval(b.max):c.max,h=angular.isDefined(b.animate)?a.$parent.$eval(b.animate):c.animate;this.addBar=function(a,b){var c=0,d=a.$parent.$index;angular.isDefined(d)&&f[d]&&(c=f[d].value),f.push(a),this.update(b,a.value,c),a.$watch("value",function(a,c){a!==c&&e.update(b,a,c)}),a.$on("$destroy",function(){e.removeBar(a)})},this.update=function(a,b,c){var e=this.getPercentage(b);h?(a.css("width",this.getPercentage(c)+"%"),d(a,{width:e+"%"})):a.css({transition:"none",width:e+"%"})},this.removeBar=function(a){f.splice(f.indexOf(a),1)},this.getPercentage=function(a){return Math.round(100*a/g)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},template:'<div class="progress" ng-transclude></div>'}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(a,b,c,d){d.addBar(a,b)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(a,b,c,d){d.addBar(a,angular.element(b.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","$parse","ratingConfig",function(a,b,c,d){this.maxRange=angular.isDefined(b.max)?a.$parent.$eval(b.max):d.max,this.stateOn=angular.isDefined(b.stateOn)?a.$parent.$eval(b.stateOn):d.stateOn,this.stateOff=angular.isDefined(b.stateOff)?a.$parent.$eval(b.stateOff):d.stateOff,this.createRateObjects=function(a){for(var b={stateOn:this.stateOn,stateOff:this.stateOff},c=0,d=a.length;d>c;c++)a[c]=angular.extend({index:c},b,a[c]);return a},a.range=this.createRateObjects(angular.isDefined(b.ratingStates)?angular.copy(a.$parent.$eval(b.ratingStates)):new Array(this.maxRange)),a.rate=function(b){a.readonly||a.value===b||(a.value=b)},a.enter=function(b){a.readonly||(a.val=b),a.onHover({value:b})},a.reset=function(){a.val=angular.copy(a.value),a.onLeave()},a.$watch("value",function(b){a.val=b}),a.readonly=!1,b.readonly&&a.$parent.$watch(c(b.readonly),function(b){a.readonly=!!b})}]).directive("rating",function(){return{restrict:"EA",scope:{value:"=",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function(a){var b=this,c=b.tabs=a.tabs=[];b.select=function(a){angular.forEach(c,function(a){a.active=!1}),a.active=!0},b.addTab=function(a){c.push(a),(1===c.length||a.active)&&b.select(a)},b.removeTab=function(a){var d=c.indexOf(a);if(a.active&&c.length>1){var e=d==c.length-1?d-1:d+1;b.select(c[e])}c.splice(d,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(a,b,c){a.vertical=angular.isDefined(c.vertical)?a.$parent.$eval(c.vertical):!1,a.justified=angular.isDefined(c.justified)?a.$parent.$eval(c.justified):!1,a.type=angular.isDefined(c.type)?a.$parent.$eval(c.type):"tabs"}}}).directive("tab",["$parse",function(a){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(b,c,d){return function(b,c,e,f){var g,h;e.active?(g=a(e.active),h=g.assign,b.$parent.$watch(g,function(a,c){a!==c&&(b.active=!!a)}),b.active=g(b.$parent)):h=g=angular.noop,b.$watch("active",function(a){h(b.$parent,a),a?(f.select(b),b.onSelect()):b.onDeselect()}),b.disabled=!1,e.disabled&&b.$parent.$watch(a(e.disabled),function(a){b.disabled=!!a}),b.select=function(){b.disabled||(b.active=!0)},f.addTab(b),b.$on("$destroy",function(){f.removeTab(b)}),b.$transcludeFn=d}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(a,b){a.$watch("headingElement",function(a){a&&(b.html(""),b.append(a))})}}}]).directive("tabContentTransclude",function(){function a(a){return a.tagName&&(a.hasAttribute("tab-heading")||a.hasAttribute("data-tab-heading")||"tab-heading"===a.tagName.toLowerCase()||"data-tab-heading"===a.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(b,c,d){var e=b.$eval(d.tabContentTransclude);e.$transcludeFn(e.$parent,function(b){angular.forEach(b,function(b){a(b)?e.headingElement=b:c.append(b)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).directive("timepicker",["$parse","$log","timepickerConfig","$locale",function(a,b,c,d){return{restrict:"EA",require:"?^ngModel",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(e,f,g,h){function i(){var a=parseInt(e.hours,10),b=e.showMeridian?a>0&&13>a:a>=0&&24>a;return b?(e.showMeridian&&(12===a&&(a=0),e.meridian===q[1]&&(a+=12)),a):void 0}function j(){var a=parseInt(e.minutes,10);return a>=0&&60>a?a:void 0}function k(a){return angular.isDefined(a)&&a.toString().length<2?"0"+a:a}function l(a){m(),h.$setViewValue(new Date(p)),n(a)}function m(){h.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function n(a){var b=p.getHours(),c=p.getMinutes();e.showMeridian&&(b=0===b||12===b?12:b%12),e.hours="h"===a?b:k(b),e.minutes="m"===a?c:k(c),e.meridian=p.getHours()<12?q[0]:q[1]}function o(a){var b=new Date(p.getTime()+6e4*a);p.setHours(b.getHours(),b.getMinutes()),l()}if(h){var p=new Date,q=angular.isDefined(g.meridians)?e.$parent.$eval(g.meridians):c.meridians||d.DATETIME_FORMATS.AMPMS,r=c.hourStep;g.hourStep&&e.$parent.$watch(a(g.hourStep),function(a){r=parseInt(a,10)});var s=c.minuteStep;g.minuteStep&&e.$parent.$watch(a(g.minuteStep),function(a){s=parseInt(a,10)}),e.showMeridian=c.showMeridian,g.showMeridian&&e.$parent.$watch(a(g.showMeridian),function(a){if(e.showMeridian=!!a,h.$error.time){var b=i(),c=j();angular.isDefined(b)&&angular.isDefined(c)&&(p.setHours(b),l())}else n()});var t=f.find("input"),u=t.eq(0),v=t.eq(1),w=angular.isDefined(g.mousewheel)?e.$eval(g.mousewheel):c.mousewheel;if(w){var x=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};u.bind("mousewheel wheel",function(a){e.$apply(x(a)?e.incrementHours():e.decrementHours()),a.preventDefault()}),v.bind("mousewheel wheel",function(a){e.$apply(x(a)?e.incrementMinutes():e.decrementMinutes()),a.preventDefault()})}if(e.readonlyInput=angular.isDefined(g.readonlyInput)?e.$eval(g.readonlyInput):c.readonlyInput,e.readonlyInput)e.updateHours=angular.noop,e.updateMinutes=angular.noop;else{var y=function(a,b){h.$setViewValue(null),h.$setValidity("time",!1),angular.isDefined(a)&&(e.invalidHours=a),angular.isDefined(b)&&(e.invalidMinutes=b)};e.updateHours=function(){var a=i();angular.isDefined(a)?(p.setHours(a),l("h")):y(!0)},u.bind("blur",function(){!e.validHours&&e.hours<10&&e.$apply(function(){e.hours=k(e.hours)})}),e.updateMinutes=function(){var a=j();angular.isDefined(a)?(p.setMinutes(a),l("m")):y(void 0,!0)},v.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=k(e.minutes)})})}h.$render=function(){var a=h.$modelValue?new Date(h.$modelValue):null;isNaN(a)?(h.$setValidity("time",!1),b.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(a&&(p=a),m(),n())},e.incrementHours=function(){o(60*r)},e.decrementHours=function(){o(60*-r)},e.incrementMinutes=function(){o(s)},e.decrementMinutes=function(){o(-s)},e.toggleMeridian=function(){o(720*(p.getHours()<12?1:-1))}}}}}]),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(a){var b=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+c+"'.");return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(i,j,k,l){var m,n=i.$eval(k.typeaheadMinLength)||1,o=i.$eval(k.typeaheadWaitMs)||0,p=i.$eval(k.typeaheadEditable)!==!1,q=b(k.typeaheadLoading).assign||angular.noop,r=b(k.typeaheadOnSelect),s=k.typeaheadInputFormatter?b(k.typeaheadInputFormatter):void 0,t=k.typeaheadAppendToBody?b(k.typeaheadAppendToBody):!1,u=b(k.ngModel).assign,v=g.parse(k.typeahead),w=angular.element("<div typeahead-popup></div>");w.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(k.typeaheadTemplateUrl)&&w.attr("template-url",k.typeaheadTemplateUrl);var x=i.$new();i.$on("$destroy",function(){x.$destroy()});var y=function(){x.matches=[],x.activeIdx=-1},z=function(a){var b={$viewValue:a};q(i,!0),c.when(v.source(i,b)).then(function(c){if(a===l.$viewValue&&m){if(c.length>0){x.activeIdx=0,x.matches.length=0;for(var d=0;d<c.length;d++)b[v.itemName]=c[d],x.matches.push({label:v.viewMapper(x,b),model:c[d]});x.query=a,x.position=t?f.offset(j):f.position(j),x.position.top=x.position.top+j.prop("offsetHeight")}else y();q(i,!1)}},function(){y(),q(i,!1)})};y(),x.query=void 0;var A;l.$parsers.unshift(function(a){return m=!0,a&&a.length>=n?o>0?(A&&d.cancel(A),A=d(function(){z(a)},o)):z(a):(q(i,!1),y()),p?a:a?void l.$setValidity("editable",!1):(l.$setValidity("editable",!0),a)}),l.$formatters.push(function(a){var b,c,d={};return s?(d.$model=a,s(i,d)):(d[v.itemName]=a,b=v.viewMapper(i,d),d[v.itemName]=void 0,c=v.viewMapper(i,d),b!==c?b:a)}),x.select=function(a){var b,c,d={};d[v.itemName]=c=x.matches[a].model,b=v.modelMapper(i,d),u(i,b),l.$setValidity("editable",!0),r(i,{$item:c,$model:b,$label:v.viewMapper(i,d)}),y(),j[0].focus()},j.bind("keydown",function(a){0!==x.matches.length&&-1!==h.indexOf(a.which)&&(a.preventDefault(),40===a.which?(x.activeIdx=(x.activeIdx+1)%x.matches.length,x.$digest()):38===a.which?(x.activeIdx=(x.activeIdx?x.activeIdx:x.matches.length)-1,x.$digest()):13===a.which||9===a.which?x.$apply(function(){x.select(x.activeIdx)}):27===a.which&&(a.stopPropagation(),y(),x.$digest()))}),j.bind("blur",function(){m=!1});var B=function(a){j[0]!==a.target&&(y(),x.$digest())};e.bind("click",B),i.$on("$destroy",function(){e.unbind("click",B)});var C=a(w)(x);t?e.find("body").append(C):j.after(C)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("typeaheadHighlight",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?b.replace(new RegExp(a(c),"gi"),"<strong>$&</strong>"):b}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function(a){a.put("template/accordion/accordion-group.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <h4 class="panel-title">\n      <a class="accordion-toggle" ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a>\n    </h4>\n  </div>\n  <div class="panel-collapse" collapse="!isOpen">\n	  <div class="panel-body" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function(a){a.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(a){a.put("template/alert/alert.html","<div class='alert' ng-class='\"alert-\" + (type || \"warning\")'>\n    <button ng-show='closeable' type='button' class='close' ng-click='close()'>&times;</button>\n    <div ng-transclude></div>\n</div>\n")}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function(a){a.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel">\n    <ol class="carousel-indicators" ng-show="slides().length > 1">\n        <li ng-repeat="slide in slides()" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides().length > 1"><span class="icon-prev"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides().length > 1"><span class="icon-next"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function(a){a.put("template/carousel/slide.html","<div ng-class=\"{\n    'active': leaving || (active && !entering),\n    'prev': (next || active) && direction=='prev',\n    'next': (next || active) && direction=='next',\n    'right': direction=='prev',\n    'left': direction=='next'\n  }\" class=\"item text-center\" ng-transclude></div>\n")}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/datepicker.html",'<table>\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="{{rows[0].length - 2 + showWeekNumbers}}"><button type="button" class="btn btn-default btn-sm btn-block" ng-click="toggleMode()"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n    <tr ng-show="labels.length > 0" class="h6">\n      <th ng-show="showWeekNumbers" class="text-center">#</th>\n      <th ng-repeat="label in labels" class="text-center">{{label}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows">\n      <td ng-show="showWeekNumbers" class="text-center"><em>{{ getWeekNumber(row) }}</em></td>\n      <td ng-repeat="dt in row" class="text-center">\n        <button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected}" ng-click="select(dt.date)" ng-disabled="dt.disabled"><span ng-class="{\'text-muted\': dt.secondary}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/popup.html","<ul class=\"dropdown-menu\" ng-style=\"{display: (isOpen && 'block') || 'none', top: position.top+'px', left: position.left+'px'}\">\n	<li ng-transclude></li>\n"+'	<li ng-show="showButtonBar" style="padding:10px 9px 2px">\n		<span class="btn-group">\n			<button type="button" class="btn btn-sm btn-info" ng-click="today()">{{currentText}}</button>\n			<button type="button" class="btn btn-sm btn-default" ng-click="showWeeks = ! showWeeks" ng-class="{active: showWeeks}">{{toggleWeeksText}}</button>\n			<button type="button" class="btn btn-sm btn-danger" ng-click="clear()">{{clearText}}</button>\n		</span>\n		<button type="button" class="btn btn-sm btn-success pull-right" ng-click="isOpen = false">{{closeText}}</button>\n	</li>\n</ul>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}"></div>')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(a){a.put("template/modal/window.html",'<div tabindex="-1" class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog"><div class="modal-content" ng-transclude></div></div>\n</div>')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function(a){a.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-repeat="page in pages" ng-class="{disabled: page.disabled, previous: page.previous, next: page.next}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function(a){a.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(a){a.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(a){a.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function(a){a.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" ng-transclude></div>')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/progressbar.html",'<div class="progress"><div class="progress-bar" ng-class="type && \'progress-bar-\' + type" ng-transclude></div></div>')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function(a){a.put("template/rating/rating.html",'<span ng-mouseleave="reset()">\n    <i ng-repeat="r in range" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < val && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')"></i>\n</span>')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset-titles.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tabset-titles.html","<ul class=\"nav {{type && 'nav-' + type}}\" ng-class=\"{'nav-stacked': vertical}\">\n</ul>\n")
}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tabset.html",'\n<div class="tabbable">\n  <ul class="nav {{type && \'nav-\' + type}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function(a){a.put("template/timepicker/timepicker.html",'<table>\n	<tbody>\n		<tr class="text-center">\n			<td><a ng-click="incrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n			<td>&nbsp;</td>\n			<td><a ng-click="incrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n			<td ng-show="showMeridian"></td>\n		</tr>\n		<tr>\n			<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidHours}">\n				<input type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-mousewheel="incrementHours()" ng-readonly="readonlyInput" maxlength="2">\n			</td>\n			<td>:</td>\n			<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n				<input type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="readonlyInput" maxlength="2">\n			</td>\n			<td ng-show="showMeridian"><button class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n		</tr>\n		<tr class="text-center">\n			<td><a ng-click="decrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n			<td>&nbsp;</td>\n			<td><a ng-click="decrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n			<td ng-show="showMeridian"></td>\n		</tr>\n	</tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-popup.html","<ul class=\"dropdown-menu\" ng-style=\"{display: isOpen()&&'block' || 'none', top: position.top+'px', left: position.left+'px'}\">\n"+'    <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>')}]),angular.module("SchoolMan",["ngCookies","ngResource","ngSanitize","ngRoute","slugifier","pouchdb","ui.bootstrap"]).config(["$routeProvider","TABS",function(a){var b={login:"login2.html",login404:"login.html",students:"admin-students.html",users:"admin-users.html",user:"user.html",subjects:"admin-subjects.html",classes:"admin-classes.html",transcript:"transcript.html",promotion:"admin-promotion.html",classmasterMarksheet:"classmaster-marksheet.html",registration:"admin-registration.html",departments:"admin-departments.html",fees:"admin-fees.html",finance:"registrar-finance.html",reportcardGTHS:"reportcard-gths.html",registrarProfile:"registrar-profile.html",classmasterProfile:"classmaster-profile.html",classcouncil:"classcouncil.html",stats:"stats.html",notactive:"notactive.html"},c=function(a){var c="/views/",d="";b.hasOwnProperty(a.page)?d=b[a.page]:a.hasOwnProperty("page")&&a.hasOwnProperty("subpage")?d=a.page+".html":console.log("404 Page Not Found");var e=c+d;return console.log("Load Template: ",e,"\n"),e};a.when("/:page/:subpage/:formIndex/:deptId/:groupId/:subjectId/:termIndex/:studentId/:username/:accessCode",{templateUrl:function(a){return c(a)}}).when("/:page/:fullname/:accessCode",{templateUrl:function(a){return c(a)},controller:"LoginCtrl"}).when("/loading",{templateUrl:"/views/loading3.html",controller:"Loading3Ctrl"}).otherwise({redirectTo:"/loading"})}]),chrome.storage.local.get("initialized",function(a){a.hasOwnProperty("initialized")||chrome.storage.local.set({initialized:!1})}),document.getElementById("close").onclick=function(){window.close()},angular.module("SchoolMan").constant("VERSION",{mode:"gths"}).constant("TABS",[{label:"Users",page:"users",access:["admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-lock"},{label:"Departments",page:"departments",access:["admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-bookmark"},{label:"Classes",page:"classes",access:["admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-calendar"},{label:"Subjects",page:"subjects",access:["admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-book"},{label:"Fee Settings",page:"fees",access:["registrar"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-cog"},{label:"Students",page:"students",access:["admin","registrar"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-list-alt"},{label:"Balance Sheet",page:"finance",access:["registrar","admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-envelope"},{label:"Student Profile",page:"registrarProfile",access:["admin","registrar"],exclude:["registration","fees","students","finance","users","subjects","user","departments","classes","classcouncil","stats"],modes:["gths","ghs"],icon:"glyphicon-user"},{label:"Student Profile",page:"classmasterProfile",access:["classmaster"],exclude:["reportcardGTHS","mastersheet","classmasterMarksheet","classcouncil"],modes:["gths","ghs"],icon:"glyphicon-user"},{label:"Registration",page:"registration",access:["registrar"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-calendar"},{label:"My Classes",page:"myclasses",access:["teacher"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-home"},{label:"Marksheet",page:"classmasterMarksheet",access:["classmaster"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-pencil"},{label:"Marksheet",page:"marksheet",access:["teacher"],exclude:["myclasses"],modes:["gths","ghs"],icon:"glyphicon-pencil"},{label:"Mastersheet",page:"mastersheet",access:["classmaster"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-th-large"},{label:"Report Card",page:"reportcardGTHS",access:["classmaster"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-list-alt"},{label:"Class Council",page:"classcouncil",access:["classmaster","admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-folder-open"},{label:"User Settings",page:"user",access:["classmaster","admin","teacher","registrar"],exclude:"all",modes:["gths","ghs"],icon:"glyphicon-cog"},{label:"Statistics",page:"stats",access:["admin"],exclude:[],modes:["gths","ghs"],icon:"glyphicon-stats"}]),angular.module("SchoolMan").constant("PROMOTE_OPTIONS",[{name:"automatic",icon:"glyphicon glyphicon-cog",style:""},{name:"promote",icon:"glyphicon glyphicon-pencil",style:"success"},{name:"repeat",icon:"glyphicon glyphicon-pencil",style:"warning"},{name:"withdrawal",icon:"glyphicon glyphicon-pencil",style:"default"},{name:"dismiss",icon:"glyphicon glyphicon-pencil",style:"danger"}]),angular.module("SchoolMan").constant("DEV",{AUTO_LOGIN:1,AUTO_LOGIN_USER:"Lexie Miller",AUTO_LOGIN_PASS:"lexiemiller",AUTO_LOGIN_ACCESS:"classmaster",AUTO_LOGIN_PAGE:"marksheet"});var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){var b=CryptoJS,c=b.lib,d=c.Base,e=c.WordArray,b=b.x64={};b.Word=d.extend({init:function(a,b){this.high=a,this.low=b}}),b.WordArray=d.extend({init:function(b,c){b=this.words=b||[],this.sigBytes=c!=a?c:8*b.length},toX32:function(){for(var a=this.words,b=a.length,c=[],d=0;b>d;d++){var f=a[d];c.push(f.high),c.push(f.low)}return e.create(c,this.sigBytes)},clone:function(){for(var a=d.clone.call(this),b=a.words=this.words.slice(0),c=b.length,e=0;c>e;e++)b[e]=b[e].clone();return a}})}(),function(a){for(var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.x64.Word,c=b.algo,g=[],h=[],i=[],j=1,k=0,l=0;24>l;l++){g[j+5*k]=(l+1)*(l+2)/2%64;var m=(2*j+3*k)%5,j=k%5,k=m}for(j=0;5>j;j++)for(k=0;5>k;k++)h[j+5*k]=k+5*((2*j+3*k)%5);for(j=1,k=0;24>k;k++){for(var n=m=l=0;7>n;n++){if(1&j){var o=(1<<n)-1;32>o?m^=1<<o:l^=1<<o-32}j=128&j?j<<1^113:j<<1}i[k]=f.create(l,m)}for(var p=[],j=0;25>j;j++)p[j]=f.create();c=c.SHA3=e.extend({cfg:e.cfg.extend({outputLength:512}),_doReset:function(){for(var a=this._state=[],b=0;25>b;b++)a[b]=new f.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(a,b){for(var c=this._state,d=this.blockSize/2,e=0;d>e;e++){var f=a[b+2*e],j=a[b+2*e+1],f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),j=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8),k=c[e];k.high^=j,k.low^=f}for(d=0;24>d;d++){for(e=0;5>e;e++){for(var l=f=0,m=0;5>m;m++)k=c[e+5*m],f^=k.high,l^=k.low;k=p[e],k.high=f,k.low=l}for(e=0;5>e;e++)for(k=p[(e+4)%5],f=p[(e+1)%5],j=f.high,m=f.low,f=k.high^(j<<1|m>>>31),l=k.low^(m<<1|j>>>31),m=0;5>m;m++)k=c[e+5*m],k.high^=f,k.low^=l;for(j=1;25>j;j++)k=c[j],e=k.high,k=k.low,m=g[j],32>m?(f=e<<m|k>>>32-m,l=k<<m|e>>>32-m):(f=k<<m-32|e>>>64-m,l=e<<m-32|k>>>64-m),k=p[h[j]],k.high=f,k.low=l;for(k=p[0],e=c[0],k.high=e.high,k.low=e.low,e=0;5>e;e++)for(m=0;5>m;m++)j=e+5*m,k=c[j],f=p[j],j=p[(e+1)%5+5*m],l=p[(e+2)%5+5*m],k.high=f.high^~j.high&l.high,k.low=f.low^~j.low&l.low;k=c[0],e=i[d],k.high^=e.high,k.low^=e.low}},_doFinalize:function(){var b=this._data,c=b.words,e=8*b.sigBytes,f=32*this.blockSize;c[e>>>5]|=1<<24-e%32,c[(a.ceil((e+1)/f)*f>>>5)-1]|=128,b.sigBytes=4*c.length,this._process();for(var b=this._state,c=this.cfg.outputLength/8,e=c/8,f=[],g=0;e>g;g++){var h=b[g],i=h.high,h=h.low,i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8);f.push(h),f.push(i)}return new d.init(f,c)},clone:function(){for(var a=e.clone.call(this),b=a._state=this._state.slice(0),c=0;25>c;c++)b[c]=b[c].clone();return a}}),b.SHA3=e._createHelper(c),b.HmacSHA3=e._createHmacHelper(c)}(Math),angular.module("SchoolMan").directive("cell",["$log",function(){return{restrict:"A",link:function(a,b,c){var d=parseInt(c.cellNrow);b.bind("keydown",function(a){var c=a.keyCode||a.which;if(13===c||40===c){a.preventDefault();var e=b.context.tabIndex+1,f="input[tabindex="+e+"]";$(f).focus().select()}else if(38===c){a.preventDefault();var e=b.context.tabIndex-1,f="input[tabindex="+e+"]";$(f).focus().select()}else if(39===c){a.preventDefault();var e=b.context.tabIndex+d,f="input[tabindex="+e+"]";$(f).focus().select()}else if(37===c){a.preventDefault();var e=b.context.tabIndex-d,f="input[tabindex="+e+"]";$(f).focus().select()}})}}}]),angular.module("SchoolMan").directive("format",["$filter",function(a){return{require:"?ngModel",link:function(b,c,d,e){e&&(e.$formatters.unshift(function(){return a(d.format)(e.$modelValue)}),e.$parsers.unshift(function(){return c.priceFormat({prefix:d.prefix||"",centsSeparator:".",thousandsSeparator:","}),c[0].value}))}}}]),function(a){a.fn.priceFormat=function(b){var c={prefix:"US$ ",suffix:"",centsSeparator:".",thousandsSeparator:",",limit:!1,centsLimit:2,clearPrefix:!1,clearSufix:!1,allowNegative:!1,insertPlusSign:!1,clearOnEmpty:!1},b=a.extend(c,b);return this.each(function(){function c(a){n.is("input")?n.val(a):n.html(a)}function d(){return o=n.is("input")?n.val():n.html()}function e(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);0==b.length&&0==d&&(d=!1),d&&d.match(p)&&(u?b.length<u&&(b+=d):b+=d)}return b}function f(a){for(;a.length<v+1;)a="0"+a;return a}function g(b,c){if(!c&&(""===b||b==g("0",!0))&&A)return"";var d=f(e(b)),h="",i=0;0==v&&(s="",j="");var j=d.substr(d.length-v,v),k=d.substr(0,d.length-v);if(d=0==v?k:k+s+j,t||""!=a.trim(t)){for(var l=k.length;l>0;l--){var m=k.substr(l-1,1);i++,i%3==0&&(m=t+m),h=m+h}h.substr(0,1)==t&&(h=h.substring(1,h.length)),d=0==v?h:h+s+j}return!y||0==k&&0==j||(d=-1!=b.indexOf("-")&&b.indexOf("+")<b.indexOf("-")?"-"+d:z?"+"+d:""+d),q&&(d=q+d),r&&(d+=r),d}function h(a){var b=a.keyCode?a.keyCode:a.which,d=String.fromCharCode(b),e=!1,f=o,h=g(f+d);(b>=48&&57>=b||b>=96&&105>=b)&&(e=!0),8==b&&(e=!0),9==b&&(e=!0),13==b&&(e=!0),46==b&&(e=!0),37==b&&(e=!0),39==b&&(e=!0),!y||189!=b&&109!=b&&173!=b||(e=!0),!z||187!=b&&107!=b&&61!=b||(e=!0),e||(a.preventDefault(),a.stopPropagation(),f!=h&&c(h))}function i(){var a=d(),b=g(a);a!=b&&c(b),0==parseFloat(a)&&A&&c("")}function j(){n.val(q+d())}function k(){n.val(d()+r)}function l(){if(""!=a.trim(q)&&w){var b=d().split(q);c(b[1])}}function m(){if(""!=a.trim(r)&&x){var b=d().split(r);c(b[0])}}var n=a(this),o="",p=/[0-9]/;o=n.is("input")?n.val():n.html();var q=b.prefix,r=b.suffix,s=b.centsSeparator,t=b.thousandsSeparator,u=b.limit,v=b.centsLimit,w=b.clearPrefix,x=b.clearSuffix,y=b.allowNegative,z=b.insertPlusSign,A=b.clearOnEmpty;z&&(y=!0),n.bind("keydown.price_format",h),n.bind("keyup.price_format",i),n.bind("focusout.price_format",i),w&&(n.bind("focusout.price_format",function(){l()}),n.bind("focusin.price_format",function(){j()})),x&&(n.bind("focusout.price_format",function(){m()}),n.bind("focusin.price_format",function(){k()})),d().length>0&&(i(),l(),m())})},a.fn.unpriceFormat=function(){return a(this).unbind(".price_format")},a.fn.unmask=function(){var b,c="";b=a(this).is("input")?a(this).val():a(this).html();for(var d in b)isNaN(b[d])&&"-"!=b[d]||(c+=b[d]);return c}}(jQuery),angular.module("SchoolMan").provider("Data2",Data2Provider);var schoolman=angular.module("SchoolMan");schoolman.provider("model",modelProvider);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){var c=this,a=a||{};return this instanceof b?(this.fullname="",this.username="",this.password="",this.access={admin:0,registrar:0,classmaster:0,teacher:1},void angular.forEach(a,function(a,b){c.hasOwnProperty(b)&&(c[b]=a)})):new b}a.datatypes.user={v1:{type:"schema",_id:"datatype/user/v1",fields:[{key:"fullname",type:"string",required:!0},{key:"username",type:"string",required:!0},{key:"password",type:"string",required:!0},{key:"access",type:"object",required:!0}],fields_key:0}},b.roles={teacher:{name:"Teacher"},admin:{name:"Administrator"},classmaster:{name:"Class Master"},registrar:{name:"Registrar"}},b.prototype=new a.Model,b.prototype.hasAccess=function(a){return this.access[a]},b.prototype.getHighestAccess=function(){var a="";return a=this.access.admin?"admin":this.access.registrar?"registrar":this.access.classmaster?"classmaster":"teacher",console.log("Getting Highest Access: ",a),a},b.prototype.toggleAccess=function(a){this.access[a]=(this.access[a]+1)%2;"User "+this.username+"changed access '"+a+"' to "+this.access[a];this.hasOwnProperty("_rev")&&this.save()},b.prototype.generateID=function(){var b=a.slugify(this.fullname);return this.username=b,b},b.prototype.normalize=function(){this.username=this._id?this._id:this.generateID(),""===this.password&&(this.password=this.encrypt("user123"))},b.prototype.generateID=function(){var b=a.slugify(this.fullname);return this.username=b,b},b.prototype.datatype=b.datatype=a.datatypes.user.v1,a.User=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){var a=a||{};if(!(this instanceof b))return new b;this.id="",this.name="",this.sex="",this.birth=null,this.parentName="",this.parentPhone="",this.parentEmail="",this.formIndex=a.formIndex||null,this.deptId=a.deptId||null,this.groupId=a.groupId||null,this.feeId=a.feeId||null,this.status={2014:0},this.totalPaid=0;var c=this;angular.forEach(a,function(a,b){c[b]=a});var d=[];this.notify=function(a){console.log("Marksheet notifying listeners: ",d),angular.forEach(d,function(b){console.log("callback",b),b(a)})},this.onChange=function(a){d.push(a)}}a.datatypes.student={v1:{type:"schema",_id:"datatype/student/v1",fields:[{key:"id",type:"string",required:!0},{key:"name",type:"string",required:!0},{key:"sex",type:"string",required:!0},{key:"birth",type:"string",required:!0},{key:"parentName",type:"string",required:!0},{key:"parentPhone",type:"string",required:!0},{key:"parentEmail",type:"string",required:!0},{key:"formIndex",type:"string",required:!0},{key:"deptId",type:"string",required:!0},{key:"groupId",type:"string",required:!0},{key:"feeId",type:"string",required:!0},{key:"status",type:"object",required:!0},{key:"totalPaid",type:"number",required:!1}],fields_key:0}};a.datatypes.student.v1.fields;b.prototype=new a.Model,b.prototype.generateID=function(){var a="student_"+this.id;return a},b.prototype.normalize=function(){this._id=this.generateID()},b.prototype.datatype=b.datatype=a.datatypes.student.v1,b.prototype.setStatus=function(a,b){this.status[a]=b,this.save()},b.prototype.db=b.db="db_students",a.Student=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){var c=this,a=a||{};return this instanceof b?(this.code="",this.en="",this.fr="",this.type=0,void angular.forEach(a,function(a,b){c[b]=a})):new b}a.datatypes.subject={v1:{type:"schema",_id:"datatype/subject/v1",fields:[{key:"code",type:"string",required:!0},{key:"en",type:"string",required:!1},{key:"fr",type:"string",required:!1},{key:"type",type:"number",required:!1}],fields_key:0}},b.types=["General","Specialized","Other"],b.prototype=new a.Model,b.prototype.setType=function(a){this.type=a.toString(),this.hasOwnProperty("_rev")&&this.save().then(function(a){console.log("Saved type: ",a)})},b.prototype.normalize=function(){"string"==typeof this.type&&(this.type=parseInt(this.type))},b.prototype.generateID=function(){var a="subject_"+this.code.toLowerCase();return a},b.prototype.datatype=b.datatype=a.datatypes.subject.v1,a.Subject=b}]),angular.module("SchoolMan").value("Cell",function(){function a(b){if(!(this instanceof a))return new a;this.history=b||[],this.mark="",this.history.length>0&&(this.mark=angular.copy(this.history[this.history.length-1].value)||"");var c=[];this.notify=function(a){angular.forEach(c,function(b){b(a)})},this.onChange=function(a){c.push(a)}}return a.prototype.getValidationStatus=function(){return this.mark>20?"number-invalid":"number-valid"},a.prototype.save=function(){this.mark!==this.history[this.history.length-1].value&&(this.mark=parseFloat(this.mark),this.history.push({value:this.mark,timestamp:Date.now()}),this.notify("Mark changed to "+this.mark))},a}()),angular.module("SchoolMan").value("Mark",function(){function a(){return this instanceof a?(this.value="",this.timestamp=null,void(this.username="")):new a}return a}()),angular.module("SchoolMan").value("Row",function(){function a(){if(!(this instanceof a))return new a;this.columns=[],this.studentId="",this.ranking=[0,0,0,0];var b=[];this.notify=function(a){angular.forEach(b,function(b){b(a)})},this.onChange=function(a){b.push(a)}}return a.prototype.getAverage=function(a){var b=0,c=0,d=this.columns;return a&&3!==a&&(d=[this.columns[2*a],this.columns[2*a+1]]),angular.forEach(d,function(a){a.mark===parseFloat(a.mark)&&(b+=parseFloat(a.mark),c+=1)}),b/c},a.prototype.onLoad=function(){var a=this;angular.forEach(this.columns,function(b,c){b.onChange(function(b){var b="cell "+c+" changed : "+b;a.notify(b)})})},a}());var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){a=a||{};var c=this;if(!(this instanceof b))return new b;if(c._id,c.formIndex,c.deptId,c.groupId,c.subjectId,c.teacherId,c.coeff=2,c.table={},angular.forEach(a,function(a,b){c[b]=a}),c._id&&!(c.formIndex&&c.deptId&&c.groupId&&c.subjectId)){var d=c._id.split(":");c.formIndex=d[0],c.deptId=d[1],c.groupId=d[2],c.subjectId=d[3]}var e=[];c.notify=function(){angular.forEach(e,function(a){a()})},c.onChange=function(a){e.push(a)}}a.datatypes.marksheet={v1:{type:"schema",_id:"datatype/marksheet/v1",fields:[{key:"formIndex",type:"number",required:!0},{key:"deptId",type:"string",required:!0},{key:"groupId",type:"string",required:!0},{key:"subjectId",type:"string",required:!0},{key:"teacherId",type:"string",required:!1},{key:"coeff",type:"number",required:!0},{key:"table",type:"object",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.normalize=function(){this.formIndex=parseInt(this.formIndex)},b.generateID=function(a){var b=a.formIndex+":"+a.deptId+":"+a.groupId+":"+a.subjectId;return b},b.prototype.generateID=function(){b.generateID(this)},b.prototype.datatype=b.datatype=a.datatypes.marksheet.v1,a.Marksheet=b}]),angular.module("SchoolMan").value("Mastersheet",function(){function a(b){var c=this;if(!(c instanceof a))return new a;c.termIndex=b.termIndex,c.subjects=b.subjects,c.marksheets=b.marksheets,c.getSubjectKey=b.getSubjectKey,c.students={},angular.forEach(c.marksheets,function(a){angular.forEach(a.table,function(a,b){c.students[b]={id:b}})}),c.table={students:{}},angular.forEach(c.students,function(a){c.table.students[a.id]={},c.table.totalCoeff=c.getTotalCoeff(),angular.forEach(c.marksheets,function(b,d){var e=c.getSubjectKey(d);c.table.students[a.id][e]={average:c.getStudentSubjectAverage(a.id,d),ac:c.getAc(a.id,e,d)}});var b=c.getAcTotals(a.id);c.table.students[a.id].acTotal=b.ac,c.table.students[a.id].acAverage=b.average});var d=[];angular.forEach(c.table.students,function(a,b){d.push({studentId:b,student:a})}),d.sort(function(a,b){return b.student.acAverage-a.student.acAverage}),angular.forEach(d,function(a,b){a.student.rank=0===b?1:a.student.acAverage===d[b-1].acAverage?d[b-1].rank:b+1})}return a.prototype.getStudentSubjectAverage=function(a,b){var c=this.marksheets[b],d=c.getAverage(a,this.termIndex);return d},a.prototype.getAc=function(a,b,c){var d=this.getStudentSubjectAverage(a,c)*this.subjects[b].coeff;return d||null},a.prototype.getTotalCoeff=function(){var a=this,b=0;return angular.forEach(a.subjects,function(c){c?b+=parseInt(c.coeff):console.log("No subject",a)}),b},a.prototype.getAcTotals=function(a){var b=this,c={ac:0,average:0,coeff:0};return angular.forEach(b.table.students[a],function(a,d){if(b.subjects.hasOwnProperty(d)){c.ac+=a.ac||0;var e=parseInt(b.subjects[d].coeff);c.coeff+=null===a.ac?0:e}}),c.average=c.ac/c.coeff,c},a.prototype.numstats=function(a){var b=this,c={numStudents:Object.keys(this.table.students).length,numPresent:0,passing:0,failing:0,percentPassing:0,percentFailing:0,classAverage:0,classRange:0},d=0,e=0,f=20;return angular.forEach(b.table.students,function(g,h){b.getAcTotals(h).average>=a&&(c.passing+=1),isNaN(g.acAverage)||(d=g.acAverage+d,c.numPresent+=1),g.acAverage<f&&(f=g.acAverage),g.acAverage>e&&(e=g.acAverage)}),c.failing=c.numStudents-c.passing,c.percentPassing=c.passing/c.numStudents,c.percentFailing=1-c.percentPassing,c.classAverage=d/c.numStudents,c.classRange=e-f,c.classRange<0&&(c.classRange=0),console.log("mastersheet numstats: ",c),c},a.prototype.getStudentStatus=function(a){var b=this,c={};return angular.forEach(b.table.students,function(d,e){c[e]=b.getAcTotals(e).average>=a?!0:!1}),c},a}()),angular.module("SchoolMan"),schoolman.config(["modelProvider",function(a){function b(a){a=a||{};var c=this;if(!(this instanceof b))return new b;c.code=a.code||"",c.name=a.name||"",c.forms={0:1,1:1,2:1,3:1,4:1,5:1,6:1},a.hasOwnProperty("forms")&&angular.forEach(a.forms,function(a,b){c.forms[b]=a});var d=[];c.notify=function(){angular.forEach(d,function(a){a()})},c.onChange=function(a){d.push(a)}}a.datatypes.department={v1:{type:"schema",_id:"datatype/department/v1",fields:[{key:"code",type:"string",required:!0},{key:"name",type:"string",required:!0},{key:"forms",type:"object",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.generateID=function(){var a="dept_"+this.code;return a},b.prototype.toggleForm=function(a){return this.forms[a]=(this.forms[a]+1)%2,this},b.prototype.datatype=b.datatype=a.datatypes.department.v1,a.Department=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){a=a||{};var c=this;if(!(this instanceof b))return new b;c.schoolAmount=a.schoolAmount||"",c.ptaAmount=a.ptaAmount||"",c.name=a.name||"";var d=[];c.notify=function(){angular.forEach(d,function(a){a()})},c.onChange=function(a){d.push(a)}}a.datatypes.fee={v1:{type:"schema",_id:"datatype/fee/v1",fields:[{key:"name",type:"string",required:!0},{key:"schoolAmount",type:"number",required:!0},{key:"ptaAmount",type:"number",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.generateID=function(){var b=a.slugify(this.name);return console.log("Slugified:",b),b},b.prototype.datatype=b.datatype=a.datatypes.fee.v1,a.Fee=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a,c){return this instanceof b?(this._id=(new Date).toISOString(),this.userId=a||"",this.studentId=c||"",void(this.text="")):new b}a.datatypes.comment={v1:{type:"schema",_id:"datatype/comment/v1",fields:[{key:"userId",type:"string",required:!0},{key:"studentId",type:"string",required:!0},{key:"text",type:"string",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.datatype=b.datatype=a.datatypes.comment.v1,a.Comment=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(){return this instanceof b?void(this.name=""):new b}a.datatypes.group={v1:{type:"schema",_id:"datatype/group/v1",fields:[{key:"name",type:"string",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.generateID=function(){var a="group_"+this.name.toLowerCase();return a},b.prototype.datatype=b.datatype=a.datatypes.group.v1,a.Group=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){return this instanceof b?void(this.name=a.name||""):new b}a.Form=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(){return this instanceof b?(this.amount=0,this.registrar="",this.studentId="",void(this.date="")):new b}a.datatypes.payment={v1:{type:"schema",_id:"datatype/payment/v1",fields:[{key:"amount",type:"number",required:!0},{key:"registrar",type:"string",required:!0},{key:"studentId",type:"string",required:!0},{key:"date",type:"object",required:!0}],fields_key:0}},b.prototype=new a.Model,b.prototype.datatype=b.datatype=a.datatypes.payment.v1,b.prototype.getAmount=function(){var a=this.amount;return"string"==typeof this.amount&&(a=Number(this.amount.replace(/[^0-9\.]+/g,""))),a},b.prototype.normalize=function(){"string"==typeof this.amount&&(this.amount=this.getAmount()),this.date=new Date},b.prototype.generateID=function(){this.date=new Date;var a="payment_"+this.studentId+"_"+this.date.toISOString();return a},b.prototype.db=b.db="db_payments",a.Payment=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){this.is("dcard.v1");var b=this.val.bind(this),c=!0;this[b("year : string",c)]="2014",this[b("warned : number")]=0,this[b("absence : number")]=0,this[b("council : number")]=0,this[b("suspended : number")]=0,this[b("studentId : string",c)]=void 0,this.__init__(a)}b.prototype=new a.Model,b.prototype.generateID=function(){return"dcard_"+this.studentId+"_"+this.year},a.Dcard=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){if(a=a||{},!(this instanceof b))return new b(a);this.is("classcouncil.v1");var c=this.val.bind(this),d=!0;this[c("formIndex : number",d)]=0,this[c("deptId : string",d)]="",this[c("groupId : string",d)]="",this[c("passingScore : number")]=10,this[c("academicRemark : object")]=[],this[c("conductRemark : string")]="",this[c("factors : object")]=[],this[c("classMaster : string")]="",this.__init__(a)}b.prototype=new a.Model,b.prototype.normalize=function(){this.formIndex=parseInt(this.formIndex)},b.generateID=function(a){var b="council_"+a.formIndex+"_"+a.deptId+"_"+a.groupId;return b},b.prototype.generateID=function(){return b.generateID(this)},a.ClassCouncil=b}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){this.is("settings.v1");var b=this.val.bind(this),c=!0;this._id="customer_settings",this[b("access : object",c)]={admin:1,registrar:1,classmaster:0,teacher:0},this.__init__(a)}b.prototype=new a.Model,a.Settings=b,console.log("Settings added to model",a)}]);var schoolman=angular.module("SchoolMan");schoolman.config(["modelProvider",function(a){function b(a){if(a=a||{},!(this instanceof b))return new b(a);this.is("schoolinfo.v1");var c=this.val.bind(this),d=!0;this[c("nameEn : string",d)]="",this[c("nameFr : string",d)]="",this[c("schoolyear : string",d)]="2014/2015",this[c("version : string",d)]="ghs",this[c("principal : string")]="",this[c("division : string",d)]="",this[c("subdivision : string")]="",this.__init__(a)}b.prototype=new a.Model,b.prototype.generateID=function(){return"schoolinfo"},a.SchoolInfo=b}]),angular.module("SchoolMan").value("InsertionError",function(){function a(a,b){this.name="InsertionError",this.message="InsertionError: value "+b+" already exists in object "+a
}return a.prototype=new Error,a.prototype.constructor=a,a}()),TimeTable.$inject=["Data"],angular.module("SchoolMan").service("TimeTable",TimeTable),Registrar.$inject=["CourseCatalog","Data","Data2","$q","$log","modelTransformer","model","Uid"],angular.module("SchoolMan").service("Registrar",Registrar),CourseCatalog.$inject=["$log","Data","modelTransformer","model","Groups","Forms"],angular.module("SchoolMan").service("CourseCatalog",CourseCatalog),ClassMaster.$inject=["$q","modelTransformer","Registrar","Data","model"],angular.module("SchoolMan").service("ClassMaster",ClassMaster),angular.module("SchoolMan").service("Path",Path),MockData.$inject=["model","Forms","Departments","Groups","Fees","Uid","Students","Payments","Data2"],angular.module("SchoolMan").service("MockData",MockData),Data.$inject=["$timeout","$log","SchoolInfos"],angular.module("SchoolMan").service("Data",Data),Location.$inject=["$location","$routeParams","Path"],angular.module("SchoolMan").service("Location",Location),angular.module("SchoolMan").service("$model",$model),angular.module("SchoolMan").service("Cache",Cache),modelTransformer.$inject=["$log","$model"],angular.module("SchoolMan").service("modelTransformer",modelTransformer),Uid.$inject=["$q","$log","Data2"],angular.module("SchoolMan").service("Uid",Uid),Departments.$inject=["$q","Data2","modelTransformer","model","InsertionError"],angular.module("SchoolMan").service("Departments",Departments),Fees.$inject=["$q","Slug","model","Data2","modelTransformer","InsertionError","$log"],angular.module("SchoolMan").service("Fees",Fees),Groups.$inject=["$q","Slug","Data2","model","modelTransformer"],angular.module("SchoolMan").service("Groups",Groups),Forms.$inject=["model","VERSION","SchoolInfos"],angular.module("SchoolMan").service("Forms",Forms),angular.module("SchoolMan").service("SubjectTypes",SubjectTypes),profile.$inject=["$q","$rootScope","model","Data2","modelTransformer"],angular.module("SchoolMan").service("profile",profile),Marksheets.$inject=["$q","$log","model","modelTransformer","Subjects","Students","Data2","Slug"],angular.module("SchoolMan").service("Marksheets",Marksheets),Students.$inject=["$q","model","modelTransformer","pouchdb"],angular.module("SchoolMan").service("Students",Students),Payments.$inject=["$q","model","modelTransformer","Fees","Students","pouchdb"],angular.module("SchoolMan").service("Payments",Payments),Subjects.$inject=["$q","Data2","modelTransformer","model","InsertionError"],angular.module("SchoolMan").service("Subjects",Subjects),Users.$inject=["$q","$log","Data2","modelTransformer","model","InsertionError","Slug"],angular.module("SchoolMan").service("Users",Users),angular.module("SchoolMan").service("Terms",Terms),ClassCouncils.$inject=["$q","$rootScope","model","Data2","modelTransformer"],angular.module("SchoolMan").service("ClassCouncils",ClassCouncils),Dcards.$inject=["$q","Data2","model"],angular.module("SchoolMan").service("Dcards",Dcards),settings.$inject=["$q","model","Data2"],angular.module("SchoolMan").service("settings",settings),SchoolInfos.$inject=["$q","Data2","model"],angular.module("SchoolMan").service("SchoolInfos",SchoolInfos),LoadingCtrl.$inject=["$scope","Location","$q","Students","Subjects","Forms","Departments","Groups","Fees","Users","settings","model","MockData"],angular.module("SchoolMan").controller("Loading3Ctrl",LoadingCtrl),MastersheetCtrl.$inject=["$scope","$routeParams","Subjects","Students","Data2","Marksheets","Departments","Groups","SubjectTypes","Forms","Cache","Registrar","CourseCatalog","ClassMaster","TimeTable","Data","Location","Mastersheet","PROMOTE_OPTIONS"],angular.module("SchoolMan").controller("MastersheetCtrl2",MastersheetCtrl),MainCtrl.$inject=["$scope","$location","$anchorScroll","$routeParams","Cache","Data","Location","Path","CourseCatalog","TimeTable","Registrar","ClassMaster"],angular.module("SchoolMan").controller("_MainCtrl",MainCtrl),MenuCtrl.$inject=["$scope","$location","$routeParams","$modal","$q","$log","Location","Path","Cache","File","ClassMaster"],angular.module("SchoolMan").controller("MenuCtrl",MenuCtrl),NavbarCtrl.$inject=["$scope","$location","$routeParams","Cache"],angular.module("SchoolMan").controller("NavbarCtrl",NavbarCtrl),LoginCtrl.$inject=["$scope","$location","$routeParams","$log","DEV","Users","Subjects","Departments","settings","model","Path","Cache","Location","Groups"],angular.module("SchoolMan").controller("LoginCtrl",LoginCtrl),UsersCtrl.$inject=["$scope","$routeParams","Users","model","Location","SchoolInfos"],angular.module("SchoolMan").controller("UsersCtrl",UsersCtrl),SubjectsCtrl.$inject=["$scope","$log","SubjectTypes","Forms","Subjects","modelTransformer","model","SchoolInfos"],angular.module("SchoolMan").controller("SubjectsCtrl",SubjectsCtrl),StudentsCtrl.$inject=["$scope","$q","$routeParams","ClassCouncils","Fees","Forms","Groups","Marksheets","Registrar","Subjects","Payments","Students","Departments","CourseCatalog","Mastersheet","model","Data","Location","PROMOTE_OPTIONS"],angular.module("SchoolMan").controller("StudentsCtrl",StudentsCtrl),NavtabsCtrl.$inject=["$scope","$routeParams","Location","TABS","settings","Cache","model","SchoolInfos"],angular.module("SchoolMan").controller("NavtabsCtrl",NavtabsCtrl),ClassmenuCtrl.$inject=["$scope","$routeParams","Departments","Subjects","Groups","Forms","CourseCatalog","Location"],angular.module("SchoolMan").controller("ClassmenuCtrl",ClassmenuCtrl),MarksheetCtrl.$inject=["$scope","$routeParams","Data2","model","Location","Marksheets","ClassMaster"],angular.module("SchoolMan").controller("MarksheetCtrl",MarksheetCtrl),MyclassesCtrl.$inject=["$scope","$routeParams","Users","model","Forms","Groups","Departments","Marksheets","Location","Subjects","TimeTable"],angular.module("SchoolMan").controller("MyclassesCtrl",MyclassesCtrl),DepartmentsCtrl.$inject=["$scope","$log","Registrar","model","Students","Departments","CourseCatalog"],angular.module("SchoolMan").controller("DepartmentsCtrl",DepartmentsCtrl),FeesCtrl.$inject=["$scope","Fees","Students","model"],angular.module("SchoolMan").controller("FeesCtrl",FeesCtrl),ProfileCtrl.$inject=["$scope","$routeParams","model","profile","Dcards","Users","Marksheets","ClassCouncils","$q","Registrar","Students","Fees","Forms","Payments","Groups","Departments","PROMOTE_OPTIONS"],angular.module("SchoolMan").controller("ProfileCtrl",ProfileCtrl),GroupsCtrl.$inject=["$scope","Groups","Students","model","Forms","Registrar"],angular.module("SchoolMan").controller("GroupsCtrl",GroupsCtrl),FinanceCtrl.$inject=["$scope","Forms","Registrar","Fees","Students","Payments","SchoolInfos"],angular.module("SchoolMan").controller("FinanceCtrl",FinanceCtrl),ClasscouncilCtrl.$inject=["$scope","$routeParams","model","Marksheets","Students","ClassCouncils","Groups","Forms","Departments","Terms","ClassMaster","CourseCatalog","Location","Mastersheet","SchoolInfos"],angular.module("SchoolMan").controller("ClasscouncilCtrl",ClasscouncilCtrl),RegistrationCtrl.$inject=["$scope","$routeParams","Uid","Forms","Departments","Groups","Fees","Location","model","Students","Marksheets"],angular.module("SchoolMan").controller("RegistrationCtrl",RegistrationCtrl),ReportcardCtrl.$inject=["$scope","$routeParams","model","ClassCouncils","Dcards","Users","Subjects","Students","Data2","Marksheets","Departments","Groups","Terms","SubjectTypes","Forms","Cache","Registrar","CourseCatalog","ClassMaster","TimeTable","Data","Location","Mastersheet","SchoolInfos","PROMOTE_OPTIONS"],angular.module("SchoolMan").controller("reportcardCtrl",ReportcardCtrl),UserCtrl.$inject=["$scope","$routeParams","Users","model"],angular.module("SchoolMan").controller("UserCtrl",UserCtrl),StatsCtrl.$inject=["$scope","$routeParams","model","File","Subjects","Students","Data2","Marksheets","Departments","Fees","Payments","Terms","Groups","SubjectTypes","Forms","Cache","Registrar","CourseCatalog","ClassMaster","TimeTable","Data","Location","Mastersheet","SchoolInfos","PROMOTE_OPTIONS"],angular.module("SchoolMan").controller("StatsCtrl",StatsCtrl),File.$inject=["pouchdb","$q","settings","model","Users","Fees","Departments","Subjects","Groups","Students","Payments"],angular.module("SchoolMan").service("File",File);