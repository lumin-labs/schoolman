
<div class="row">
  <div class="col-md-2" ng-include="'views/_navstacked.html'"></div>

  <div class="col-md-10 marksheet" 
       ng-controller="reportcardCtrl" 
       ng-init="mastersheet = getMastersheet()">

    <!-- School Name Letterhead -->
    <div class="letterhead" ng-include="'views/_letterhead.html'"></div>

    <div class="row">
      <div class="col-md-12">
        <div class="well student-info">
          <div class="row">
            <div class="col-md-12">
              <table class="table" style="width:100%;">
                <tr>
                  <td class="profile-photo">
                    <div class="img-thumbnail" >
                      <img src="images/user.svg">
                    </div>
                  </td>
                  <td class="text-center" style="width:20%;border-top:0px;">
                    <div class="text-left">
                      <div class="btn-group noprint">
                        <button class="btn btn-lg dropdown-toggle" 
                            data-toggle="dropdown">{{data.student.name}}
                        </button>
                        <ul class="dropdown-menu">
                          <li ng-repeat="(studentIndex, student) in data.students">
                            <a ng-click="open({studentId:student._id})">{{student.name}}</a>
                          </li>
                        </ul>
                      </div>
                      <div class="student-info-section">
                        <h4 class="section-header printonly">{{data.student.name}}</h4>
                        <h5>Gender: <strong>{{data.student.sex}}</strong></h5>
                        <h5>Born: <strong>{{data.student.birth | date:'MMM dd, yyyy'}}</strong></h5>
                        <h5>ID: <strong>{{data.student._id}}</strong></h5>
                        <h5>Class: <strong>{{data.forms[data.student.formIndex].name}}, {{data.departments[data.student.deptId].code}}, {{data.groups[data.student.groupId].name}}</strong></h5>
                      </div>
                    </div>
                  </td>
                  <td class="text-center term-summary">
                    <div class="text-left">
                      <div class="btn-group noprint">
                        <button class="btn btn-lg dropdown-toggle" 
                            data-toggle="dropdown">{{data.term.name}}
                        </button>
                        <ul class="dropdown-menu">
                          <li ng-repeat="(termIndex,term) in data.terms">
                            <a  
                              ng-click="open({termIndex:termIndex})">{{data.terms[termIndex].name}}</a>
                          </li>
                        </ul>
                      </div>
                      <div class="student-info-section">
                        <h4 class="section-header printonly">{{data.term.name}}</h4>
                        <h5 style="font-family:mono;">{{ data.summarysheet[data.student._id][0] >= 0 ? data.summarysheet[data.student._id][0] : 0 | number:2 }} / 20</h5>
                        <h5>{{getRemark(mastersheet.table["students"][student._id].acAverage).text | uppercase}}</h5>
                      </div>
                    </div>
                  </td>
                  <td class="text-center" style="border-top:0px;">
                    <div class="text-left student-info-section">
                      <h4 class="section-header">Parent Contact</h4>
                      <h5>{{data.student.parentName}}</h5>
                      <h5>{{data.student.parentPhone}}</h5>
                      <h5>{{data.student.parentEmail}}</h5>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>   
    </div>
    
    <div class="row">
      <div class="col-md-12">
        <div  ng-repeat="(setIndex, set) in data.sets">
          <h3>{{data.subjectTypes[setIndex]}}</h3>    
          <table  class="table table-striped table-bordered table-transcript">
            <thead>
              <tr>
                <th>Subject Discipline</th>
                <th>S1</th>
                <th>S2</th>
                <th>Average</th>
                <th>Coeff</th>
                <th>A*C</th>
                <th>Position</th>
                <th>Remarks</th>
                <th>Name and Signature</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="(mId, marksheet) in set.marksheets">
                <td>
                  <a ng-click="open({page:'classmasterMarksheet', subjectId:marksheet.subjectId})">{{data.subjects[marksheet.subjectId].en}} / {{data.subjects[marksheet.subjectId].fr}}</a>
                </td>

                <td ng-repeat="sequence in [0,1]"
                    class="{{getRemark(mark).css}}">
                    {{getMark({
                      row:marksheet.table[data.student._id],
                      t:termIndex,
                      s:sequence})}}
                </td>

                <td class="{{getRemark(average).css}}">
                  {{set.summsheets[marksheet._id][data.student._id][0] >= 0 ? set.summsheets[marksheet._id][data.student._id][0] : 0 | number:2}}
                </td>

                <td>
                  {{set.summsheets[marksheet._id][data.student._id][0] ? marksheet.coeff : ""}}
                </td>
                <td>
                  {{set.summsheets[marksheet._id][data.student._id][0] >= 0 ? set.summsheets[marksheet._id][data.student._id][0] * marksheet.coeff : 0 | number:2}}
                </td>
                <td></td>
                <td class="{{getRemark(average).css}}">{{getRemark(set.summsheets[marksheet._id][data.student._id][0]).text}}</td>
                <td>
                  <div class="signature">
                    {{Users.get(marksheet.teacherId).fullname}}
                  </div>
                </td>
              </tr>
              <tr class="danger">
                <td colspan="4" class="text-right"><strong>Sub Total:</strong></td>
                <td>{{set.msheet.coeff}}</td>
                <td>{{set.ssheet[data.student._id][0] >= 0 ? set.ssheet[data.student._id][0] * set.msheet.coeff : 0 | number:2}}</td>
                <td>{{set.rankings[data.student._id][termIndex]}}</td>
                <td class="text-right"><strong>Average:</strong></td>
                <td>{{set.ssheet[data.student._id][0] >= 0 ? set.ssheet[data.student._id][0] : 0| number:2}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <br>
    <div class="row">
      <div class="col-md-4 transcript-summary">
        <table class="table table-bordered table-striped table-transcript" ng-init="totals = mastersheet.getAcTotals(student._id)">
          <tr>
            <td>Total Mark:</td>
            <td>{{data.summarysheet[data.student._id][0] >= 0 ? data.summarysheet[data.student._id][0] * data.msheet.coeff : 0 | number:2}}</td>
          </tr>
          <tr>
            <td>Total Coeff:</td>
            <td>{{data.msheet.coeff}}</td>
          </tr>
          <tr>
            <td>{{data.terms[term]}} Average:</td>
            <td>{{data.summarysheet[data.student._id][0] >= 0 ? data.summarysheet[data.student._id][0] : 0 | number:1}} / 20</td>
          </tr>
          <tr>
            <td>{{data.terms[term]}} Remark:</td>
            <td>{{getRemark(data.summarysheet[data.student._id][0]).text}}</td>
          </tr>
          <tr>
            <td>Class Position:</td>
            <td>{{data.rankings[data.student._id][termIndex]}}</td>
          </tr>
        </table>
      </div>
      <div class="col-md-4 transcript-summary">
        <table class="table table-bordered table-striped table-transcript">
          <tr>
            <td>Hours of Absence:</td>
            <td>{{data.dcard.absence}}</td>
          </tr>
          <tr>
            <td>Attended Disciplinary Council:</td>
            <td>{{data.dcard.council}}</td>
          </tr>
          <tr>
            <td>Warned</td>
            <td>{{data.dcard.warned}}</td>
          </tr>
          <tr>
            <td>Suspended</td>
            <td>{{data.dcard.suspended}}</td>
          </tr>
          <tr>
            <td>Promotion Status</td>
            <td>
                <div  class="btn-group">
                  <!-- If status is set to automatic -->
                  <button ng-if="student.status['2014'] === 0 && studentStatus[student._id]"
                          class="btn btn-sm btn-success dropdown-toggle" 
                          data-toggle="dropdown">
                    <i class="glyphicon" 
                       ng-class="PROMOTE_OPTIONS[0].icon"></i>
                    &nbsp;{{PROMOTE_OPTIONS[1].name}}
                  </button>
                  
                  <button ng-if="student.status['2014'] === 0 && !studentStatus[student._id]"
                        class="btn btn-sm btn-warning dropdown-toggle" 
                        data-toggle="dropdown">
                      <i class="glyphicon" 
                       ng-class="PROMOTE_OPTIONS[0].icon"></i>
                    &nbsp;{{PROMOTE_OPTIONS[2].name}}
                  </button>
                    
                  <!-- Otherwise show whatever it's manually set to -->
                    <button ng-if="student.status['2014'] > 0"
                            class="btn btn-sm dropdown-toggle" 
                            ng-class="'btn-'+PROMOTE_OPTIONS[student.status['2014']].style"
                            data-toggle="dropdown">
                        <i ng-class="PROMOTE_OPTIONS[student.status['2014']].icon"></i>
                      &nbsp;{{PROMOTE_OPTIONS[student.status['2014']].name}}
                    </button>
                  
                  <ul class="dropdown-menu">
                    <li>
                      <a ng-click="student.setStatus('2014', 0)">
                        <i ng-class="PROMOTE_OPTIONS[0].icon"></i>
                        {{PROMOTE_OPTIONS[0].name}}
                      </a>
                    </li>
                    <li class="divider"></li>
                    <li ng-repeat="(optionIndex, option) in PROMOTE_OPTIONS.slice(1)">
                      <a ng-click="student.setStatus('2014', optionIndex + 1)">
                        <i ng-class="PROMOTE_OPTIONS[optionIndex + 1].icon"></i>
                        {{PROMOTE_OPTIONS[optionIndex + 1].name}}
                      </a>
                    </li>
                  </ul>
                </div><!-- /btn-group -->
            </td>
          </tr>
        </table>
      </div>
      <div class="col-md-4 signature">
        <table class="table table-bordered">
          <tr style="height:37px">
            <td rowspan="5" class="text-center" style="vertical-align:middle;">Principal's Signature</td>
          </tr>
          <tr class="signature-padding"></tr>
          <tr class="signature-padding"></tr>
          <tr class="signature-padding"></tr>
          <tr class="signature-padding"></tr>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  <p><a href="http://luminlabs.com" target="_blank">LuminLabs.com</a> | &copy; 2014</p>
</div>
